00000000                            ; ====================================================================
00000000                            ; Gennypher
00000000                            ; for
00000000                            ; Sega Genesis | Sega CD | Sega 32X
00000000                            ;
00000000                            ; (C) Kevin C.
00000000                            ; ====================================================================
00000000                            
00000000                            		include	"engine/ram.asm"
00000000                            ; =====================================================
00000000                            ; RAM
00000000                            ; =====================================================
00000000                            
00000000                            			rsset $FFFFA000			;MD/32X RAM
00000000                            		
00000000                            ; =====================================================
00000000                            ; ----------------------------------------
00000000                            ; Variables
00000000                            ; ----------------------------------------
00000000                            
00000000 =00000400                  sizeof_dmabuff		equ	$400
00000000                            
00000000 =00000000                  bitFrameWait		equ	0
00000000 =00000001                  bitVBlankWait		equ	1
00000000 =00000002                  bitHBlankWait		equ	2
00000000 =00000003                  bitDontWaitHInt		equ	3
00000000 =00000004                  bitLockPads		equ	4
00000000 =00000005                  bitHotStart		equ	5
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; Game vars
00000000                            ; ----------------------------------------
00000000                            
00000000                            
00000000                            ; =====================================================
00000000                            ; ----------------------------------------
00000000                            ; Mode buffer
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFA000                  RAM_ModeBuffer		rs.b	$3000
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; Work stuff
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFD000                  RAM_VIntAddr		rs.l	1
00000000 =FFFFD004                  RAM_HIntAddr		rs.l	1
00000000 =FFFFD008                  RAM_VIntWait		rs.b 	1
00000000 =FFFFD009                  RAM_GameMode		rs.b 	1
00000000 =FFFFD00A                  RAM_Joypads		rs.b	$80
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; Sound
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFD08A                  RAM_SndDriver		rs.b	$400
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; DMA
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFD48A                  RAM_DMA_Buffer		rs.b	sizeof_dmabuff
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; PalFade
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFD88A                  RAM_RunFadeCol		rs.w	$10
00000000 =FFFFD8AA                  RAM_PalFadeBuff		rs.w	64
00000000 =FFFFD92A                  RAM_PalFadeBuffHint	rs.w	64
00000000                            
00000000                            ; ----------------------------------------
00000000                            ; Visual stuff
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFD9AA                  RAM_HorBuffer		rs.l	224
00000000 =FFFFDD2A                  RAM_VerBuffer		rs.l	$20
00000000 =FFFFDDAA                  RAM_SprBuffer		rs.b	(8*80)
00000000 =FFFFE02A                  RAM_PalBuffer		rs.w	64
00000000                            
00000000 =FFFFE0AA                  RAM_VerBufferHint	rs.l	$20
00000000 =FFFFE12A                  RAM_SprBufferHint	rs.l	(8*80)
00000000 =FFFFEB2A                  RAM_PalBufferHint	rs.w	64
00000000 =FFFFEBAA                  RAM_VdpRegs		rs.b	$18
00000000                            
00000000                            ; =====================================================
00000000                            ; ----------------------------------------
00000000                            ; Last RAM
00000000                            ; ----------------------------------------
00000000                            
00000000 =FFFFEBC2                  RAM_End			rs.b	0
00000000                            ;                        	inform 0,"RAM ENDS AT: %h",RAM_End
00000000                            ;                        	inform 0,"RAM ENDS AT: %h",RAM_End
00000000                            
00000000                            ; ====================================================================
00000000                            ; -------------------------------------------------
00000000                            ; Header / Init
00000000                            ; -------------------------------------------------
00000000                            
00000000                            		include "md/init.asm"
00000000                            ; ====================================================================
00000000                            ; -----------------------------------------------------------------
00000000                            ; Header
00000000                            ; -----------------------------------------------------------------
00000000                            
00000000 0000 0000                  		dc.l 0
00000004 0000 0000                  		dc.l MD_Entry
00000008 0000 0000                  		dc.l MD_BusError
0000000C 0000 0000                  		dc.l MD_AddrError
00000010 0000 0000                  		dc.l MD_IllegalError
00000014 0000 0000                  		dc.l MD_ZeroDivError
00000018 0000 0000                  		dc.l MD_ChkError
0000001C 0000 0000                  		dc.l MD_TrapVError
00000020 0000 0000                  		dc.l MD_PrivilegeError
00000024 0000 0000                  		dc.l MD_TraceError
00000028 0000 0000                  		dc.l MD_LineA_Error
0000002C 0000 0000                  		dc.l MD_LineF_Error
00000030                            
00000030 0000 0000 0000 0000 0000+  		cnop 0,$70
00000070 0000 0000                                  dc.l MD_Hint
00000074 0000 0000                  		cnop 0,$78
00000078 0000 0000                                  dc.l MD_Vint
0000007C                            
0000007C 0000 0000 0000 0000 0000+  		cnop 0,$100
00000100 5345 4741 2047 454E 4553+  		dc.b "SEGA GENESIS    "
00000110                            		cnop 0,$110
00000110 2843 294B 4D41 2020 3230+  		dc.b "(C)KMA  2015.???"
00000120                                            cnop 0,$120
00000120 4D45 4741 5649 4420 2020+                  dc.b "MEGAVID                                         "
00000150                                            cnop 0,$150
00000150 4D45 4741 5649 4420 2020+                  dc.b "MEGAVID                                         "
00000180 474D 2048 4F4D 4542 5245+                  dc.b "GM HOMEBREW-00"
0000018E 0000                                       cnop 0,$190
00000190 4A20 2020 2020 2020 2020+  		dc.b "J               "
000001A0                            
000001A0 0000 0000                  		dc.l 0
000001A4 0000 0000                  		dc.l MD_RomEnd
000001A8 00FF 0000                  		dc.l $FF0000
000001AC 00FF FFFF                  		dc.l $FFFFFF
000001B0 5241 E820                  		dc.b "RA",$E8,$20
000001B4 0020 0000                  		dc.l $200000
000001B8 0020 3FFF                  		dc.l $203FFF
000001BC                            
000001BC 0000 0000 0000 0000 0000+  		cnop 0,$1F0
000001F0 5520 2020 2020 2020 2020+  		dc.b "U               "
00000200                            		            
00000200                            ; -----------------------------------------------------------------
00000200                            ; Codigo para iniciar correctamente el Software
00000200                            ;
00000200                            ; Original: (C)SEGA
00000200                            ; -----------------------------------------------------------------
00000200                            
00000200                                            cnop 0,$200
00000200                            MD_Entry:
00000200 4AB9 00A1 0008             		tst.l	($A10008).l	; test port A control
00000206 6600                       		bne.s	@PortA_Ok
00000208 4A79 00A1 000C             		tst.w	($A1000C).l	; test port C control
0000020E                            @PortA_Ok:
0000020E 6600                       		bne.s	@PortC_Ok
00000210                            
00000210 4BFA 0000                  		lea	@SetupValues(pc),a5
00000214 4C9D 00E0                  		movem.w	(a5)+,d5-d7
00000218 4CDD 1F00                  		movem.l	(a5)+,a0-a4
0000021C 1029 EF01                  		move.b	-$10FF(a1),d0	; get hardware version
00000220 0200 000F                  		andi.b	#$F,d0
00000224 6700                       		beq.s	@Skip
00000226 2379 0000 0100 2F00        		move.l	($100),$2F00(a1)
0000022E                            
0000022E                            @Skip:
0000022E 3014                       		move.w	(a4),d0		; check	if VDP works
00000230 7000                       		moveq	#0,d0
00000232 2C40                       		movea.l	d0,a6
00000234 4E66                       		move.l	a6,usp		; set usp to $0
00000236 7217                       		moveq	#$17,d1
00000238                            
00000238                            @VDPInitLoop:
00000238 1A1D                       		move.b	(a5)+,d5	; add $8000 to value
0000023A 3885                       		move.w	d5,(a4)		; move value to	VDP register
0000023C DA47                       		add.w	d7,d5		; next register
0000023E 51C9 FFF8                  		dbf	d1,@VDPInitLoop
00000242 289D                       		move.l	(a5)+,(a4)
00000244 3680                       		move.w	d0,(a3)		; clear	the screen
00000246 3287                       		move.w	d7,(a1)		; stop the Z80
00000248 3487                       		move.w	d7,(a2)		; reset	the Z80
0000024A                            
0000024A                            @WaitForZ80:
0000024A 0111                       		btst	d0,(a1)		; has the Z80 stopped?
0000024C 66FC                       		bne.s	@WaitForZ80	; if not, branch
0000024E 7425                       		moveq	#$25,d2
00000250                            
00000250                            @Z80InitLoop:
00000250 10DD                       		move.b	(a5)+,(a0)+
00000252 51CA FFFC                  		dbf	d2,@Z80InitLoop
00000256 3480                       		move.w	d0,(a2)
00000258 3280                       		move.w	d0,(a1)		; start	the Z80
0000025A 3487                       		move.w	d7,(a2)		; reset	the Z80
0000025C                            
0000025C                            @ClrRAMLoop:
0000025C 2D00                       		move.l	d0,-(a6)
0000025E 51CE FFFC                  		dbf	d6,@ClrRAMLoop	; clear	the entire RAM
00000262 289D                       		move.l	(a5)+,(a4)	; set VDP display mode and increment
00000264 289D                       		move.l	(a5)+,(a4)	; set VDP to CRAM write
00000266 761F                       		moveq	#$1F,d3
00000268                            
00000268                            @ClrCRAMLoop:
00000268 2680                       		move.l	d0,(a3)
0000026A 51CB FFFC                  		dbf	d3,@ClrCRAMLoop	; clear	the CRAM
0000026E 289D                       		move.l	(a5)+,(a4)
00000270 7813                       		moveq	#$13,d4
00000272                            
00000272                            @ClrVDPStuff:
00000272 2680                       		move.l	d0,(a3)
00000274 51CC FFFC                  		dbf	d4,@ClrVDPStuff
00000278 7A03                       		moveq	#3,d5
0000027A                            
0000027A                            @PSGInitLoop:
0000027A 175D 0011                  		move.b	(a5)+,$11(a3)	; reset	the PSG
0000027E 51CD FFFA                  		dbf	d5,@PSGInitLoop
00000282 3480                       		move.w	d0,(a2)
00000284 4CD6 7FFF                  		movem.l	(a6),d0-a6	; clear	all registers
00000288 46FC 2700                  		move	#$2700,sr	; set the sr
0000028C                            
0000028C                            @PortC_Ok:
0000028C 6000 0000                  		bra	@LastJob
00000290                            ; ===========================================================================
00000290 8000                       @SetupValues:	dc.w $8000		; XREF: PortA_Ok
00000292 3FFF                       		dc.w $3FFF
00000294 0100                       		dc.w $100
00000296                            
00000296 00A0 0000                  		dc.l $A00000		; start	of Z80 RAM
0000029A 00A1 1100                  		dc.l $A11100		; Z80 bus request
0000029E 00A1 1200                  		dc.l $A11200		; Z80 reset
000002A2 00C0 0000                  		dc.l $C00000
000002A6 00C0 0004                  		dc.l $C00004		; address for VDP registers
000002AA                            
000002AA 0414 303C                  		dc.b 4,	$14, $30, $3C	; values for VDP registers
000002AE 076C 0000                  		dc.b 7,	$6C, 0,	0
000002B2 0000 FF00                  		dc.b 0,	0, $FF,	0
000002B6 8137 0001                  		dc.b $81, $37, 0, 1
000002BA 0100 00FF                  		dc.b 1,	0, 0, $FF
000002BE FF00 0080                  		dc.b $FF, 0, 0,	$80
000002C2                            
000002C2 4000 0080                  		dc.l $40000080
000002C6                            
000002C6 AF01 D91F 1127 0021 2600+  		dc.b $AF, 1, $D9, $1F, $11, $27, 0, $21, $26, 0, $F9, $77 ; Z80	instructions
000002D2 EDB0 DDE1 FDE1 ED47 ED4F   		dc.b $ED, $B0, $DD, $E1, $FD, $E1, $ED,	$47, $ED, $4F
000002DC D1E1 F108 D9C1 D1E1 F1F9+  		dc.b $D1, $E1, $F1, 8, $D9, $C1, $D1, $E1, $F1,	$F9, $F3
000002E7 ED56 36E9 E9               		dc.b $ED, $56, $36, $E9, $E9
000002EC                            
000002EC 8164                       		dc.w $8164		; value	for VDP	display	mode
000002EE 8F02                       		dc.w $8F02		; value	for VDP	increment
000002F0 C000 0000                  		dc.l $C0000000		; value	for CRAM write mode
000002F4 4000 0010                  		dc.l $40000010
000002F8                            
000002F8 9FBF DFFF                  		dc.b $9F, $BF, $DF, $FF	; values for PSG channel volumes
000002FC                            ; -------------------------------------------------------
000002FC                            
000002FC                            @LastJob:
000002FC                            ;  		lea	($FFFF0000),a0
000002FC                            ;  		move.w	#((RAM_VIntAddr)-$FFFF0000)/4,d0
000002FC                            ; @ClrRam:
000002FC                            ;  		clr.l	(a0)+
000002FC                            ;  		dbf	d0,@ClrRam
000002FC                             		
000002FC 13FC 0000 FFFF D009        		move.b	#0,(RAM_GameMode)
00000304 6000 0000                  		bra 	MD_Main
00000308                            		
00000308                            		
00000308                            		include	"md/error.asm"
00000308                            ; ===========================================================================
00000308                            ; Error screen
00000308                            ; ===========================================================================
00000308                            		
00000308                            MD_BusError:
00000308 6100 0000                  		bsr	ErrorScr_Init
0000030C 41FA 0000                  		lea	Asc_ErrBus(pc),a0
00000310 6100 0000                  		bsr	ErrorScr_ShowMsg
00000314 6000 0000                  		bra	ErrorScr_Loop
00000318                            
00000318                            MD_AddrError:
00000318 6100 0000                  		bsr	ErrorScr_Init
0000031C 41FA 0000                  		lea	Asc_ErrAddr(pc),a0
00000320 6100 0000                  		bsr	ErrorScr_ShowMsg
00000324 6000                       		bra.s	ErrorScr_Loop
00000326                            
00000326                            MD_IllegalError:
00000326 6100 0000                  		bsr	ErrorScr_Init
0000032A 41FA 0000                  		lea	Asc_ErrIlle(pc),a0
0000032E 6100 0000                  		bsr	ErrorScr_ShowMsg
00000332 6000                       		bra.s	ErrorScr_Loop
00000334                            
00000334                            MD_ZeroDivError:
00000334 6100 0000                  		bsr	ErrorScr_Init
00000338 41FA 0000                  		lea	Asc_ErrZerDiv(pc),a0
0000033C 6100 0000                  		bsr	ErrorScr_ShowMsg
00000340 6000                       		bra.s	ErrorScr_Loop
00000342                            
00000342                            MD_ChkError:
00000342 6100 0000                  		bsr	ErrorScr_Init
00000346 41FA 0000                  		lea	Asc_ErrChk(pc),a0
0000034A 6100 0000                  		bsr	ErrorScr_ShowMsg
0000034E 6000                       		bra.s	ErrorScr_Loop
00000350                            
00000350                            MD_TrapVError:
00000350 6100 0000                  		bsr	ErrorScr_Init
00000354 41FA 0000                  		lea	Asc_ErrTrapV(pc),a0
00000358 6100 0000                  		bsr	ErrorScr_ShowMsg
0000035C 6000                       		bra.s	ErrorScr_Loop
0000035E                            
0000035E                            MD_PrivilegeError:
0000035E 6100 0000                  		bsr	ErrorScr_Init
00000362 41FA 0000                  		lea	Asc_ErrPriv(pc),a0
00000366 6100 0000                  		bsr	ErrorScr_ShowMsg
0000036A 6000                       		bra.s	ErrorScr_Loop
0000036C                            
0000036C                            MD_TraceError:
0000036C 6100 0000                  		bsr	ErrorScr_Init
00000370 41FA 0000                  		lea	Asc_ErrTrace(pc),a0
00000374 6100 0000                  		bsr	ErrorScr_ShowMsg
00000378 6000                       		bra.s	ErrorScr_Loop
0000037A                            
0000037A                            MD_LineA_Error:
0000037A 6100 0000                  		bsr	ErrorScr_Init
0000037E 41FA 0000                  		lea	Asc_ErrLineA(pc),a0
00000382 6100 0000                  		bsr	ErrorScr_ShowMsg
00000386 6000                       		bra.s	ErrorScr_Loop
00000388                            
00000388                            MD_LineF_Error:
00000388 6100 0000                  		bsr	ErrorScr_Init
0000038C 41FA 0000                  		lea	Asc_ErrLineF(pc),a0
00000390 6100 0000                  		bsr	ErrorScr_ShowMsg
00000394                            
00000394                            ; ----------------------------------------------
00000394                            ; Loop
00000394                            ; ----------------------------------------------
00000394                            
00000394                            ErrorScr_Loop:
00000394 6100 0000                  		bsr	Pads_Read
00000398                            
00000398 0C39 0000 0000 0000        		cmp.b	#JoyC,(RAM_Joypads+OnPress)
000003A0 6700                       		beq.s	@View
000003A2 60F0                       		bra.s	ErrorScr_Loop
000003A4                            
000003A4                            ; ----------------------------------------------
000003A4                            
000003A4                            @View:
000003A4 33FC 8124 00C0 0004        		move.w	#$8124,($C00004)
000003AC 33FC 8C00 00C0 0004        		move.w	#$8C00,($C00004)
000003B4 23FC 9000 927C 00C0 0004   		move.l	#$9000927C,($C00004)
000003BE 33FC 927C 00C0 0004        		move.w	#$927C,($C00004)
000003C6 33FC 8164 00C0 0004        		move.w	#$8164,($C00004)
000003CE 0879 0000 FFFF 7000        		bchg	#0,($FFFF7000)
000003D6 67BC                       		beq.s	ErrorScr_Loop
000003D8                            
000003D8 33FC 8124 00C0 0004        		move.w	#$8124,($C00004)
000003E0 23FC 8C01 9081 00C0 0004   		move.l	#$8C019081,($C00004)
000003EA 33FC 9200 00C0 0004        		move.w	#$9200,($C00004)
000003F2 33FC 8164 00C0 0004        		move.w	#$8164,($C00004)
000003FA 6098                       		bra.s	ErrorScr_Loop
000003FC                            
000003FC                            ; ===========================================================================
000003FC                            ; ----------------------------------------------
000003FC                            ; Init
000003FC                            ; ----------------------------------------------
000003FC                            
000003FC                            ErrorScr_Init:	
000003FC 46FC 2700                   		move.w	#$2700,sr
00000400 48F9 FFFF FFFF 7000         		movem.l	d0-d7/a0-a7,($FFFF7000)
00000408 13FC 0000 0000 0000         		move.b	#0,(RAM_VdpRegs+vdpReg_PlnSize)
00000410                             		
00000410 23FC 8124 8C00 00C0 0004    		move.l	#$81248C00,($C00004)
0000041A 23FC 9000 927C 00C0 0004    		move.l	#$9000927C,($C00004)
00000424 13FC 009F 00C0 0011        		move.b	#$9F,($C00011)
0000042C 13FC 00BF 00C0 0011         		move.b	#$BF,($C00011)
00000434 13FC 00DF 00C0 0011         		move.b	#$DF,($C00011)
0000043C 13FC 00FF 00C0 0011         		move.b	#$FF,($C00011)
00000444                            
00000444 23FC 5000 0003 00C0 0004      		move.l	#$50000003,($C00004)
0000044E 303C 037F                     		move.w	#$37F,d0
00000452                            @ClrWinScr:
00000452 33FC 8580 00C0 0000           		move.w	#$8580,($C00000)
0000045A 51C8 FFF6                     		dbf	d0,@ClrWinScr
0000045E                            
0000045E 41FA 0000                   		lea	Asc_ErrScr(pc),a0
00000462 223C 0000 0000              		move.l	#Plane_WD+(vdp_Ypos_32*8)+(vdp_Xpos*3),d1
00000468 343C E560                   		move.w	#$8560+$6000,d2
0000046C 7600                        		moveq	#0,d3
0000046E 6100 0000                   		bsr	VDP_LoadAsc
00000472                             
00000472 41FA 0000                    		lea	Art_DbgFont(pc),a0
00000476 303C 0580                    		move.w	#$580,d0
0000047A 323C 0000                    		move.w	#((Art_DbgFont_End-Art_DbgFont)/4)-1,d1
0000047E 6100 0000                    		bsr	VDP_SendData_L
00000482                            
00000482 43F9 FFFF 7000              		lea	($FFFF7000),a1
00000488 263C 0000 0000              		move.l	#Plane_WD+(vdp_Ypos_32*8)+(vdp_Xpos*7),d3
0000048E 7A07                        		moveq	#7,d5
00000490                            @ShowDdata:
00000490 48E7 1000                   		movem.l	d3,-(sp)
00000494 7000                                       moveq	#0,d0
00000496 2011                                       move.l	(a1),d0
00000498 2203                                       move.l	d3,d1
0000049A 343C E590                                  move.w	#$8560+$6000+"0",d2
0000049E 6100 0000                                  bsr	VDP_ShowVal_Long
000004A2 4CDF 0008                                  movem.l	(sp)+,d3
000004A6                             
000004A6 0683 0040 0000                             add.l	#$400000,d3
000004AC D2FC 0004                                  adda	#4,a1
000004B0 51CD FFDE                   		dbf	d5,@ShowDdata
000004B4                            
000004B4 43F9 FFFF 7020              		lea	($FFFF7020),a1
000004BA 263C 0000 0000              		move.l	#Plane_WD+(vdp_Ypos_32*8)+(vdp_Xpos*20),d3
000004C0 7A07                        		moveq	#7,d5
000004C2                            @ShowAdata:
000004C2 48E7 1000                   		movem.l	d3,-(sp)
000004C6 7000                                       moveq	#0,d0
000004C8 2011                                       move.l	(a1),d0
000004CA 2203                                       move.l	d3,d1
000004CC 343C E590                                  move.w	#$8560+$6000+"0",d2
000004D0 6100 0000                                  bsr	VDP_ShowVal_Long
000004D4 4CDF 0008                                  movem.l	(sp)+,d3
000004D8                            
000004D8 0683 0040 0000                             add.l	#$400000,d3
000004DE D2FC 0004                                  adda	#4,a1
000004E2 51CD FFDE                  		dbf	d5,@ShowAdata
000004E6                             
000004E6 4239 FFFF 7000               		clr.b	($FFFF7000)
000004EC                            
000004EC 33FC 8164 00C0 0004         		move.w	#$8164,($C00004)
000004F4 4E75                       		rts
000004F6                            
000004F6                            ; ----------------------------------------------
000004F6                            ; Show error text
000004F6                            ; ----------------------------------------------
000004F6                            
000004F6                            ErrorScr_ShowMsg:
000004F6 223C 5106 0003             		move.l	#$51060003,d1
000004FC 343C E560                  		move.w	#$8560+$6000,d2
00000500 7600                       		moveq	#0,d3
00000502 6000 0000                  		bra	VDP_LoadAsc
00000506                            
00000506                            ; ===========================================================================
00000506                            
00000506                            Asc_ErrScr:
00000506 4430 2024 3030 3030 3030+  		dc.b "D0 $00000000 A0 $",$A
00000518 4431 2024 3030 3030 3030+  		dc.b "D1 $00000000 A1 $",$A
0000052A 4432 2024 3030 3030 3030+  		dc.b "D2 $00000000 A2 $",$A
0000053C 4433 2024 3030 3030 3030+  		dc.b "D3 $00000000 A3 $",$A
0000054E 4434 2024 3030 3030 3030+  		dc.b "D4 $00000000 A4 $",$A
00000560 4435 2024 3030 3030 3030+  		dc.b "D5 $00000000 A5 $",$A
00000572 4436 2024 3030 3030 3030+  		dc.b "D6 $00000000 A6 $",$A
00000584 4437 2024 3030 3030 3030+  		dc.b "D7 $00000000 SP $00000000",$A
0000059E 0A                         		dc.b $A
0000059F 5072 6573 7320 4320 746F+  		dc.b "Press C to see the last",$A
000005B7 6672 616D 6520 6D6F 6D65+  		dc.b "frame moment           ",$A
000005CF 2877 6974 686F 7574 2057+  		dc.b "(without WINDOW layer) ",$A
000005E7 00                         		dc.b 0
000005E8                            		even
000005E8                            
000005E8 4255 5320 4552 524F 5220+  Asc_ErrBus:	dc.b "BUS ERROR                ",$A
00000602 0A                         		dc.b $A
00000603 4265 6570 2062 6565 702E+  		dc.b "Beep beep...             ",0
0000061E 00                         		even
0000061E                            		
0000061E 4144 4452 4553 5320 4552+  Asc_ErrAddr:	dc.b "ADDRESS ERROR            ",$A
00000638 0A                         		dc.b $A
00000639 4765 6E65 7369 7320 646F+  		dc.b "Genesis doesnt like ODD  ",0
00000654 00                         		even
00000654                            		
00000654 494C 4C45 4741 4C20 496E+  Asc_ErrIlle:	dc.b "ILLEGAL Instruction      ",$A
0000066E 0A                         		dc.b $A
0000066F 594F 5520 4152 4520 554E+  		dc.b "YOU ARE UNDER ARREST     ",0
0000068A 00                         		even
0000068A                            		
0000068A 5A45 524F 2044 4956 4944+  Asc_ErrZerDiv:	dc.b "ZERO DIVIDE              ",$A
000006A4 0A                         		dc.b $A
000006A5 424F 4F4D 2028 3E2A 5F2A+  		dc.b "BOOM (>*_*)>              ",0
000006C0                            		even
000006C0                            		
000006C0 4348 4B20 494E 5354 5255+  Asc_ErrChk:	dc.b "CHK INSTRUCTION          ",$A
000006DA 0A                         		dc.b $A
000006DB 4348 4B61 7465 2065 7374+  		dc.b "CHKate esta .l.          ",0
000006F6 00                         		even
000006F6                            		
000006F6 5452 4150 5620 4552 524F+  Asc_ErrTrapV:	dc.b "TRAPV ERROR              ",$A
00000710 0A                         		dc.b $A
00000711 4954 5320 4120 5452 4150+  		dc.b "ITS A TRAP               ",0
0000072C 00                         		even
0000072C                            		
0000072C 5052 4956 494C 4547 4520+  Asc_ErrPriv:	dc.b "PRIVILEGE ERROR          ",$A
00000746 0A                         		dc.b $A
00000747 566F 746F 2070 6F72 2056+  		dc.b "Voto por Voto            ",0
00000762 00                         		even
00000762                            		
00000762 5452 4143 4520 2020 2020+  Asc_ErrTrace:	dc.b "TRACE                    ",$A
0000077C 0A                         		dc.b $A
0000077D 5452 4143 4564 203E 5F3E+  		dc.b "TRACEd >_>               ",0
00000798 00                         		even
00000798                            		
00000798 4C49 4E45 4120 4552 524F+  Asc_ErrLineA:	dc.b "LINEA ERROR              ",$A
000007B2 0A                         		dc.b $A
000007B3 4869 2046 7573 696F 6E20+  		dc.b "Hi Fusion or Gens        ",0
000007CE 00                         		even
000007CE                            		
000007CE 4C49 4E45 4620 4552 524F+  Asc_ErrLineF:	dc.b "LINEF ERROR              ",$A
000007E8 0A                         		dc.b $A
000007E9 5354 4F50 204C 4F4F 4B49+  		dc.b "STOP LOOKING AT HERE TCRF",0
00000804 00                         		even
00000804                            		
00000804                            Art_DbgFont:	incbin	"engine/shared/data/art_dbgfont.bin",0,($20*96)
00001404                            Art_DbgFont_End:
00001404                            
00001404                             		even
00001404                             		even
00001404                            		     
00001404                            ; -------------------------------------------------
00001404                            ; Program data
00001404                            ; -------------------------------------------------
00001404                            
00001404                            		include	"engine/main.asm"
00001404                            ; ====================================================================
00001404                            ; -------------------------------------------------
00001404                            ; Start
00001404                            ; -------------------------------------------------
00001404                            
00001404                            MD_Main:
00001404 46FC 2700                  		move.w	#$2700,sr
00001408                            		
00001408 23FC 0000 0000 FFFF D000   		move.l	#VInt_Default,(RAM_VIntAddr)
00001412 23FC 0000 0000 FFFF D004   		move.l	#Hint_Default,(RAM_HIntAddr)
0000141C 4239 FFFF D008             		clr.b	(RAM_VIntWait)
00001422 42B9 FFFF D48A             		clr.l	(RAM_DMA_Buffer)
00001428                            		
00001428 6100 0000                  		bsr	Vdp_Init
0000142C 6100 0000                  		bsr	Pads_Init
00001430 6100 0000                  		bsr	SMEG_Init
00001434                            		
00001434 46FC 2000                  		move.w	#$2000,sr
00001438                            		
00001438 203C 0000 0000             		move.l	#ID_FadeOut,d0
0000143E 223C 003F 0001              		move.l	#$003F0001,d1
00001444 6100 0000                   		bsr	PalFade_Set
00001448 6100 0000                   		bsr	PalFade_Wait
0000144C                             		
0000144C                            ; -------------------------------------------------
0000144C                            ; Modes
0000144C                            ; -------------------------------------------------
0000144C                            
0000144C                            @RunMode:
0000144C 7000                                       moveq	#0,d0
0000144E 1039 FFFF D009                             move.b	(RAM_GameMode),d0
00001454 E548                                       lsl.w	#2,d0
00001456 0240 00FC                                  and.w	#%11111100,d0
0000145A 41FA 0000                                  lea	GameModes(pc),a0
0000145E 2070 0000                                  movea.l	(a0,d0.w),a0
00001462 4E90                                       jsr	(a0)
00001464 60E6                                       bra.s	@RunMode
00001466                            
00001466                            ; ====================================================================
00001466                            		
00001466                            		
00001466                            
00001466                            ; -------------------------------------------------
00001466                            ; Mode list
00001466                            ; -------------------------------------------------
00001466                            
00001466                            GameModes:
00001466 0000 0000                   		dc.l mode_Title
0000146A                            ;  		dc.l mode_Level
0000146A                             		even
0000146A                            
0000146A                            ; ====================================================================
0000146A                            ; ---------------------------------------------
0000146A                            ; Subs
0000146A                            ; ---------------------------------------------
0000146A                            
0000146A                            		include	"engine/subs/vdp.asm"
0000146A                            ; ====================================================================
0000146A                            ; ---------------------------------------------
0000146A                            ; VDP
0000146A                            ; ---------------------------------------------
0000146A                            
0000146A =40000003                  Plane_FG	equ	$40000003
0000146A =50000003                  Plane_WD	equ	$50000003
0000146A =60000003                  Plane_BG	equ	$60000003
0000146A                            
0000146A =00020000                  vdp_Xpos	equ	$20000
0000146A =00400000                  vdp_Ypos_32	equ	$400000
0000146A =00800000                  vdp_Ypos_40	equ	$800000
0000146A =01000000                  vdp_Ypos_128	equ	$1000000
0000146A                            
0000146A =00000004                  bit_vdpHint	equ	4
0000146A                            
0000146A =00000081                  vdp_H40		equ	$81
0000146A =00000000                  vdp_H32		equ	$00
0000146A =00000006                  vdp_Double	equ	%00000110
0000146A                            
0000146A =0000000C                  vdpReg_HMode	equ	$C
0000146A =00000010                  vdpReg_PlnSize	equ	$10
0000146A                            
0000146A                            ; --------------------------------------------
0000146A                            ; Clear planes
0000146A                            ; --------------------------------------------
0000146A                            
0000146A                            VDP_ClearPlanes:
0000146A 6100 0000                  		bsr	VDP_ClrPlane_FG
0000146E                            
0000146E                            VDP_ClrPlane_BG:
0000146E 23FC 6000 0003 00C0 0004   		move.l	#Plane_BG,($C00004).l
00001478 303C 07FF                  		move.w	#$7FF,d0
0000147C                            @ClrBG:
0000147C 42B9 00C0 0000             		clr.l	($C00000).l
00001482 51C8 FFF8                  		dbf	d0,@ClrBG
00001486 4E75                       		rts
00001488                            
00001488                            VDP_ClrPlane_FG:
00001488 23FC 4000 0003 00C0 0004   		move.l	#Plane_FG,($C00004).l
00001492 303C 07FF                  		move.w	#$7FF,d0
00001496                            @ClrFG:
00001496 42B9 00C0 0000             		clr.l	($C00000).l
0000149C 51C8 FFF8                  		dbf	d0,@ClrFG
000014A0 4E75                       		rts
000014A2                            
000014A2                            ; --------------------------------------------
000014A2                            ; VDP_ClearScroll
000014A2                            ;
000014A2                            ; Set both scrollings to $0000
000014A2                            ; --------------------------------------------
000014A2                            
000014A2                            VDP_ClearScroll:
000014A2 41F9 FFFF D9AA             		lea	(RAM_HorBuffer),a0
000014A8 303C 037F                  		move.w	#$37F,d0
000014AC                            @ClrScrl:
000014AC 4298                       		clr.l	(a0)+
000014AE 51C8 FFFC                  		dbf	d0,@ClrScrl
000014B2                            		
000014B2 41F9 FFFF DD2A             		lea	(RAM_VerBuffer),a0
000014B8 303C 007F                  		move.w	#$7F,d0
000014BC                            @ClrVScrl:
000014BC 4298                       		clr.l	(a0)+
000014BE 51C8 FFFC                  		dbf	d0,@ClrVScrl
000014C2 4E75                       		rts
000014C4                            
000014C4                            ; --------------------------------------------
000014C4                            ; VDP_SendData_W, VDP_SendData_L
000014C4                            ;
000014C4                            ; Input:
000014C4                            ; a0 - Data address
000014C4                            ;
000014C4                            ; d0 | VRAM Address
000014C4                            ; d1 | Data size
000014C4                            ; --------------------------------------------
000014C4                            
000014C4                            VDP_SendData_W:
000014C4 6100 0000                  		bsr	VDP_VramAddr
000014C8 23C0 00C0 0004             		move.l	d0,($C00004)
000014CE                            @Loop:
000014CE 33D8 00C0 0000             		move.w	(a0)+,($C00000).l
000014D4 51C9 FFF8                  		dbf	d1,@Loop
000014D8 4E75                       		rts
000014DA                            
000014DA                            VDP_SendData_L:
000014DA 6100 0000                  		bsr	VDP_VramAddr
000014DE 23C0 00C0 0004             		move.l	d0,($C00004)
000014E4                            @Loop:
000014E4 23D8 00C0 0000             		move.l	(a0)+,($C00000).l
000014EA 51C9 FFF8                  		dbf	d1,@Loop
000014EE 4E75                       		rts
000014F0                            
000014F0                            ; --------------------------------------------
000014F0                            ; VDP_VramAddr
000014F0                            ;
000014F0                            ; Input:
000014F0                            ; d0 | WORD - VRAM to convert
000014F0                            ;
000014F0                            ; Output:
000014F0                            ; d0 | LONG - VDP Command (Write mode)
000014F0                            ; --------------------------------------------
000014F0                            
000014F0                            VDP_VramAddr:
000014F0 4840                       		swap	d0
000014F2 303C 0000                  		move.w	#0,d0
000014F6 4840                       		swap	d0
000014F8 0C40 0200                  		cmp.w	#$200,d0
000014FC 6D00                       		blt.s	@NoBank
000014FE 4840                       		swap	d0
00001500 303C 0001                  		move.w	#1,d0
00001504 4840                       		swap	d0
00001506 0C40 0400                  		cmp.w	#$400,d0
0000150A 6D00                       		blt.s	@NoBank
0000150C 4840                       		swap	d0
0000150E 303C 0002                  		move.w	#2,d0
00001512 4840                       		swap	d0
00001514 0C40 0600                  		cmp.w	#$600,d0
00001518 6D00                       		blt.s	@NoBank
0000151A 4840                       		swap	d0
0000151C 303C 0003                  		move.w	#3,d0
00001520 4840                       		swap	d0
00001522                            @NoBank:
00001522 0240 01FF                   		and.w	#$1FF,d0
00001526 EB48                       		lsl.w	#5,d0
00001528 0640 4000                   		add.w	#$4000,d0
0000152C 4840                       		swap	d0
0000152E 4E75                       		rts
00001530                            		
00001530                            ; --------------------------------------------
00001530                            ; VDP_ShowVal
00001530                            ;
00001530                            ; Input:
00001530                            ; d0 | B/W/L - Value
00001530                            ; d1 | LONG - VDP
00001530                            ; d2 | WORD - VRAM
00001530                            ;
00001530                            ; Breaks:
00001530                            ; d4
00001530                            ; --------------------------------------------
00001530                            
00001530                            VDP_ShowVal_Long:
00001530 48E7 A000                  		movem.l	d0/d2,-(sp)
00001534 2801                       		move.l	d1,d4
00001536 4840                       		swap	d0
00001538 6100 0000                  		bsr	VDP_ShowVal_Word
0000153C 0684 0004 0000                             add.l	#$40000,d4
00001542 2204                                       move.l	d4,d1
00001544                            
00001544 4CDF 0005                  		movem.l	(sp)+,d0/d2
00001548                            
00001548                            VDP_ShowVal_Word:
00001548 48E7 A000                  		movem.l	d0/d2,-(sp)
0000154C 2801                       		move.l	d1,d4
0000154E E048                       		lsr.w	#8,d0
00001550 6100 0000                  		bsr	VDP_ShowVal_Byte
00001554 0684 0004 0000             		add.l	#$40000,d4
0000155A 2204                                       move.l	d4,d1
0000155C                            
0000155C 4CDF 0005                  		movem.l	(sp)+,d0/d2
00001560                            
00001560                            VDP_ShowVal_Byte:
00001560 23C1 00C0 0004             		move.l	d1,($C00004)
00001566                            
00001566 1600                       		move.b	d0,d3
00001568 E808                       		lsr.b	#4,d0
0000156A 6100 0000                  		bsr	@PrevVal
0000156E 1003                       		move.b	d3,d0
00001570                            @PrevVal:
00001570 0240 000F                  		andi.w	#$F,d0
00001574 0C40 000A                  		cmp.w	#$A,d0
00001578 6500 0000                  		bcs	@Less
0000157C 0640 0007                  		add.w	#7,d0
00001580                            @Less
00001580 D042                       		add.w	d2,d0
00001582 33C0 00C0 0000             		move.w	d0,($C00000)
00001588 4E75                       		rts
0000158A                            
0000158A                            ; --------------------------------------------
0000158A                            ; Tamaño 8x16
0000158A                            ;
0000158A                            ; Input:
0000158A                            ; d0 | B/W/L - Value
0000158A                            ; d1 | LONG - VDP
0000158A                            ; d2 | WORD - VRAM
0000158A                            ; --------------------------------------------
0000158A                            
0000158A                            VDP_ShowVal_Long_L:
0000158A 48E7 A000                  		movem.l	d0/d2,-(sp)
0000158E 2C01                       		move.l	d1,d6
00001590 4840                       		swap	d0
00001592 6100 0000                  		bsr	VDP_ShowVal_Word_L
00001596 0686 0004 0000                             add.l	#$40000,d6
0000159C 2206                                       move.l	d6,d1
0000159E                            
0000159E 4CDF 0005                  		movem.l	(sp)+,d0/d2
000015A2                            
000015A2                            VDP_ShowVal_Word_L:
000015A2 48E7 A000                  		movem.l	d0/d2,-(sp)
000015A6 2C01                       		move.l	d1,d6
000015A8 E048                       		lsr.w	#8,d0
000015AA 6100 0000                  		bsr	VDP_ShowVal_Byte_L
000015AE 0686 0004 0000                             add.l	#$40000,d6
000015B4 2206                                       move.l	d6,d1
000015B6                            
000015B6 4CDF 0005                  		movem.l	(sp)+,d0/d2
000015BA                            
000015BA                            
000015BA                            VDP_ShowVal_Byte_L:
000015BA 4DF9 00C0 0000             		lea	($C00000).l,a6
000015C0                            
000015C0 3800                                       move.w	d0,d4
000015C2 2A01                                       move.l	d1,d5
000015C4                            
000015C4 E808                                       lsr.b	#4,d0
000015C6 6100 0000                  		bsr	@ShowNextVal
000015CA                            
000015CA 0685 0002 0000                             add.l	#$20000,d5
000015D0 0640 0001                  		add.w	#1,d0
000015D4                            
000015D4 3004                                       move.w	d4,d0
000015D6 2205                                       move.l	d5,d1
000015D8                            
000015D8                            @ShowNextVal:
000015D8 D040                       		add.w	d0,d0
000015DA                            
000015DA 0240 001F                  		and.w	#$1F,d0
000015DE                            
000015DE D042                       		add.w	d2,d0
000015E0 2D41 0004                  		move.l	d1,4(a6)		;Set VDP Command
000015E4                            
000015E4 3600                               	move.w	d0,d3
000015E6 3C80                       		move.w	d0,(a6)
000015E8                            
000015E8 0643 0001                           	add.w	#1,d3
000015EC 0681 0080 0000                             add.l	#$800000,d1
000015F2                            
000015F2 3003                       		move.w	d3,d0
000015F4 2D41 0004                  		move.l	d1,4(a6)		;Set VDP Command
000015F8 3C80                       		move.w	d0,(a6)
000015FA 4E75                       		rts
000015FC                            
000015FC                            ; --------------------------------------------
000015FC                            
000015FC                            VDP_LoadAsc_List:
000015FC 3011                       		move.w	(a1),d0
000015FE 6A00                                       bpl.s	@GoodPointer
00001600 4E75                       		rts
00001602                            
00001602                            @GoodPointer:
00001602 2059                       		movea.l	(a1)+,a0
00001604 2218                       		move.l	(a0)+,d1
00001606 3418                       		move.w	(a0)+,d2
00001608 6100                       		bsr.s	VDP_LoadAsc
0000160A                            
0000160A 60F0                       		bra.s	VDP_LoadAsc_List
0000160C                            
0000160C                            ; --------------------------------------------
0000160C                            ; VDP_LoadMaps
0000160C                            ; 
0000160C                            ; Input:
0000160C                            ; d0 | LONG - VDP Command
0000160C                            ; d1 | WORD - X size - 1
0000160C                            ; d2 | WORD - Y size - 1
0000160C                            ; d3 | WORD - VRAM
0000160C                            ;
0000160C                            ; OLD: d4 | WORD - Horizontal mode ID
0000160C                            ; --------------------------------------------
0000160C                            
0000160C                            VDP_LoadMaps:
0000160C 1839 FFFF EBBA             		move.b	(RAM_VdpRegs+vdpReg_PlnSize),d4
00001612 0244 0003                  		and.w	#%00000011,d4
00001616 E54C                       		lsl.w	#2,d4
00001618 4BFA 0000                  		lea	VDP_LineAddr(pc),a5
0000161C 2835 4000                  		move.l	(a5,d4.w),d4
00001620                            
00001620                            @Y_Loop:
00001620 23C0 00C0 0004             		move.l	d0,($C00004).l		;Set VDP location from d0
00001626 3A01                       		move.w	d1,d5	  		;Move X-pos value to d3
00001628                            
00001628                            @X_Loop:
00001628 3C18                       		move.w	(a0)+,d6
0000162A DC43                                       add.w	d3,d6
0000162C 33C6 00C0 0000                             move.w	d6,($C00000)		;Put data
00001632 51CD FFF4                  		dbf	d5,@X_Loop		;X-pos loop (from d1 to d3)
00001636 D084                       		add.l	d4,d0                   ;Next line
00001638 51CA FFE6                  		dbf	d2,@Y_Loop		;Y-pos loop
0000163C 4E75                       		rts
0000163E                            
0000163E                            ; --------------------------------------------
0000163E                            ; VDP_LoadAsc
0000163E                            ;
0000163E                            ; Input:
0000163E                            ; a0 - String
0000163E                            ; 
0000163E                            ; d1 | LONG - VDP
0000163E                            ; d2 | WORD - VRAM
0000163E                            ; d3 | WORD - Horizontal mode ID
0000163E                            ; --------------------------------------------
0000163E                            
0000163E                            VDP_LoadAsc:
0000163E 23C1 00C0 0004             		move.l	d1,($C00004).l
00001644                            
00001644                            @Loop_Text:
00001644 7800                       		moveq	#0,d4
00001646 1818                       		move.b	(a0)+,d4
00001648 3A04                       		move.w	d4,d5
0000164A 0C45 000A                  		cmp.w	#$0A,d5
0000164E 6700 0000                  		beq	@NextLine
00001652 0C45 000D                  		cmp.w	#$0D,d5
00001656 6700 0000                  		beq	@NewLine
0000165A 4A45                       		tst.w	d5
0000165C 6600 0000                  		bne	@TypeChar
00001660 4E75                       		rts
00001662                            
00001662                            @NewLine:
00001662 0681 0002 0000             		add.l	#$20000,d1
00001668 6000 FFD4                  		bra	VDP_LoadAsc
0000166C                            		
0000166C                            @TypeChar:
0000166C D842                       		add.w	d2,d4
0000166E 33C4 00C0 0000             		move.w	d4,($C00000).l
00001674 6000 FFCE                  		bra	@Loop_Text
00001678                            		
00001678                            @NextLine:
00001678 7A00                       		moveq	#0,d5
0000167A 1A39 FFFF EBBA             		move.b	(RAM_VdpRegs+vdpReg_PlnSize),d5
00001680 0245 0003                  		and.w	#%00000011,d5
00001684 E54D                       		lsl.w	#2,d5
00001686 2A3B 5000                  		move.l	VDP_LineAddr(pc,d5.w),d5
0000168A D285                       		add.l	d5,d1
0000168C                            
0000168C 6000 FFB0                  		bra	VDP_LoadAsc
00001690                            
00001690                            ; --------------------------------------------
00001690                            ; Vdp_Init
00001690                            ;
00001690                            ; Set the default registers
00001690                            ; --------------------------------------------
00001690                            
00001690                            Vdp_Init:
00001690 41FA 0000                  		lea	Vdp_RegData(pc),a0
00001694 43F9 FFFF EBAA             		lea	(RAM_VdpRegs),a1
0000169A 323C 8000                  		move.w	#$8000,d1
0000169E 7016                       		moveq	#$17-1,d0
000016A0                            @Loop:
000016A0 12D8                       		move.b	(a0)+,(a1)+
000016A2 51C8 FFFC                  		dbf	d0,@Loop
000016A6 4E75                       		rts
000016A8                            
000016A8                            ; --------------------------------------------
000016A8                            ; Vdp_Update
000016A8                            ;
000016A8                            ; Refresh VDP
000016A8                            ; --------------------------------------------
000016A8                            
000016A8                            Vdp_Update:
000016A8 41F9 FFFF EBAA             		lea	(RAM_VdpRegs),a0
000016AE 323C 8000                  		move.w	#$8000,d1
000016B2 7016                       		moveq	#$17-1,d0
000016B4                            @Loop:
000016B4 1218                       		move.b	(a0)+,d1
000016B6 33C1 00C0 0004             		move.w	d1,($C00004).l
000016BC 123C 0000                  		move.b	#0,d1
000016C0 0641 0100                  		add.w	#$100,d1
000016C4 51C8 FFEE                  		dbf	d0,@Loop
000016C8 4E75                       		rts
000016CA                            		
000016CA                            ; --------------------------------------------
000016CA                            ; VSync
000016CA                            ; --------------------------------------------
000016CA                            
000016CA                            VSync:
000016CA 08F9 0000 FFFF D008        		bset	#bitFrameWait,(RAM_VIntWait)
000016D2                            @StillOn:
000016D2 0839 0000 FFFF D008        		btst	#bitFrameWait,(RAM_VIntWait)
000016DA 66F6                       		bne.s	@StillOn
000016DC 4E75                       		rts
000016DE                            		
000016DE                            ; -----------------------------------------
000016DE                            
000016DE                            Vdp_RegData:
000016DE 04                         		dc.b $04
000016DF 64                         		dc.b $64
000016E0 30                         		dc.b $30
000016E1 34                         		dc.b $34
000016E2 07                         		dc.b $07
000016E3 7C                         		dc.b $7C
000016E4 00                         		dc.b $00
000016E5 00                         		dc.b $00
000016E6 00                         		dc.b $00
000016E7 00                         		dc.b $00
000016E8 00                         		dc.b $00
000016E9 03                         		dc.b $03		;Horizontal scroll type
000016EA 81                         		dc.b $81
000016EB 3F                         		dc.b $3F
000016EC 00                         		dc.b $00
000016ED 02                         		dc.b $02
000016EE 01                         		dc.b $01
000016EF 00                         		dc.b $00
000016F0 00                         		dc.b $00
000016F1 00                         		dc.b $00
000016F2 00                         		dc.b $00
000016F3 00                         		dc.b $00
000016F4 00                         		dc.b $00
000016F5 00                         		dc.b $00
000016F6                            		even
000016F6                            
000016F6                            ; --------------------------------------------
000016F6                            
000016F6                            VDP_LineAddr:
000016F6 0040 0000                  		dc.l $400000
000016FA 0080 0000                  		dc.l $800000
000016FE 0100 0000                  		dc.l $1000000
00001702 0100 0000                  		dc.l $1000000
00001706                            		even
00001706                            		
00001706                            ; ======================================================
00001706                            ; *New routines for reading RAW data
00001706                            ; from GIMP*
00001706                            ; (.raw and .raw.pal)
00001706                            ; ======================================================
00001706                            	
00001706                            ; ; --------------------------------------------
00001706                            ; ; Vdp_RawToPal
00001706                            ; ;
00001706                            ; ; Input:
00001706                            ; ; a0 - RAW pallete input
00001706                            ; ; a1 - RAM pallete output
00001706                            ; ; d0 | WORD - Length
00001706                            ; ; 
00001706                            ; ; Output:
00001706                            ; ; none
00001706                            ; ;
00001706                            ; ; Uses:
00001706                            ; ; d3-d6
00001706                            ; ; --------------------------------------------
00001706                            ; 
00001706                            ; Vdp_RawToPal:		
00001706                            ; 		moveq	#0,d3
00001706                            ; 		move.w	d0,d3		;Length
00001706                            ; 		moveq	#0,d4
00001706                            ; 		move.w	d0,d4
00001706                            ; 		lsr.w	#8,d4		;Start from
00001706                            ; 		adda	d4,a0
00001706                            ; 		adda 	d4,a1
00001706                            ; @Next:
00001706                            ; 		moveq	#0,d4
00001706                            ; 		moveq	#0,d5
00001706                            ; 		moveq	#0,d6
00001706                            ; 		move.b	(a0)+,d4	;RED
00001706                            ; 		move.b	(a0)+,d5	;GREEN
00001706                            ; 		move.b	(a0)+,d6	;BLUE
00001706                            ; 		lsr.w	#5,d4		;Convert to MD
00001706                            ; 		lsl.w	#1,d4
00001706                            ; 		lsr.w	#5,d5
00001706                            ; 		lsl.w	#1,d5
00001706                            ; 		lsr.w	#5,d6
00001706                            ; 		lsl.w	#1,d6
00001706                            ; 		lsl.w	#4,d5
00001706                            ; 		add.w	d5,d4
00001706                            ; 		lsl.w	#8,d6
00001706                            ; 		add.w	d6,d4		;d4 - final MD color
00001706                            ; 		move.w	d4,(a1)+
00001706                            ; 		dbf	d3,@Next
00001706                            ; 		rts
00001706                            ; 		
00001706                            ; ; --------------------------------------------
00001706                            ; ; Vdp_RawToGfx
00001706                            ; ;
00001706                            ; ; Input:
00001706                            ; ; a0 - RAW gfx input
00001706                            ; ; d0 | LONG - VDP Address
00001706                            ; ; d1 | WORD - Width
00001706                            ; ; d2 | WORD - Height
00001706                            ; ; 
00001706                            ; ; Output:
00001706                            ; ; none
00001706                            ; ;
00001706                            ; ; Uses:
00001706                            ; ; d3-d6
00001706                            ; ; --------------------------------------------
00001706                            ; 
00001706                            ; Vdp_RawToArt:
00001706                            ; 		lsr.w	#3,d1
00001706                            ; 		sub.w	#1,d1
00001706                            ; 		sub.w	#1,d2
00001706                            ; 		moveq	#0,d6
00001706                            ; @LoopY:
00001706                            ; 		move.l	d0,d3
00001706                            ; 		move.w	d1,d4
00001706                            ; 		swap	d6
00001706                            ; @LoopX:
00001706                            ; 		bsr	@GetLine
00001706                            ; 		move.l	d3,($C00004)
00001706                            ; 		move.l	d5,($C00000)
00001706                            ; 		add.l	#$200000,d3
00001706                            ; 
00001706                            ; 		tst.l	d3
00001706                            ; 		bpl.s	@Fine2
00001706                            ; 		sub.l	#$40000000,d3
00001706                            ; 		add.w	#1,d3
00001706                            ; @Fine2:
00001706                            ; 
00001706                            ; 		dbf	d4,@LoopX
00001706                            ; 		swap	d6
00001706                            ; 		add.w	#1,d6
00001706                            ; 
00001706                            ; 		add.l	#$40000,d0
00001706                            ; 		bsr	@FixAddr
00001706                            ; 		cmp.w	#8,d6
00001706                            ; 		blt.s	@NotEndCell
00001706                            ; 		clr.w	d6
00001706                            ; 		sub.l	#$200000,d0
00001706                            ; 		bsr	@FixAddr
00001706                            ; 
00001706                            ; 		move.w	d1,d4
00001706                            ; @FindNewCell:
00001706                            ; 		add.l	#$200000,d0
00001706                            ; 		bsr	@FixAddr
00001706                            ; 		dbf	d4,@FindNewCell
00001706                            ; 		
00001706                            ; @NotEndCell:
00001706                            ; 		dbf	d2,@LoopY
00001706                            ; 		rts
00001706                            ; 		
00001706                            ; ; ---------------------------
00001706                            ; 
00001706                            ; @GetLine:
00001706                            ; 		moveq	#0,d5
00001706                            ; 		move.w	#0,d6
00001706                            ; 		move.b	(a0)+,d6
00001706                            ; 		and.b	#$F,d6
00001706                            ; 		add.b	d6,d5
00001706                            ; 		lsl.l	#4,d5
00001706                            ; 		move.b	(a0)+,d6
00001706                            ; 		and.b	#$F,d6
00001706                            ; 		add.b	d6,d5
00001706                            ; 		lsl.l	#4,d5
00001706                            ; 		move.b	(a0)+,d6
00001706                            ; 		and.b	#$F,d6
00001706                            ; 		add.b	d6,d5
00001706                            ; 		lsl.l	#4,d5
00001706                            ; 		move.b	(a0)+,d6
00001706                            ; 		and.b	#$F,d6
00001706                            ; 		add.b	d6,d5
00001706                            ;  		lsl.l	#4,d5
00001706                            ;  		move.b	(a0)+,d6
00001706                            ;  		and.b	#$F,d6
00001706                            ;  		add.b	d6,d5
00001706                            ;  		lsl.l	#4,d5
00001706                            ;  		move.b	(a0)+,d6
00001706                            ;  		and.b	#$F,d6
00001706                            ;  		add.b	d6,d5
00001706                            ;  		lsl.l	#4,d5
00001706                            ;  		move.b	(a0)+,d6
00001706                            ;  		and.b	#$F,d6
00001706                            ;  		add.b	d6,d5
00001706                            ;  		lsl.l	#4,d5
00001706                            ;  		move.b	(a0)+,d6
00001706                            ;  		and.b	#$F,d6
00001706                            ;  		add.b	d6,d5
00001706                            ; 		rts
00001706                            ; 
00001706                            ; ; ---------------------------
00001706                            ; 
00001706                            ; @FixAddr:
00001706                            ; 		tst.l	d0
00001706                            ; 		bpl.s	@Fine
00001706                            ; 		sub.l	#$40000000,d0
00001706                            ; 		add.w	#1,d0
00001706                            ; @Fine:
00001706                            ; 		rts
00001706                            
00001706                            ; --------------------------------------------
00001706                            ; Vdp_RawAutoMap
00001706                            ;
00001706                            ; Input:
00001706                            ; d0 | LONG - VDP Address
00001706                            ; d1 | WORD - Width
00001706                            ; d2 | WORD - Height
00001706                            ; d3 | WORD - Start from this value
00001706                            ; d4 | WORD - Horizontal size type (32,40,128)
00001706                            ;
00001706                            ; Output:
00001706                            ; none
00001706                            ;
00001706                            ; Breaks:
00001706                            ; d5
00001706                            ; --------------------------------------------
00001706                            		
00001706                            Vdp_RawAutoMap:
00001706 7A00                       		moveq	#0,d5
00001708 DA43                       		add.w	d3,d5
0000170A 3605                       		move.w	d5,d3
0000170C                            
0000170C 1839 FFFF EBBA             		move.b	(RAM_VdpRegs+vdpReg_PlnSize),d4
00001712 0244 0003                  		and.w	#%00000011,d4
00001716 E54C                       		lsl.w	#2,d4
00001718 4BFA FFDC                  		lea	VDP_LineAddr(pc),a5
0000171C 2835 4000                  		move.l	(a5,d4.w),d4		;Space
00001720                            
00001720                            @Loop_2:
00001720 23C0 00C0 0004             		move.l	d0,($C00004)		;Set VDP location from d0
00001726 3A01                       		move.w	d1,d5	  		;Move X-pos value to d3
00001728                            @Loop:
00001728 33C3 00C0 0000             		move.w	d3,($C00000)		;Put data
0000172E 0643 0001                                  add.w	#1,d3
00001732 51CD FFF4                  		dbf	d5,@Loop		;X-pos loop (from d1 to d3)
00001736 D084                       		add.l	d4,d0                   ;Next line
00001738 51CA FFE6                  		dbf	d2,@Loop_2		;Y-pos loop
0000173C 4E75                       		rts
0000173E                            		
0000173E                            		
0000173E                            		include	"engine/subs/fade.asm"
0000173E                            ; =====================================================
0000173E                            ; FadeIn/FadeOut
0000173E                            ; =====================================================
0000173E                            
0000173E                            ; ---------------------------------------
0000173E                            ; Equs
0000173E                            ; ---------------------------------------
0000173E                            
0000173E                            ; PalFadeHint		equ	$50
0000173E                            
0000173E =01000000                  ID_FadeOut		equ	$01000000
0000173E =02000000                  ID_FadeIn		equ	$02000000
0000173E =03000000                  ID_ToWhite		equ	$03000000
0000173E =04000000                  ID_FadeWhite		equ	$04000000
0000173E                            
0000173E                            ; ---------------------------------------
0000173E                            
0000173E =00000001                  PalFadeFlags		equ	1
0000173E =00000002                  PalFadeStart		equ	2
0000173E =00000003                  PalFadeEnd		equ	3
0000173E =00000004                  PalFadeTmr		equ	4
0000173E =00000008                  PalFadeSource		equ	8
0000173E                            
0000173E                            ; =====================================================
0000173E                            
0000173E                            PalFade:
0000173E 4DF9 FFFF D88A             		lea	(RAM_RunFadeCol),a6
00001744 0816 0007                  		btst	#7,(a6)
00001748 6700                       		beq.s	@NotFinished
0000174A 046E 0001 0006             		sub.w	#1,PalFadeTmr+2(a6)
00001750 6A00 0000                  		bpl	@Return
00001754 6000 0000                  		bra	@Finished
00001758                            
00001758                            @NotFinished:
00001758 7000                       		moveq	#0,d0
0000175A 1016                       		move.b	(a6),d0
0000175C D040                       		add.w	d0,d0
0000175E 323B 0000                  		move.w	@DoList(pc,d0.w),d1
00001762 4EFB 1000                  		jmp	@DoList(pc,d1.w)
00001766                            
00001766                            ; =====================================================
00001766                            
00001766                            @DoList:
00001766 0000                       		dc.w	@Return-@DoList
00001768 0000                       		dc.w	@FadeOut-@DoList
0000176A 0000                       		dc.w	@FadeIn-@DoList
0000176C 0000                       		dc.w	@ToWhite-@DoList
0000176E 0000                       		dc.w	@FromWhite-@DoList
00001770                            		even
00001770                            
00001770                            ; =====================================================
00001770                            ; ---------------------------------------------------
00001770                            ; FadeOut
00001770                            ; ---------------------------------------------------
00001770                            
00001770                            @FadeOut:
00001770 046E 0001 0006             		sub.w	#1,PalFadeTmr+2(a6)
00001776 6A00 0000                  		bpl	@Return
0000177A 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
00001780                            
00001780 41F9 FFFF E02A             		lea	(RAM_PalBuffer),a0
00001786 43F9 FFFF EB2A             		lea	(RAM_PalBufferHint),a1
0000178C                            
0000178C 362E 0002                  		move.w	PalFadeStart(a6),d3
00001790 3803                       		move.w	d3,d4
00001792 E04C                       		lsr.w	#8,d4
00001794 D0C4                       		adda	d4,a0
00001796 D2C4                       		adda	d4,a1
00001798                            
00001798 3C3C 003F                  		move.w	#$3F,d6
0000179C 7400                       		moveq	#0,d2
0000179E                            @Next:
0000179E 3010                       		move.w	(a0),d0
000017A0 3200                       		move.w	d0,d1
000017A2 0241 000F                  		and.w	#$F,d1
000017A6 4A41                       		tst.w	d1
000017A8 6700                       		beq.s	@RedLast
000017AA 0400 0002                  		sub.b	#2,d0
000017AE                            @RedLast:
000017AE 3200                       		move.w	d0,d1
000017B0 E849                       		lsr.w	#4,d1
000017B2 0241 000F                  		and.w	#$F,d1
000017B6 4A41                       		tst.w	d1
000017B8 6700                       		beq.s	@GreenLast
000017BA 0440 0020                  		sub.w	#$20,d0
000017BE                            @GreenLast:
000017BE 3200                       		move.w	d0,d1
000017C0 E049                       		lsr.w	#8,d1
000017C2 0241 000F                  		and.w	#$F,d1
000017C6 4A41                       		tst.w	d1
000017C8 6700                       		beq.s	@BlueLast
000017CA 0440 0200                  		sub.w	#$200,d0
000017CE                            @BlueLast:
000017CE 4A40                       		tst.w	d0
000017D0 6600 0000                  		bne.w	@NotBlack
000017D4 0642 0001                  		add.w	#1,d2
000017D8                            @NotBlack:
000017D8 30C0                       		move.w	d0,(a0)+
000017DA 32C0                       		move.w	d0,(a1)+
000017DC 51CE FFC0                  		dbf	d6,@Next
000017E0                            
000017E0 7800                       		moveq	#0,d4
000017E2 1803                       		move.b	d3,d4
000017E4 B444                       		cmp.w	d4,d2
000017E6 6D00 0000                  		blt	@Return
000017EA                            
000017EA 08D6 0007                  		bset	#7,(a6)
000017EE 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
000017F4 4E75                       		rts
000017F6                            
000017F6                            ; =====================================================
000017F6                            ; ---------------------------------------------------
000017F6                            ; FadeIn
000017F6                            ; ---------------------------------------------------
000017F6                            
000017F6                            @FadeIn:
000017F6 046E 0001 0006             		sub.w	#1,PalFadeTmr+2(a6)
000017FC 6A00 0000                  		bpl	@Return
00001800 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
00001806                            
00001806 41F9 FFFF E02A             		lea	(RAM_PalBuffer),a0
0000180C 45F9 FFFF EB2A             		lea	(RAM_PalBufferHint),a2
00001812 43F9 FFFF D8AA             		lea	(RAM_PalFadeBuff),a1
00001818                            
00001818 3E2E 0002                  		move.w	PalFadeStart(a6),d7
0000181C 3807                       		move.w	d7,d4
0000181E E04C                       		lsr.w	#8,d4
00001820 D0C4                       		adda	d4,a0
00001822 D4C4                       		adda	d4,a2
00001824                            
00001824 7C00                       		moveq	#0,d6
00001826 1C2E 0003                  		move.b	PalFadeStart+1(a6),d6
0000182A 7A00                       		moveq	#0,d5
0000182C                            @Next_2:
0000182C 3010                       		move.w	(a0),d0
0000182E 3211                       		move.w	(a1),d1
00001830 3400                       		move.w	d0,d2
00001832 3601                       		move.w	d1,d3
00001834 0242 000F                  		and.w	#$F,d2
00001838 0243 000F                  		and.w	#$F,d3
0000183C B443                       		cmp.w	d3,d2
0000183E 6C00                       		bge.s	@RedFirst
00001840 0640 0002                  		add.w	#2,d0
00001844                            @RedFirst:
00001844                            
00001844 3400                       		move.w	d0,d2
00001846 3601                       		move.w	d1,d3
00001848 E84A                       		lsr.w	#4,d2
0000184A E84B                       		lsr.w	#4,d3
0000184C 0242 000F                  		and.w	#$F,d2
00001850 0243 000F                  		and.w	#$F,d3
00001854 B443                       		cmp.w	d3,d2
00001856 6C00                       		bge.s	@GreenFirst
00001858 0640 0020                  		add.w	#$20,d0
0000185C                            @GreenFirst:
0000185C                            
0000185C 3400                       		move.w	d0,d2
0000185E 3601                       		move.w	d1,d3
00001860 E04A                       		lsr.w	#8,d2
00001862 E04B                       		lsr.w	#8,d3
00001864 0242 000F                  		and.w	#$F,d2
00001868 0243 000F                  		and.w	#$F,d3
0000186C B443                       		cmp.w	d3,d2
0000186E 6C00                       		bge.s	@BlueFirst
00001870 0640 0200                  		add.w	#$200,d0
00001874                            @BlueFirst:	
00001874 3400                       		move.w	d0,d2
00001876 3211                       		move.w	(a1),d1
00001878 B242                       		cmp.w	d2,d1
0000187A 6600                       		bne.s	@NotEqual
0000187C 0645 0001                  		add.w	#1,d5
00001880                            @NotEqual:
00001880 D2FC 0002                  		adda	#2,a1
00001884 30C0                       		move.w	d0,(a0)+
00001886 34C0                       		move.w	d0,(a2)+
00001888 51CE FFA2                  		dbf	d6,@Next_2
0000188C                            
0000188C 0445 0001                  		sub.w	#1,d5
00001890 3D45 0008                  		move.w	d5,PalFadeSource(a6)
00001894                            
00001894 7800                       		moveq	#0,d4
00001896 7400                       		moveq	#0,d2
00001898 142E 0003                  		move.b	PalFadeStart+1(a6),d2
0000189C 1805                       		move.b	d5,d4
0000189E B444                       		cmp.w	d4,d2
000018A0 6E00 0000                  		bgt	@Return
000018A4                            		
000018A4 08D6 0007                  		bset	#7,(a6)
000018A8 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
000018AE 4E75                       		rts
000018B0                            
000018B0                            ; =====================================================
000018B0                            ; ---------------------------------------------------
000018B0                            ; ToWhite
000018B0                            ; ---------------------------------------------------
000018B0                            
000018B0                            @ToWhite:
000018B0 41F9 FFFF E02A             		lea	(RAM_PalBuffer),a0
000018B6 046E 0001 0006             		sub.w	#1,PalFadeTmr+2(a6)
000018BC 6A00                       		bpl.s	@Return
000018BE 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
000018C4                            
000018C4 362E 0002                  		move.w	PalFadeStart(a6),d3
000018C8                            
000018C8 3C3C 003F                  		move.w	#$3F,d6
000018CC 7400                       		moveq	#0,d2
000018CE                            @NextW:
000018CE 3010                       		move.w	(a0),d0
000018D0 3200                       		move.w	d0,d1
000018D2 0241 000F                  		and.w	#$F,d1
000018D6 0C41 000E                  		cmp.w	#$E,d1
000018DA 6700                       		beq.s	@RedLastW
000018DC 0600 0002                  		add.b	#2,d0
000018E0                            @RedLastW:
000018E0 3200                       		move.w	d0,d1
000018E2 E849                       		lsr.w	#4,d1
000018E4 0241 000F                  		and.w	#$F,d1
000018E8 0C41 000E                  		cmp.w	#$E,d1
000018EC 6700                       		beq.s	@GreenLastW
000018EE 0640 0020                  		add.w	#$20,d0
000018F2                            @GreenLastW:
000018F2 3200                       		move.w	d0,d1
000018F4 E049                       		lsr.w	#8,d1
000018F6 0241 000F                  		and.w	#$F,d1
000018FA 0C41 000E                  		cmp.w	#$E,d1
000018FE 6700                       		beq.s	@BlueLastW
00001900 0640 0200                  		add.w	#$200,d0
00001904                            @BlueLastW:
00001904 0C40 0EEE                  		cmp.w	#$EEE,d0
00001908 6D00 0000                  		blt.w	@NotWhite
0000190C 0642 0001                  		add.w	#1,d2
00001910                            @NotWhite:
00001910 30C0                       		move.w	d0,(a0)+
00001912 51CE FFBA                  		dbf	d6,@NextW
00001916                            
00001916 7800                       		moveq	#0,d4
00001918 1803                       		move.b	d3,d4
0000191A B444                       		cmp.w	d4,d2
0000191C 6D00                       		blt.s	@Return
0000191E                            		
0000191E 08D6 0007                  		bset	#7,(a6)
00001922 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
00001928 4E75                       		rts
0000192A                            
0000192A                            ; =====================================================
0000192A                            ; ---------------------------------------------------
0000192A                            ; FromWhite
0000192A                            ; ---------------------------------------------------
0000192A                            
0000192A                            @FromWhite:
0000192A 4216                       		clr.b	(a6)
0000192C 4E75                       		rts
0000192E                            
0000192E                            ; =====================================================
0000192E                            ; ---------------------------------------------------
0000192E                            ; Subs
0000192E                            ; ---------------------------------------------------
0000192E                            
0000192E                            @Finished:
0000192E 3D6E 0004 0006              		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
00001934 4216                       		clr.b	(a6)
00001936                            @Return:
00001936 4E75                       		rts
00001938                            
00001938                            ; =====================================================
00001938                            ; External
00001938                            ; =====================================================
00001938                            
00001938                            PalFade_Set:
00001938 48E7 0002                  		movem.l	a6,-(sp)
0000193C 4DF9 FFFF D88A             		lea	(RAM_RunFadeCol),a6
00001942                            
00001942 2400                       		move.l	d0,d2
00001944 2D41 0002                  		move.l	d1,PalFadeStart(a6)
00001948 3D6E 0004 0006             		move.w	PalFadeTmr(a6),PalFadeTmr+2(a6)
0000194E 4840                       		swap	d0
00001950 E048                       		lsr.w	#8,d0
00001952 1C80                       		move.b	d0,(a6)
00001954 2002                       		move.l	d2,d0
00001956                            
00001956 4CDF 4000                  		movem.l	(sp)+,a6
0000195A 4E75                       		rts
0000195C                            		
0000195C                            PalFade_Wait:
0000195C 6100 FD6C                   		bsr	VSync
00001960                            
00001960 4A39 FFFF D88A             		tst.b	(RAM_RunFadeCol)
00001966 66F4                       		bne.s	PalFade_Wait
00001968 4E75                       		rts
0000196A                            
0000196A                            PalFade_Wait_Flag:
0000196A 7CFF                        		moveq	#-1,d6
0000196C 4A39 FFFF D88A             		tst.b	(RAM_RunFadeCol)
00001972 6600                       		bne.s	@no
00001974 7C00                       		moveq	#0,d6
00001976                            @no:
00001976 4A46                       		tst.w	d6
00001978 4E75                       		rts
0000197A                            		
0000197A                            ; =====================================================
0000197A                            ; MARS
0000197A                            ; =====================================================
0000197A                            
0000197A                            ; PalFadeMars_Set:
0000197A                            ;  		if MARS=1
0000197A                            ;  		move.l	d0,d2
0000197A                            ;  		cmp.l	#ID_FadeIn,d2
0000197A                            ;  		bne.s	@NotFadeIn
0000197A                            ;  
0000197A                            ;  		move.w	d1,(marsreg+comm4)
0000197A                            ;   		moveq	#M_PalFade_In,d0
0000197A                            ;  		bsr	Mars_DoTask_Master
0000197A                            ; @NotFadeIn:
0000197A                            ;  		cmp.l	#ID_FadeOut,d2
0000197A                            ;  		bne.s	@NotFadeOut
0000197A                            ;  
0000197A                            ;  		move.w	d1,(marsreg+comm4)
0000197A                            ;   		moveq	#M_PalFade_Out,d0
0000197A                            ;  		bsr	Mars_DoTask_Master
0000197A                            ; @NotFadeOut:
0000197A                            ;  		endif
0000197A                            ; 		rts
0000197A                            		
0000197A                            		
0000197A                            		include	"engine/subs/misc.asm"
0000197A                            ; ====================================================================
0000197A                            ; ---------------------------------------------
0000197A                            ; Mode cleanup
0000197A                            ; ---------------------------------------------
0000197A                            
0000197A                            Mode_Cleanup:
0000197A 4DF9 FFFF E02A             		lea	(RAM_PalBuffer),a6
00001980 303C 003F                  		move.w	#$3F,d0
00001984                            @PalBuf:
00001984 425E                       		clr.w	(a6)+
00001986 51C8 FFFC                  		dbf	d0,@PalBuf
0000198A                            
0000198A 4DF9 FFFF DD2A             		lea	(RAM_VerBuffer),a6
00001990 303C 001F                  		move.w	#(($7F)/4),d0
00001994                            @VerBuf:
00001994 429E                       		clr.l	(a6)+
00001996 51C8 FFFC                  		dbf	d0,@VerBuf
0000199A                            
0000199A 4DF9 FFFF DDAA             		lea	(RAM_SprBuffer),a6
000019A0 303C 007F                  		move.w	#$7F,d0
000019A4                            @SprBuf:
000019A4 429E                       		clr.l	(a6)+
000019A6 51C8 FFFC                  		dbf	d0,@SprBuf
000019AA                            
000019AA 4DF9 FFFF D9AA             		lea	(RAM_HorBuffer),a6
000019B0 303C 00DF                  		move.w	#(($37F)/4),d0
000019B4                            @HorBuf:
000019B4 429E                       		clr.l	(a6)+
000019B6 51C8 FFFC                  		dbf	d0,@HorBuf
000019BA                            
000019BA 4E75                       		rts
000019BC                            
000019BC                            ; ; ====================================================================
000019BC                            ; ; ---------------------------------------------
000019BC                            ; ; Set new HBlank
000019BC                            ; ; ---------------------------------------------
000019BC                            ; 		
000019BC                            ; MD_SetNewHint:
000019BC                            ; 		tst.l	d0
000019BC                            ; 		beq.s	@ClearHint
000019BC                            ; 		bset	#2,(RAM_VIntWait)
000019BC                            ; 		move.l	d0,(RAM_HIntAddr)
000019BC                            ; 		move.w	#$8004,($C00004)
000019BC                            ; 		rts
000019BC                            ; @ClearHint:
000019BC                            ; 		bclr	#2,(RAM_VIntWait)
000019BC                            ; 		move.w	#$8004,($C00004)
000019BC                            ; 		rts
000019BC                            		
000019BC                            ; ====================================================================
000019BC                            ; ---------------------------------------------
000019BC                            ; Generic data loaders
000019BC                            ;
000019BC                            ; NonVDP:
000019BC                            ; a0 - Input
000019BC                            ; a1 - Output
000019BC                            ; d0 - Size (BYTE, WORD or LONG)
000019BC                            ; ---------------------------------------------
000019BC                            
000019BC                            LoadData_Byte:
000019BC 12D8                       		move.b	(a0)+,(a1)+
000019BE 51C8 FFFC                  		dbf	d0,LoadData_Byte
000019C2 4E75                       		rts
000019C4                            
000019C4                            LoadData_Word:
000019C4 32D8                       		move.w	(a0)+,(a1)+
000019C6 51C8 FFFC                  		dbf	d0,LoadData_Word
000019CA 4E75                       		rts
000019CC                            
000019CC                            LoadData_Long:
000019CC 22D8                       		move.l	(a0)+,(a1)+
000019CE 51C8 FFFC                  		dbf	d0,LoadData_Long
000019D2 4E75                       		rts
000019D4                            		
000019D4                            ; ====================================================================
000019D4                            ; ---------------------------------------------
000019D4                            ; RLE decompression
000019D4                            ; byte $FF is end-of-data
000019D4                            ;
000019D4                            ; a0 - Input
000019D4                            ; a1 - Output
000019D4                            ; ---------------------------------------------
000019D4                            
000019D4                            RLE_decompress:
000019D4 7000                       		moveq	#0,d0
000019D6 7200                       		moveq	#0,d1
000019D8 1018                       		move.b	(a0)+,d0
000019DA 0C00 00FF                  		cmp.b	#-1,d0
000019DE 6700 0000                  		beq	@Finish
000019E2                            		
000019E2 1218                       		move.b	(a0)+,d1
000019E4                            @CopyIt:
000019E4 12C1                       		move.b	d1,(a1)+
000019E6 51C8 FFFC                  		dbf	d0,@CopyIt
000019EA                            		
000019EA 60E8                       		bra.s	RLE_decompress
000019EC                            @Finish:
000019EC 4E75                       		rts
000019EE                            
000019EE                            ; ====================================================================
000019EE                            ; ---------------------------------------------
000019EE                            ; CalcSine
000019EE                            ;
000019EE                            ; Input:
000019EE                            ; d0 | WORD
000019EE                            ;
000019EE                            ; Output:
000019EE                            ; d0 | WORD
000019EE                            ; d1 | WORD
000019EE                            ; ---------------------------------------------
000019EE                            
000019EE                            CalcSine:
000019EE 0240 00FF                  		and.w	#$FF,d0
000019F2 D040                       		add.w	d0,d0
000019F4 0640 0080                  		add.w	#$80,d0
000019F8 323B 0000                  		move.w	Sine_Data(pc,d0.w),d1
000019FC 0440 0080                  		sub.w	#$80,d0
00001A00 303B 0000                  		move.w	Sine_Data(pc,d0.w),d0
00001A04 4E75                       		rts	
00001A06                            
00001A06                            Sine_Data:
00001A06 0000 0006 000C 0012 0019+  		dc.w 0,	6, $C, $12, $19, $1F, $25, $2B,	$31, $38, $3E
00001A1C 0044 004A 0050 0056 005C+  		dc.w $44, $4A, $50, $56, $5C, $61, $67,	$6D, $73, $78
00001A30 007E 0083 0088 008E 0093+  		dc.w $7E, $83, $88, $8E, $93, $98, $9D,	$A2, $A7, $AB
00001A44 00B0 00B5 00B9 00BD 00C1+  		dc.w $B0, $B5, $B9, $BD, $C1, $C5, $C9,	$CD, $D1, $D4
00001A58 00D8 00DB 00DE 00E1 00E4+  		dc.w $D8, $DB, $DE, $E1, $E4, $E7, $EA,	$EC, $EE, $F1
00001A6C 00F3 00F4 00F6 00F8 00F9+  		dc.w $F3, $F4, $F6, $F8, $F9, $FB, $FC,	$FD, $FE, $FE
00001A80 00FF 00FF 00FF 0100 00FF+  		dc.w $FF, $FF, $FF, $100, $FF, $FF, $FF, $FE, $FE, $FD
00001A94 00FC 00FB 00F9 00F8 00F6+  		dc.w $FC, $FB, $F9, $F8, $F6, $F4, $F3,	$F1, $EE, $EC
00001AA8 00EA 00E7 00E4 00E1 00DE+  		dc.w $EA, $E7, $E4, $E1, $DE, $DB, $D8,	$D4, $D1, $CD
00001ABC 00C9 00C5 00C1 00BD 00B9+  		dc.w $C9, $C5, $C1, $BD, $B9, $B5, $B0,	$AB, $A7, $A2
00001AD0 009D 0098 0093 008E 0088+  		dc.w $9D, $98, $93, $8E, $88, $83, $7E,	$78, $73, $6D
00001AE4 0067 0061 005C 0056 0050+  		dc.w $67, $61, $5C, $56, $50, $4A, $44,	$3E, $38, $31
00001AF8 002B 0025 001F 0019 0012+  		dc.w $2B, $25, $1F, $19, $12, $C, 6, 0,	-6, -$C, -$12
00001B0E FFE7 FFE1 FFDB FFD5 FFCF+  		dc.w -$19, -$1F, -$25, -$2B, -$31, -$38, -$3E, -$44, -$4A
00001B20 FFB0 FFAA FFA4 FF9F FF99+  		dc.w -$50, -$56, -$5C, -$61, -$67, -$6D, -$75, -$78, -$7E
00001B32 FF7D FF78 FF72 FF6D FF68+  		dc.w -$83, -$88, -$8E, -$93, -$98, -$9D, -$A2, -$A7, -$AB
00001B44 FF50 FF4B FF47 FF43 FF3F+  		dc.w -$B0, -$B5, -$B9, -$BD, -$C1, -$C5, -$C9, -$CD, -$D1
00001B56 FF2C FF28 FF25 FF22 FF1F+  		dc.w -$D4, -$D8, -$DB, -$DE, -$E1, -$E4, -$E7, -$EA, -$EC
00001B68 FF12 FF0F FF0D FF0C FF0A+  		dc.w -$EE, -$F1, -$F3, -$F4, -$F6, -$F8, -$F9, -$FB, -$FC
00001B7A FF03 FF02 FF02 FF01 FF01+  		dc.w -$FD, -$FE, -$FE, -$FF, -$FF, -$FF, -$100,	-$FF, -$FF
00001B8C FF01 FF02 FF02 FF03 FF04+  		dc.w -$FF, -$FE, -$FE, -$FD, -$FC, -$FB, -$F9, -$F8, -$F6
00001B9E FF0C FF0D FF0F FF12 FF14+  		dc.w -$F4, -$F3, -$F1, -$EE, -$EC, -$EA, -$E7, -$E4, -$E1
00001BB0 FF22 FF25 FF28 FF2C FF2F+  		dc.w -$DE, -$DB, -$D8, -$D4, -$D1, -$CD, -$C9, -$C5, -$C1
00001BC2 FF43 FF47 FF4B FF50 FF55+  		dc.w -$BD, -$B9, -$B5, -$B0, -$AB, -$A7, -$A2, -$9D, -$98
00001BD4 FF6D FF72 FF78 FF7D FF82+  		dc.w -$93, -$8E, -$88, -$83, -$7E, -$78, -$75, -$6D, -$67
00001BE6 FF9F FFA4 FFAA FFB0 FFB6+  		dc.w -$61, -$5C, -$56, -$50, -$4A, -$44, -$3E, -$38, -$31
00001BF8 FFD5 FFDB FFE1 FFE7 FFEE+  		dc.w -$2B, -$25, -$1F, -$19, -$12, -$C,	-6, 0, 6, $C, $12
00001C0E 0019 001F 0025 002B 0031+  		dc.w $19, $1F, $25, $2B, $31, $38, $3E,	$44, $4A, $50
00001C22 0056 005C 0061 0067 006D+  		dc.w $56, $5C, $61, $67, $6D, $73, $78,	$7E, $83, $88
00001C36 008E 0093 0098 009D 00A2+  		dc.w $8E, $93, $98, $9D, $A2, $A7, $AB,	$B0, $B5, $B9
00001C4A 00BD 00C1 00C5 00C9 00CD+  		dc.w $BD, $C1, $C5, $C9, $CD, $D1, $D4,	$D8, $DB, $DE
00001C5E 00E1 00E4 00E7 00EA 00EC+  		dc.w $E1, $E4, $E7, $EA, $EC, $EE, $F1,	$F3, $F4, $F6
00001C72 00F8 00F9 00FB 00FC 00FD+  		dc.w $F8, $F9, $FB, $FC, $FD, $FE, $FE,	$FF, $FF, $FF
00001C86                            		even
00001C86                            		
00001C86                            		
00001C86                            		include	"engine/subs/joypads.asm"
00001C86                            ; ====================================================================
00001C86                            ; ---------------------------------------------
00001C86                            ; Pads_Init
00001C86                            ;
00001C86                            ; Init joypads
00001C86                            ; ---------------------------------------------
00001C86                            
00001C86                            		rsreset
00001C86 =00000000                  CtrlID		rs.b	1
00001C86 =00000001                  FightPad	rs.b	1
00001C86 =00000002                  ExOnHold	rs.b	1		;MYXZ
00001C86 =00000003                  OnHold		rs.b	1		;SACBRLDU
00001C86 =00000004                  ExOnPress	rs.b	1
00001C86 =00000005                  OnPress		rs.b	1
00001C86 =00000010                  Port2		equ	$10
00001C86                            
00001C86 =00000003                  MousePress	equ	3
00001C86 =00000004                  MouseX		equ	4
00001C86 =00000005                  MouseY		equ	5
00001C86                            
00001C86 =00000001                  JoyUp		equ	%00000001
00001C86 =00000002                  JoyDown		equ	%00000010
00001C86 =00000004                  JoyLeft		equ	%00000100
00001C86 =00000008                  JoyRight	equ	%00001000
00001C86 =00000010                  JoyB		equ	%00010000
00001C86 =00000020                  JoyC		equ	%00100000
00001C86 =00000040                  JoyA		equ	%01000000
00001C86 =00000080                  JoyStart	equ	%10000000
00001C86 =00000000                  bitJoyUp	equ	0
00001C86 =00000001                  bitJoyDown	equ	1
00001C86 =00000002                  bitJoyLeft	equ	2
00001C86 =00000003                  bitJoyRight	equ	3
00001C86 =00000004                  bitJoyB		equ	4
00001C86 =00000005                  bitJoyC		equ	5
00001C86 =00000006                  bitJoyA		equ	6
00001C86 =00000007                  bitJoyStart	equ	7
00001C86                            
00001C86 =00000001                  JoyZ		equ	%00000001
00001C86 =00000002                  JoyY		equ	%00000010
00001C86 =00000004                  JoyX		equ	%00000100
00001C86 =00000008                  JoyMode		equ	%00001000
00001C86 =00000000                  bitJoyZ		equ	0
00001C86 =00000001                  bitJoyY		equ	1
00001C86 =00000002                  bitJoyX		equ	2
00001C86 =00000003                  bitJoyMode	equ	3
00001C86                            
00001C86                            ; --------------------------------------------
00001C86                            ; Pads_Init
00001C86                            ; --------------------------------------------
00001C86                            
00001C86                            Pads_Init:
00001C86 33FC 0100 00A1 1100        		move.w	#$100,($A11100)
00001C8E 33FC 0100 00A1 1200        		move.w	#$100,($A11200)
00001C96                            @WaitZ80:
00001C96 0839 0000 00A1 1100        		btst	#0,($A11100)
00001C9E 66F6                        		bne.s	@WaitZ80
00001CA0                             
00001CA0 7240                       		moveq	#$40,d1
00001CA2 13C1 00A1 0009             		move.b	d1,($A10009).l
00001CA8 13C1 00A1 000B             		move.b	d1,($A1000B).l
00001CAE 13C1 00A1 000D             		move.b	d1,($A1000D).l
00001CB4                            
00001CB4 33FC 0000 00A1 1100        		move.w	#0,($A11100).l
00001CBC 4E75                       		rts
00001CBE                            
00001CBE                            ; --------------------------------------------
00001CBE                            ; Pads_Read
00001CBE                            ; --------------------------------------------
00001CBE                            
00001CBE                            Pads_Read:
00001CBE 33FC 0100 00A1 1100        		move.w	#$100,($A11100)
00001CC6 33FC 0100 00A1 1200        		move.w	#$100,($A11200)
00001CCE                            @WaitZ80:
00001CCE 0839 0000 00A1 1100        		btst	#0,($A11100)
00001CD6 66F6                        		bne.s	@WaitZ80
00001CD8                            
00001CD8 43F9 FFFF D00A             		lea	(RAM_Joypads),a1
00001CDE 7000                       		moveq	#0,d0
00001CE0 6100                       		bsr.s	@DoIt
00001CE2 43F9 FFFF D01A             		lea	(RAM_Joypads+Port2),a1
00001CE8 7001                       		moveq	#1,d0
00001CEA 6100                       		bsr.s	@DoIt
00001CEC                            
00001CEC 33FC 0000 00A1 1100        		move.w	#0,($A11100).l
00001CF4 4E75                       		rts
00001CF6                            
00001CF6                            ; ---------------------------------------
00001CF6                            
00001CF6                            @DoIt:
00001CF6 41F9 00A1 0003             		lea	($A10003).l,a0
00001CFC D040                       		add.w	d0,d0			;1+1=2
00001CFE D0C0                       		add.w	d0,a0			;Add result to port
00001D00 6100 0000                  		bsr	@FindJoypad
00001D04 1280                       		move.b	d0,(a1)
00001D06                            
00001D06 0C00 000F                                  cmp.b	#$F,d0
00001D0A 6700 0000                                  beq	@End
00001D0E 0C00 000D                  		cmp.b	#$D,d0
00001D12 6700 0000                                  beq	@Controller
00001D16 0C00 0007                    		cmp.b	#7,d0
00001D1A 6700 0000                                  beq	@Multitap
00001D1E 0C00 0003                  		cmp.b	#3,d0
00001D22 6700 0000                                  beq	@Mouse
00001D26                            
00001D26                            @End:
00001D26 4E75                       		rts
00001D28                            
00001D28                            ; ------------------------------------
00001D28                            ; Controller
00001D28                            ; ------------------------------------
00001D28                            
00001D28                            @Controller:
00001D28 117C 0040 0006             		move.b	#$40,6(a0)
00001D2E 4E71                       		nop
00001D30 4E71                       		nop
00001D32 10BC 0040                  		move.b	#$40,(a0)		; Show CB|RLDU
00001D36 4E71                       		nop
00001D38 4E71                       		nop
00001D3A 10BC 0000                  		move.b	#$00,(a0)		; Show SA|RLDU
00001D3E 4E71                       		nop
00001D40 4E71                       		nop
00001D42 10BC 0040                  		move.b	#$40,(a0)		; Show CB|RLDU
00001D46 4E71                       		nop
00001D48 4E71                       		nop
00001D4A 10BC 0000                  		move.b	#$00,(a0)		; Show SA|RLDU
00001D4E 4E71                       		nop
00001D50 4E71                       		nop
00001D52 10BC 0040                  		move.b	#$40,(a0)		; "Okay OKAY!, I have more buttons"
00001D56 4E71                       		nop
00001D58 4E71                       		nop
00001D5A 1010                       		move.b	(a0),d0
00001D5C 10BC 0000                   		move.b	#$00,(a0)		; "Heres my ID"
00001D60 4E71                         		nop
00001D62 4E71                         		nop
00001D64 1210                        		move.b	(a0),d1
00001D66 10BC 0040                   		move.b	#$40,(a0)
00001D6A 4E71                        		nop
00001D6C 4E71                        		nop
00001D6E                            		
00001D6E 7400                       		moveq	#0,d2
00001D70 0241 000F                  		and.w	#$F,d1
00001D74 0C41 000F                  		cmp.w	#$F,d1
00001D78 6600                       		bne.s	@Original
00001D7A                            		
00001D7A 7401                       		moveq	#1,d2
00001D7C 7200                        		moveq	#0,d1
00001D7E 1229 0002                   		move.b	ExOnHold(a1),d1
00001D82 4601                       		not.b	d1
00001D84                            ;  		and.w	#$F,d2
00001D84                            ;  		move.b	d2,d1
00001D84 B101                        		eor.b	d0,d1
00001D86                            ;  		move.b	d0,d2
00001D86 C200                        		and.b	d0,d1
00001D88 0241 000F                   		and.w	#$F,d1
00001D8C 1341 0004                   		move.b	d1,ExOnPress(a1)
00001D90                            ;  		move.b	d2,d0
00001D90 4600                        		not.b	d0
00001D92 0240 000F                   		and.w	#$F,d0
00001D96 1340 0002                   		move.b	d0,ExOnHold(a1)
00001D9A                             		
00001D9A                            @Original:	
00001D9A 1342 0001                  		move.b	d2,FightPad(a1)
00001D9E                            	
00001D9E 10BC 0000                  		move.b	#0,(a0)
00001DA2 4E71                       		nop
00001DA4 4E71                       		nop
00001DA6 1010                       		move.b	(a0),d0
00001DA8 E508                       		lsl.b	#2,d0
00001DAA 0200 00C0                  		and.b	#$C0,d0	
00001DAE 10BC 0040                  		move.b	#$40,(a0)
00001DB2 4E71                       		nop
00001DB4 4E71                       		nop
00001DB6 1210                       		move.b	(a0),d1
00001DB8 0201 003F                  		and.b	#$3F,d1
00001DBC 8001                       		or.b	d1,d0
00001DBE 4600                       		not.b	d0
00001DC0 1229 0003                  		move.b	OnHold(a1),d1
00001DC4 B101                       		eor.b	d0,d1
00001DC6 1340 0003                  		move.b	d0,OnHold(a1)
00001DCA C200                       		and.b	d0,d1
00001DCC 1341 0005                  		move.b	d1,OnPress(a1)
00001DD0 4E75                       		rts
00001DD2                            
00001DD2                            ; ------------------------------------
00001DD2                            ; Multitap
00001DD2                            ; ------------------------------------
00001DD2                            
00001DD2                            @Multitap:
00001DD2 6000 FF52                  		bra	@End
00001DD6                            
00001DD6                            ; ------------------------------------
00001DD6                            ; Sega Mega Mouse
00001DD6                            ;
00001DD6                            ; in: d1 - port number
00001DD6                            ; out: d0 - status
00001DD6                            ;      d2
00001DD6                            ; ------------------------------------
00001DD6                            
00001DD6                            @Mouse:
00001DD6 7200                       		moveq	#0,d1
00001DD8 6100 0000                  		bsr	@ReadIt
00001DDC 2342 0002                  		move.l	d2,2(a1)
00001DE0 6000 FF44                  		bra	@End
00001DE4                            
00001DE4                            @ReadIt:
00001DE4 48E7 5980                  		movem.l	d1/d3/d4/d7/a0,-(sp)
00001DE8                            
00001DE8 7000                       		moveq	#0,d0			;Error flag
00001DEA 0C41 0002                  		cmp.w	#2,d1			;Control ID < 2?
00001DEE 6200 0000                  		bhi	@Error
00001DF2 D241                       		add.w	d1,d1
00001DF4                            	;	lea	($A10003),a0
00001DF4                            @Connect:
00001DF4 117C 0060 0006             		move.b	#$60,6(a0)
00001DFA 4E71                                       nop
00001DFC 4E71                                       nop
00001DFE 10BC 0060                                  move.b	#$60,(a0)		;TH,TR=11 (END DATA)
00001E02 7400                                       moveq	#0,d2
00001E04 7600                                       moveq	#0,d3
00001E06                            @NotReady:
00001E06 0810 0004                   		btst	#4,(a0)
00001E0A 67FA                        		beq.s	@NotReady
00001E0C 1810                        		move.b	(a0),d4			;d4.b = ? 1 1 1 | 0 0 0
00001E0E 0204 000F                   		and.b	#$F,d4
00001E12 4A04                        		tst.b	d4
00001E14 6600 0000                   		bne	@Error			;No mouse
00001E18 10BC 0020                   		move.b	#$20,(a0)		;Select t1 m1 1 1
00001E1C 3E3C 00FE                   		move.w	#$FE,d7
00001E20                            @lp1:
00001E20 0810 0004                  		btst.b	#4,(a0)
00001E24 6600                       		bne.s	@Mouse_10
00001E26 51CF FFF8                  		dbra	d7,@lp1
00001E2A 6000 0000                  		bra	@Error
00001E2E                            		
00001E2E                            @Mouse_10:
00001E2E 1010                       		move.b	(a0),d0			;d0 = xxxx|xxxx|xxxx|t1 m1 1 1
00001E30 E148                       		lsl.w	#8,d0			;d0 = xxxx|t1 m1 1 1|0000|0000
00001E32 10BC 0000                  		move.b	#0,(a0)
00001E36 4E71                       		nop
00001E38                            @lp2:
00001E38 0810 0004                  		btst	#4,(a0)
00001E3C 6700                       		beq.s	@Mouse_20
00001E3E 51CF FFF8                  		dbra	d7,@lp2
00001E42 6000 0000                  		bra	@Error
00001E46                            		
00001E46                            @Mouse_20:
00001E46 1610                       		move.b	(a0),d3
00001E48 10BC 0020                  		move.b	#$20,(a0)
00001E4C E14B                       		lsl.w	#8,d3
00001E4E                            @lp3:
00001E4E 0810 0004                  		btst	#4,(a0)
00001E52 6600                       		bne.s	@Mouse_30
00001E54 51CF FFF8                  		dbra	d7,@lp3
00001E58 6000 0000                  		bra	@Error
00001E5C                            		
00001E5C                            @Mouse_30:
00001E5C 1610                       		move.b	(a0),d3
00001E5E E90B                       		lsl.b	#4,d3
00001E60 E84B                       		lsr.w	#4,d3
00001E62 10BC 0000                  		move.b	#0,(a0)
00001E66 8043                       		or.w	d3,d0
00001E68 7600                       		moveq	#0,d3
00001E6A                            @lp4:
00001E6A 0810 0004                  		btst	#4,(a0)
00001E6E 6700                                       beq.s	@Mouse_40
00001E70 51CF FFF8                                  dbra	d7,@lp4
00001E74 6000 0000                                  bra	@Error
00001E78                            
00001E78                            @Mouse_40:
00001E78 1410                       		move.b	(a0),d2
00001E7A 10BC 0020                  		move.b	#$20,(a0)
00001E7E E14A                       		lsl.w	#8,d2
00001E80                            @lp5:
00001E80 0810 0004                  		btst	#4,(a0)
00001E84 6600                       		bne.s	@Mouse_50
00001E86 51CF FFF8                  		dbra	d7,@lp5
00001E8A 6000 0000                  		bra	@Error
00001E8E                            		
00001E8E                            @Mouse_50:
00001E8E 1410                       		move.b	(a0),d2
00001E90 10BC 0000                  		move.b	#0,(a0)
00001E94 E90A                       		lsl.b	#4,d2
00001E96 E94A                       		lsl.w	#4,d2
00001E98                            @lp6:
00001E98 0810 0004                  		btst	#4,(a0)
00001E9C 6700                       		beq.s	@Mouse_60
00001E9E 51CF FFF8                  		dbra	d7,@lp6
00001EA2 6000 0000                  		bra	@Error
00001EA6                            
00001EA6                            @Mouse_60:
00001EA6 1410                       		move.b	(a0),d2
00001EA8 10BC 0020                  		move.b	#$20,(a0)
00001EAC E90A                       		lsl.b	#4,d2
00001EAE E98A                       		lsl.l	#4,d2
00001EB0                            @lp7:
00001EB0 0810 0004                  		btst	#4,(a0)
00001EB4 6600                       		bne.s	@Mouse_70
00001EB6 51CF FFF8                  		dbra	d7,@lp7
00001EBA 6000                       		bra.s	@Error
00001EBC                            
00001EBC                            @Mouse_70:
00001EBC 1410                       		move.b	(a0),d2
00001EBE 10BC 0000                  		move.b	#0,(a0)
00001EC2 E90A                       		lsl.b	#4,d2
00001EC4 E98A                       		lsl.l	#4,d2
00001EC6                            @lp8:
00001EC6 0810 0004                  		btst	#4,(a0)
00001ECA 6700                       		beq.s	@Mouse_80
00001ECC 51CF 0000                  		dbra	d7,@Mouse_80
00001ED0 6000                       		bra.s	@Error
00001ED2                            
00001ED2                            @Mouse_80:
00001ED2 1410                       		move.b	(a0),d2
00001ED4 10BC 0020                  		move.b	#$20,(a0)
00001ED8 E90A                       		lsl.b	#4,d2
00001EDA E98A                       		lsl.l	#4,d2
00001EDC                            @lp9:
00001EDC 0810 0004                  		btst	#4,(a0)
00001EE0 6700                       		beq.s	@Mouse_90
00001EE2 51CF FFF8                  		dbra	d7,@lp9
00001EE6 6000                       		bra.s	@Error
00001EE8                            
00001EE8                            @Mouse_90:
00001EE8 1410                       		move.b	(a0),d2
00001EEA 10BC 0060                  		move.b	#$60,(a0)
00001EEE E90A                       		lsl.b	#4,d2
00001EF0 E88A                       		lsr.l	#4,d2
00001EF2                            @lp10:
00001EF2 0810 0004                  		btst	#4,(a0)
00001EF6 67FA                       		beq.s	@lp10
00001EF8 0082 0000 0000             		or.l	#0,d2
00001EFE                            @Exit:
00001EFE 33FC 0000 00A1 1100        		move.w	#0,($A11100)
00001F06 4CDF 019A                  		movem.l	(sp)+,d1/d3/d4/d7/a0
00001F0A 4E75                       		rts
00001F0C                            
00001F0C                            @Error:
00001F0C 10BC 0060                  		move.b	#$60,(a0)
00001F10 4E71                       		nop
00001F12 4E71                       		nop
00001F14                            @erlp:
00001F14 10BC 0004                  		move.b	#4,(a0)
00001F18 67FA                       		beq.s	@erlp
00001F1A 0082 8000 0000             		or.l	#$80000000,d2
00001F20 7000                       		moveq	#0,d0
00001F22 33FC 0000 00A1 1100        		move.w	#0,($A11100)
00001F2A 4CDF 019A                  		movem.l	(sp)+,d1/d3/d4/d7/a0
00001F2E 4E75                       		rts
00001F30                            
00001F30                            ; ------------------------------------
00001F30                            ; d0.w
00001F30                            ; $0F - Nothing
00001F30                            ; $0D - Controller
00001F30                            ; $07 - Multitap
00001F30                            ; $03 - Mouse
00001F30                            ;
00001F30                            ; d1.l
00001F30                            ; $00xx00yy - Key presses
00001F30                            ; ------------------------------------
00001F30                            
00001F30                            @FindJoypad:
00001F30 7000                       		moveq	#0,d0
00001F32 10BC 0070                  		move.b	#$70,(a0)
00001F36 6100                       		bsr.s	@GetPress
00001F38 4841                       		swap	d1
00001F3A 10BC 0030                  		move.b	#$30,(a0)
00001F3E D040                       		add.w	d0,d0
00001F40                            
00001F40                            @GetPress:
00001F40 1210                       		move.b	(a0),d1
00001F42 1401                       		move.b	d1,d2
00001F44 0202 000C                  		and.b	#$C,d2
00001F48 6700                       		beq.s	@Nope1
00001F4A 5240                       		addq.w	#1,d0
00001F4C                            
00001F4C                            @Nope1:
00001F4C D040                       		add.w	d0,d0
00001F4E 1601                       		move.b	d1,d3
00001F50 0243 0003                  		and.w	#3,d3
00001F54 6700                       		beq.s	@Nope2
00001F56 5240                       		addq.w	#1,d0
00001F58                            
00001F58                            @Nope2:
00001F58 4E75                       		rts
00001F58 4E75                       		rts
00001F5A                            		include	"engine/subs/dma.asm"
00001F5A                            ; =====================================================================================
00001F5A                            ; DMA
00001F5A                            ; =====================================================================================
00001F5A                            
00001F5A                            ; -----------------------------------
00001F5A                            ; Read
00001F5A                            ; -----------------------------------
00001F5A                            
00001F5A                            DMA_Read:
00001F5A 43F9 FFFF D48A             		lea	(RAM_DMA_Buffer),a1
00001F60 D2F9 FFFF D886             		adda	(RAM_DMA_Buffer+(sizeof_dmabuff-4)),a1
00001F66                            @Next:
00001F66 4A51                       		tst.w	(a1)
00001F68 6700                       		beq.s	@EndRead
00001F6A                            		
00001F6A 34BC 8174                  		move.w	#$8174,(a2)
00001F6E                            
00001F6E 2499                       		move.l	(a1)+,(a2)
00001F70 2499                       		move.l	(a1)+,(a2)
00001F72 3499                       		move.w	(a1)+,(a2)
00001F74 3A19                       		move.w	(a1)+,d5
00001F76 EB4D                       		lsl.w	#5,d5
00001F78 0285 0000 FFFF             		and.l	#$FFFF,d5
00001F7E E58D                       		lsl.l	#2,d5
00001F80 E44D                       		lsr.w	#2,d5
00001F82 4845                       		swap	d5
00001F84 0085 4000 0080             		ori.l	#$40000080,d5
00001F8A 2485                       		move.l	d5,(a2)
00001F8C                            		
00001F8C 60D8                       		bra.s	@Next
00001F8E                            
00001F8E                            @EndRead:
00001F8E 34BC 8164                  		move.w	#$8164,(a2)
00001F92 4E75                       		rts
00001F94                            
00001F94                            ; -----------------------------------
00001F94                            ; Set new
00001F94                            ; -----------------------------------
00001F94                            
00001F94                            DMA_Set:
00001F94 47F9 FFFF D48A             		lea	(RAM_DMA_Buffer),a3
00001F9A D6F9 FFFF D886             		adda	(RAM_DMA_Buffer+(sizeof_dmabuff-4)),a3
00001FA0                            
00001FA0 303C 9300                  		move.w	#$9300,d0
00001FA4 1003                       		move.b	d3,d0
00001FA6 36C0                       		move.w	d0,(a3)+
00001FA8 303C 9400                  		move.w	#$9400,d0
00001FAC E04B                       		lsr.w	#8,d3
00001FAE 1003                       		move.b	d3,d0
00001FB0 36C0                       		move.w	d0,(a3)+
00001FB2                            
00001FB2                            		
00001FB2 303C 9500                  		move.w	#$9500,d0
00001FB6 E28A                       		lsr.l	#1,d2
00001FB8 1002                       		move.b	d2,d0
00001FBA 36C0                       		move.w	d0,(a3)+
00001FBC 303C 9600                  		move.w	#$9600,d0
00001FC0 E08A                       		lsr.l	#8,d2
00001FC2 1002                       		move.b	d2,d0
00001FC4 36C0                       		move.w	d0,(a3)+
00001FC6 303C 9700                  		move.w	#$9700,d0
00001FCA E08A                       		lsr.l	#8,d2
00001FCC 1002                       		move.b	d2,d0
00001FCE 36C0                       		move.w	d0,(a3)+
00001FD0 36C4                       		move.w	d4,(a3)+
00001FD2                            
00001FD2 33CB FFFF D886             		move.w	a3,(RAM_DMA_Buffer+(sizeof_dmabuff-4))
00001FD8 B7FC FFFF D684             		cmpa.l	#RAM_DMA_Buffer+$1FA,a3
00001FDE 6E00                       		bgt.s	@Free
00001FE0 36BC 0000                  		move.w	#0,(a3)		
00001FE4                            @Free:		
00001FE4 0479 D48A FFFF D886        		sub.w	#(RAM_DMA_Buffer&$FFFF),(RAM_DMA_Buffer+(sizeof_dmabuff-4))
00001FEC                            		
00001FEC                            @Return:
00001FEC 4E75                       		rts
00001FEE                            
00001FEE                            ; -----------------------------------
00001FEE                            ; Reset
00001FEE                            ; -----------------------------------
00001FEE                            
00001FEE                            DMA_Reset:
00001FEE 4279 FFFF D886             		clr.w	(RAM_DMA_Buffer+(sizeof_dmabuff-4))
00001FF4 34BC 8164                  		move.w	#$8164,(a2)
00001FF8 4E75                       		rts
00001FFA                            
00001FFA                            ; -----------------------------------
00001FFA                            ; Quick set
00001FFA                            ; 
00001FFA                            ; d0 - Destiantion
00001FFA                            ; d1 - Source
00001FFA                            ; d2 - Size
00001FFA                            ; -----------------------------------
00001FFA                            
00001FFA                            DMA_QuickSet:
00001FFA 48E7 0060                  		movem.l	a1-a2,-(sp)
00001FFE 2241                       		move.l	d1,a1
00002000                            ;  		addq.l	#2,d1
00002000 E281                       		asr.l	#1,d1
00002002 45F9 00C0 0004              		lea	($C00004).l,a2
00002008 34BC 8F02                  		move.w	#$8F02,(a2)
0000200C 363C 8164                  		move.w	#$8164,d3
00002010 08C3 0004                  		bset	#4,d3
00002014 3483                       		move.w	d3,(a2)
00002016 263C 0094 0000             		move.l	#$940000,d3
0000201C 3602                       		move.w	d2,d3
0000201E E18B                       		lsl.l	#8,d3
00002020 363C 9300                  		move.w	#$9300,d3
00002024 1602                       		move.b	d2,d3
00002026 2483                       		move.l	d3,(a2)
00002028 263C 0096 0000             		move.l	#$960000,d3
0000202E 3601                       		move.w	d1,d3
00002030 E18B                       		lsl.l	#8,d3
00002032 363C 9500                  		move.w	#$9500,d3
00002036 1601                       		move.b	d1,d3
00002038 2483                       		move.l	d3,(a2)
0000203A 4841                       		swap	d1
0000203C 363C 9700                  		move.w	#$9700,d3
00002040 1601                       		move.b	d1,d3
00002042 3483                       		move.w	d3,(a2)
00002044 0080 4000 0080             		or.l	#$40000080,d0
0000204A 4840                       		swap	d0
0000204C 3480                       		move.w	d0,(a2)
0000204E 4840                       		swap	d0
00002050 3F00                       		move.w	d0,-(sp)
00002052 349F                       		move.w	(sp)+,(a2)
00002054 34BC 8164                  		move.w	#$8164,(a2)
00002058 0240 FF7F                  		and.w	#$FF7F,d0
0000205C 2480                       		move.l	d0,(a2)
0000205E 2551 FFFC                  		move.l	(a1),-4(a2)
00002062 34BC 8F02                  		move.w	#$8F02,(a2)
00002066 4CDF 0600                  		movem.l	(sp)+,a1-a2
0000206A 4E75                       		rts
0000206C                            		
0000206C                            ; -----------------------------------
0000206C                            ; Wait DMA
0000206C                            ; -----------------------------------
0000206C                            
0000206C                            DMA_Wait:
0000206C 3039 00C0 0004             		move.w	($C00004),d0
00002072 0800 0001                  		btst	#1,d0
00002076 66F4                       		bne.s	DMA_Wait
00002078 4E75                       		rts		
0000207A                            
0000207A                            
0000207A                                            include	"engine/ints.asm"
0000207A                            ; ====================================================================
0000207A                            ; -------------------------------------------------
0000207A                            ; VBlank
0000207A                            ; 
0000207A                            ; all registers available
0000207A                            ; -------------------------------------------------
0000207A                            
0000207A                            MD_Vint:
0000207A 4AB9 FFFF D000             		tst.l	(RAM_VIntAddr)
00002080 6700                       		beq.s	@NoVIntEx
00002082                            		
00002082 48E7 FFFE                  		movem.l	a0-a6/d0-d7,-(sp)
00002086 2079 FFFF D000             		movea.l	(RAM_VIntAddr),a0
0000208C 4E90                       		jsr	(a0)
0000208E 4CDF 7FFF                  		movem.l	(sp)+,a0-a6/d0-d7
00002092                            @NoVIntEx:
00002092 08F9 0001 FFFF D008        		bset	#1,(RAM_VIntWait)
0000209A 08B9 0000 FFFF D008        		bclr	#bitFrameWait,(RAM_VIntWait)
000020A2 4E73                       		rte
000020A4                            
000020A4                            ; ====================================================================
000020A4                            ; -------------------------------------------------
000020A4                            ; HBlank
000020A4                            ; 
000020A4                            ; ONLY available registers:
000020A4                            ; a0-a3
000020A4                            ; d0-d4
000020A4                            ; -------------------------------------------------
000020A4                            
000020A4                            MD_Hint:		
000020A4 4AB9 FFFF D004              		tst.l	(RAM_HIntAddr)
000020AA 6700                        		beq.s	@NoHintEx
000020AC                             		
000020AC 48E7 F8F0                   		movem.l	a0-a3/d0-d4,-(sp)
000020B0 2079 FFFF D004              		movea.l	(RAM_HIntAddr),a0
000020B6 4E90                        		jsr	(a0)
000020B8 4CDF 0F1F                   		movem.l	(sp)+,a0-a3/d0-d4
000020BC                            @NoHintEx:
000020BC 4E73                       		rte
000020BE                            		
000020BE                            ; ====================================================================
000020BE                            ; -------------------------------------------------
000020BE                            ; Separate routines
000020BE                            ; -------------------------------------------------
000020BE                            
000020BE                            VInt_Default:
000020BE 6100 F67E                  		bsr	PalFade
000020C2 6100 FBFA                  		bsr	Pads_Read
000020C6 6100 FE92                  		bsr	DMA_Read
000020CA 6100 0000                  		bsr	SMEG_Upd
000020CE                            			
000020CE 41F9 FFFF E02A             		lea	(RAM_PalBuffer),a0
000020D4 23FC C000 0000 00C0 0004    		move.l	#$C0000000,($C00004).l
000020DE 303C 003F                   		move.w	#$3F,d0
000020E2                            @PalBuf:
000020E2 33D8 00C0 0000             		move.w	(a0)+,($C00000).l
000020E8 51C8 FFF8                   		dbf	d0,@PalBuf
000020EC                            
000020EC 41F9 FFFF DDAA             		lea	(RAM_SprBuffer),a0
000020F2 23FC 7800 0003 00C0 0004   		move.l	#$78000003,($C00004).l
000020FC 303C 009F                  		move.w	#$9F,d0
00002100                            @SprBuf:
00002100 23D8 00C0 0000             		move.l	(a0)+,($C00000).l
00002106 51C8 FFF8                  		dbf	d0,@SprBuf
0000210A                            		
0000210A 41F9 FFFF DD2A             		lea	(RAM_VerBuffer),a0
00002110 23FC 4000 0010 00C0 0004   		move.l	#$40000010,($C00004).l
0000211A 303C 000F                  		move.w	#$F,d0
0000211E                            @VerBuf:
0000211E 23D8 00C0 0000             		move.l	(a0)+,($C00000).l
00002124 51C8 FFF8                  		dbf	d0,@VerBuf
00002128                            
00002128 41F9 FFFF D9AA             		lea	(RAM_HorBuffer),a0
0000212E 23FC 7C00 0003 00C0 0004   		move.l	#$7C000003,($C00004).l
00002138 303C 00DF                  		move.w	#224-1,d0
0000213C                            @HorBuf:
0000213C 23D8 00C0 0000             		move.l	(a0)+,($C00000).l
00002142 51C8 FFF8                  		dbf	d0,@HorBuf
00002146                            
00002146 4E75                       		rts
00002148                            
00002148                            ; -------------------------------------------------
00002148                            
00002148                            Hint_Default:
00002148 4E75                       		rts
00002148 4E75                       		rts
0000214A                                            
0000214A                            ; ====================================================================
0000214A                            ; ---------------------------------------------
0000214A                            ; Code | Modes
0000214A                            ; ---------------------------------------------
0000214A                            
0000214A                            ; 		include	"engine/modes/level/code.asm"
0000214A                            		include	"engine/modes/title/code.asm"
0000214A                            ; =================================================================
0000214A                            ; Title
0000214A                            ; =================================================================
0000214A                            
0000214A                            ; ------------------------------------------------
0000214A                            ; Variables
0000214A                            ; ------------------------------------------------
0000214A                            
0000214A                            		rsreset
0000214A =00000000                  vid_artstart	rs.l	1
0000214A =00000004                  vid_mapstart	rs.l	1
0000214A =00000008                  vid_keystart	rs.l	1
0000214A                            
0000214A =0000000C                  vid_artnext	rs.l	1
0000214A =00000010                  vid_mapnext	rs.l	1
0000214A =00000014                  vid_keynext	rs.l	1
0000214A                            
0000214A =00000018                  vid_vram	rs.l	1		;FBR1FBR2
0000214A =0000001C                  vid_keepframe	rs.l	1
0000214A =00000020                  vid_sound	rs.l 	1
0000214A                            
0000214A =00000024                  vid_rate	rs.w	1
0000214A =00000026                  vid_timer	rs.w	1
0000214A =00000028                  vid_frmswitch	rs.w	1
0000214A =0000002A                  vid_xsize	rs.w	1
0000214A =0000002C                  vid_ysize	rs.w	1
0000214A =0000002E                  vid_dmasize	rs.w	1
0000214A =00000030                  sizeof_vid	rs.l	0
0000214A                            
0000214A                            
0000214A =60000003                  vid_Plane_BG	equ	$60000003
0000214A =70000003                  vid_Plane_FG	equ	$70000003
0000214A                            
0000214A                            ; ------------------------------------------------
0000214A                            ; RAM
0000214A                            ; ------------------------------------------------
0000214A                            
0000214A                            		rsset	RAM_ModeBuffer
0000214A =FFFFA000                  RAM_FullMotVid	rs.b	sizeof_vid
0000214A                            
0000214A                            ; =================================================================
0000214A                            ; ------------------------------------------------
0000214A                            ; Init
0000214A                            ; ------------------------------------------------
0000214A                            
0000214A                            mode_Title:
0000214A 203C 0100 0000             		move.l	#ID_FadeOut,d0
00002150 223C 003F 0001              		move.l	#$003F0001,d1
00002156 6100 F7E0                   		bsr	PalFade_Set
0000215A 6100 F800                   		bsr	PalFade_Wait
0000215E                            
0000215E 46FC 2700                  		move.w	#$2700,sr
00002162                            		
00002162                            ; -----------------------------------
00002162                            ; Cleanup
00002162                            ; -----------------------------------
00002162                            
00002162 6100 F306                  		bsr	Vdp_ClearPlanes
00002166 6100 F812                  		bsr	Mode_Cleanup
0000216A                            		
0000216A                            ; -----------------------------------
0000216A                            ; Init stuff
0000216A                            ; -----------------------------------
0000216A                            
0000216A 23FC 0000 20BE FFFF D000   		move.l	#VInt_Default,(RAM_VIntAddr)
00002174 23FC 0000 2148 FFFF D004   		move.l	#Hint_Default,(RAM_HIntAddr)
0000217E 41F9 FFFF EBAA             		lea	(RAM_VdpRegs),a0
00002184 117C 0000 000C             		move.b	#vdp_H32,vdpReg_HMode(a0)
0000218A 117C 0000 0010             		move.b	#0,vdpReg_PlnSize(a0)
00002190 6100 F516                  		bsr	Vdp_Update
00002194                            		
00002194                            ; -----------------------------------
00002194                            		
00002194                            ;                 moveq	#0,d0
00002194                            ;                 move.l	(RAM_Joypads),d0
00002194                            ;                 move.l	#vid_Plane_BG,d1
00002194                            ;                 move.w	#$8000,d2
00002194                            ;                bsr	VDP_ShowVal_Long
00002194                                           
00002194 41FA 0000                    		lea	Art_TempFont(pc),a0
00002198 303C 0320                    		move.w	#$320,d0
0000219C 323C 0000                    		move.w	#((Art_TempFont_End-Art_TempFont)/4)-1,d1
000021A0 6100 F338                    		bsr	VDP_SendData_L
000021A4                              		
000021A4 41F9 0000 0000               		lea	(Vid_Data),a0
000021AA 303C 0002                    		move.w	#2,d0
000021AE 323C 0001                    		move.w	#$001,d1
000021B2 343C 0200                    		move.w	#$200,d2
000021B6 6100 0000                    		bsr	MegaVid_Load
000021BA                              		
000021BA                            ; 		lea	(Map_Title),a0
000021BA                            ; 		move.l	#Plane_BG,d0
000021BA                            ; 		move.w	#(256/8)-1,d1
000021BA                            ; 		move.w	#((224/4)/8)-1,d2
000021BA                            ; 		moveq	#0,d3
000021BA                            ; 		moveq	#0,d4
000021BA                            ; 		bsr	MegaVid_LoadMaps
000021BA                            ; 		lea	(Map_Title),a0
000021BA                            ; 		move.l	#Plane_BG+(vdp_Ypos_32*7),d0
000021BA                            ; 		move.w	#(256/8)-1,d1
000021BA                            ; 		move.w	#((224/4)/8)-1,d2
000021BA                            ; 		move.w	#($E0)+$2000+1,d3
000021BA                            ; 		moveq	#0,d4
000021BA                            ; 		bsr	MegaVid_LoadMaps
000021BA                            ; 		lea	(Map_Title),a0
000021BA                            ; 		move.l	#Plane_BG+(vdp_Ypos_32*(7*2)),d0
000021BA                            ; 		move.w	#(256/8)-1,d1
000021BA                            ; 		move.w	#((224/4)/8)-1,d2
000021BA                            ; 		move.w	#($E0*2)+$4000+2,d3
000021BA                            ; 		moveq	#0,d4
000021BA                            ; 		bsr	MegaVid_LoadMaps
000021BA                            ; 		lea	(Map_Title),a0
000021BA                            ; 		move.l	#Plane_BG+(vdp_Ypos_32*(7*3)),d0
000021BA                            ; 		move.w	#(256/8)-1,d1
000021BA                            ; 		move.w	#((224/4)/8)-1,d2
000021BA                            ; 		move.w	#($E0*3)+$6000+3,d3
000021BA                            ; 		moveq	#0,d4
000021BA                            ; 		bsr	MegaVid_LoadMaps
000021BA                            ; 		
000021BA                            ; 		lea	(Art_Title),a0
000021BA                            ; 		move.w	#0,d0
000021BA                            ; 		move.w	#((Art_Title_End-Art_Title)/4)-1,d1
000021BA                            ; 		bsr	VDP_SendData_L
000021BA 41F9 0000 0000              		lea	(Pal_Title),a0
000021C0 43F9 FFFF D8AA                		lea	(RAM_PalFadeBuff),a1
000021C6 7000                          		moveq	#((Pal_Title_End-Pal_Title)/2)-1,d0
000021C8 6100 F7FA                     		bsr	LoadData_Word
000021CC                              		
000021CC                            ;          	move.l	#TestSong,d0
000021CC                            ;           	moveq	#2,d1
000021CC                            ;           	bsr	Smeg_LoadSong
000021CC                                   		
000021CC                            ; -----------------------------------
000021CC                             		
000021CC 46FC 2000                  		move.w	#$2000,sr
000021D0                            		
000021D0 203C 0200 0000             		move.l	#ID_FadeIn,d0
000021D6 223C 003F 0001             		move.l	#$003F0001,d1
000021DC 6100 F75A                  		bsr	PalFade_Set
000021E0 6100 F77A                  		bsr	PalFade_Wait
000021E4                            		
000021E4                            ; =================================================================
000021E4                            ; ------------------------------------------------
000021E4                            ; Loop
000021E4                            ; ------------------------------------------------
000021E4                            
000021E4                            Title_Loop:
000021E4 6100 F4E4                  		bsr	VSync
000021E8 6100 0000                    		bsr	MegaVid_Run
000021EC                            		
000021EC                            ;                 moveq	#0,d0
000021EC                            ;                 move.l	(RAM_Joypads),d0
000021EC                            ;                 move.l	#Plane_FG,d1
000021EC                            ;                 move.w	#$8560+"0"+$6000,d2
000021EC                            ;                 bsr	VDP_ShowVal_Long
000021EC                            ;                 moveq	#0,d0
000021EC                            ;                 move.l	(RAM_Joypads+4),d0
000021EC                            ;                 move.l	#Plane_FG+(vdp_Xpos*8),d1
000021EC                            ;                 move.w	#$8560+"0"+$6000,d2
000021EC                            ;                 bsr	VDP_ShowVal_Long
000021EC                                            
000021EC                            ;  		btst	#bitJoyStart,(RAM_Joypads+OnPress)
000021EC                            ;  		beq.s	@keep
000021EC                            ;  		move.b	#1,(RAM_GameMode)
000021EC                            ; 		rts	
000021EC                            ; @keep:
000021EC 6000 FFF6                  		bra	Title_Loop
000021F0                            		
000021F0                            ; =================================================================
000021F0                            ; ------------------------------------------------
000021F0                            ; Subs
000021F0                            ; ------------------------------------------------
000021F0                            		
000021F0                            MegaVid_Load:
000021F0 4DF9 FFFF A000             		lea	(RAM_FullMotVid),a6
000021F6 3D40 0024                  		move.w 	d0,vid_rate(a6)
000021FA 3D41 0018                  		move.w	d1,vid_vram(a6)
000021FE 3D42 001A                  		move.w	d2,vid_vram+2(a6)
00002202                            		
00002202 2258                       		movea.l	(a0)+,a1
00002204 2018                        		move.l	(a0)+,d0
00002206 2D40 0000                   		move.l	d0,vid_artstart(a6)
0000220A 2D40 000C                   		move.l	d0,vid_artnext(a6)
0000220E 2018                        		move.l	(a0)+,d0
00002210 2D40 0004                   		move.l	d0,vid_mapstart(a6)
00002214 2D40 0010                   		move.l	d0,vid_mapnext(a6)
00002218 D0FC 0004                    		adda 	#4,a0			;later for dynpalette
0000221C                              		
0000221C 2011                         		move.l	(a1),d0
0000221E 3D69 0006 002A               		move.w	6(a1),vid_xsize(a6)
00002224 3D69 0008 002C               		move.w	8(a1),vid_ysize(a6)
0000222A D2FC 0010                    		adda 	#$10,a1
0000222E 2D49 0008                   		move.l	a1,vid_keystart(a6)
00002232 2D49 0014                   		move.l	a1,vid_keynext(a6)
00002236                            		
00002236 7400                       		moveq	#0,d2
00002238 2429 0008                      		move.l	8(a1),d2
0000223C E94A                           		lsl.w	#4,d2
0000223E 302E 0018                    		move.w	vid_vram(a6),d0
00002242 6100 F2AC                    		bsr	VDP_VramAddr
00002246 222E 000C                   		move.l	vid_artnext(a6),d1
0000224A 6100 0000                   		bsr	MegaVid_LoadDmaArt
0000224E                            
0000224E 226E 0014                      		movea.l	vid_keynext(a6),a1
00002252 2029 000C                      		move.l	$C(a1),d0
00002256 E348                           		lsl.w	#1,d0
00002258 3D40 001C                      		move.w	d0,vid_keepframe(a6)
0000225C 206E 0010                   		movea.l	vid_mapnext(a6),a0
00002260 203C 6000 0003               		move.l	#vid_Plane_BG,d0
00002266 322E 002A                    		move.w	vid_xsize(a6),d1
0000226A 342E 002C                    		move.w	vid_ysize(a6),d2
0000226E 362E 0018                    		move.w	vid_vram(a6),d3
00002272                            ;   		add.w	#$8000,d3
00002272 7800                         		moveq	#0,d4
00002274 6100 F396                    		bsr	VDP_LoadMaps
00002278                             		
00002278 41F9 FFFF EBAA             		lea	(RAM_VdpRegs),a0
0000227E                            ;   		move.b	#$38,2(a0)			;Layer A address
0000227E 117C 0081 000C             		move.b	#vdp_H40,vdpReg_HMode(a0)	;H32 mode
00002284 117C 0001 0010             		move.b	#1,vdpReg_PlnSize(a0)		;Plane size: 32x32
0000228A 6100 F41C                  		bsr	Vdp_Update
0000228E                            		
0000228E 6100 0000                    		bsr	MegaVid_PlaySound
00002292 6000 0000                     		bra	MegaVid_Run
00002296                            @Bad:
00002296 4E75                       		rts
00002298                            		
00002298                            ; ------------------------------------------------
00002298                            
00002298                            MegaVid_Run:
00002298 4DF9 FFFF A000             		lea	(RAM_FullMotVid),a6
0000229E 046E 0001 0026             		sub.w	#1,vid_timer(a6)
000022A4 6A00 0000                   		bpl	@wait 
000022A8 3D6E 0024 0026              		move.w	vid_rate(a6),vid_timer(a6)
000022AE                            
000022AE 4A6E 001C                     		tst.w	vid_keepframe(a6)
000022B2 6700 0000                     		beq	@Valid
000022B6 6A00 0000                     		bpl	@CountFrame
000022BA                            @Valid:
000022BA                            
000022BA 226E 0014                   		movea.l	vid_keynext(a6),a1
000022BE                            
000022BE 7400                        		moveq	#0,d2
000022C0 2429 0008                       		move.l	8(a1),d2
000022C4 E94A                            		lsl.w	#4,d2
000022C6 302E 0018                      		move.w	vid_vram(a6),d0
000022CA 4A2E 0028                        		tst.b	vid_frmswitch(a6)
000022CE 6600                             		bne.s	@Fine
000022D0 302E 001A                        		move.w	vid_vram+2(a6),d0
000022D4                            @Fine:
000022D4 6100 F21A                    		bsr	VDP_VramAddr
000022D8 222E 000C                    		move.l	vid_artnext(a6),d1
000022DC 6100 0000                    		bsr	MegaVid_LoadDmaArt
000022E0                             		
000022E0 2029 000C                      		move.l	$C(a1),d0
000022E4 E348                           		lsl.w	#1,d0
000022E6 3D40 001C                      		move.w	d0,vid_keepframe(a6)
000022EA                             	
000022EA 206E 0010                  		movea.l	vid_mapnext(a6),a0
000022EE 203C 6000 0003              		move.l	#vid_Plane_BG,d0
000022F4                            ;     		tst.b	vid_frmswitch(a6)
000022F4                            ;     		bne.s	@Fine3
000022F4                            ;  		move.l	#vid_Plane_BG+(vdp_Xpos*32),d0
000022F4                            ; @Fine3:
000022F4 322E 002A                   		move.w	vid_xsize(a6),d1
000022F8 342E 002C                   		move.w	vid_ysize(a6),d2
000022FC 362E 0018                    		move.w	vid_vram(a6),d3
00002300 4A2E 0028                      		tst.b	vid_frmswitch(a6)
00002304 6600                           		bne.s	@Fine2
00002306 362E 001A                    		move.w	vid_vram+2(a6),d3
0000230A                            @Fine2:
0000230A                            ;   		add.w	#$8000,d3
0000230A 7800                        		moveq	#0,d4
0000230C 6100 F2FE                   		bsr	VDP_LoadMaps
00002310 086E 0000 0028              		bchg	#0,vid_frmswitch(a6)
00002316                             		
00002316                            ;  		moveq	#0,d0
00002316                            ;     		tst.b	vid_frmswitch(a6)
00002316                            ;     		beq.s	@Fine4
00002316                            ;  		move.w	#-$100,d0
00002316                            ; @Fine4:
00002316                            ; 		move.w	d0,(RAM_HorBuffer)
00002316                            ; 		move.w	d0,(RAM_HorBuffer+2)
00002316                            		
00002316 206E 0014                  		movea.l	vid_keynext(a6),a0
0000231A 4A90                        		tst.l	(a0)
0000231C 6A00                        		bpl.s 	@Keep_Play
0000231E                             		
0000231E 2D6E 0000 000C             		move.l	vid_artstart(a6),vid_artnext(a6)
00002324 2D6E 0004 0010             		move.l 	vid_mapstart(a6),vid_mapnext(a6)
0000232A 2D6E 0008 0014             		move.l 	vid_keystart(a6),vid_keynext(a6)
00002330                            ; 		rts
00002330 6000 0000                   		bra	MegaVid_PlaySound
00002334                             		
00002334                            @Keep_Play:
00002334 202E 0000                     		move.l 	vid_artstart(a6),d0
00002338 2228 0004                      		move.l 	4(a0),d1
0000233C D081                           		add.l	d1,d0 
0000233E 2D40 000C                      		move.l	d0,vid_artnext(a6)
00002342                               		
00002342 202E 0004                     		move.l 	vid_mapstart(a6),d0
00002346 2210                          		move.l 	(a0),d1
00002348 D081                          		add.l	d1,d0 
0000234A 2D40 0010                     		move.l	d0,vid_mapnext(a6)
0000234E                             		
0000234E 06AE 0000 0010 0014         		add.l	#$10,vid_keynext(a6)
00002356                            	
00002356                            @CountFrame:
00002356 046E 0001 001C                		sub.w	#1,vid_keepframe(a6)
0000235C                            @Wait:
0000235C 4E75                       		rts
0000235E                            
0000235E                            ; ------------------------------------------------
0000235E                            
0000235E                            ; MegaVid_LoadMaps:
0000235E 1839 FFFF EBBA             		move.b	(RAM_VdpRegs+vdpReg_PlnSize),d4
00002364 0244 0003                   		and.w	#%00000011,d4
00002368 E54C                        		lsl.w	#2,d4
0000236A 4BFA F38A                   		lea	VDP_LineAddr(pc),a5
0000236E 2815                        		move.l	(a5),d4
00002370                            @Y_Loop:
00002370 23C0 00C0 0004             		move.l	d0,($C00004).l		;Set VDP location from d0
00002376 3A01                       		move.w	d1,d5	  		;Move X-pos value to d3
00002378                            @X_Loop:
00002378 3C18                       		move.w	(a0)+,d6
0000237A 0C46 07FF                  		cmp.w	#$7FF,d6
0000237E 6700                       		beq.s 	@cont
00002380 DC43                                       add.w	d3,d6  
00002382                            @cont:
00002382 33C6 00C0 0000                             move.w	d6,($C00000)		;Put data
00002388 51CD FFEE                  		dbf	d5,@X_Loop		;X-pos loop (from d1 to d3)
0000238C D084                       		add.l	d4,d0                   ;Next line
0000238E 51CA FFE0                  		dbf	d2,@Y_Loop		;Y-pos loop
00002392 4E75                       		rts
00002394                            
00002394                            ; -----------------------------------
00002394                            
00002394                            MegaVid_LoadDmaArt:
00002394 48E7 0060                  		movem.l	a1-a2,-(sp)
00002398 2241                       		move.l	d1,a1
0000239A E281                       		asr.l	#1,d1
0000239C 45F9 00C0 0004              		lea	($C00004).l,a2
000023A2 34BC 8F02                  		move.w	#$8F02,(a2)
000023A6 363C 8164                  		move.w	#$8164,d3
000023AA 08C3 0004                  		bset	#4,d3
000023AE 3483                       		move.w	d3,(a2)
000023B0 263C 0094 0000             		move.l	#$940000,d3
000023B6 3602                       		move.w	d2,d3
000023B8 E18B                       		lsl.l	#8,d3
000023BA 363C 9300                  		move.w	#$9300,d3
000023BE 1602                       		move.b	d2,d3
000023C0 2483                       		move.l	d3,(a2)
000023C2 263C 0096 0000             		move.l	#$960000,d3
000023C8 3601                       		move.w	d1,d3
000023CA E18B                       		lsl.l	#8,d3
000023CC 363C 9500                  		move.w	#$9500,d3
000023D0 1601                       		move.b	d1,d3
000023D2 2483                       		move.l	d3,(a2)
000023D4 4841                       		swap	d1
000023D6 363C 9700                  		move.w	#$9700,d3
000023DA 1601                       		move.b	d1,d3
000023DC 3483                       		move.w	d3,(a2)
000023DE 0080 4000 0080             		or.l	#$40000080,d0
000023E4 4840                       		swap	d0
000023E6 3480                       		move.w	d0,(a2)
000023E8 4840                       		swap	d0
000023EA 3F00                       		move.w	d0,-(sp)
000023EC 349F                       		move.w	(sp)+,(a2)
000023EE 34BC 8164                  		move.w	#$8164,(a2)
000023F2 0240 FF7F                  		and.w	#$FF7F,d0
000023F6 2480                       		move.l	d0,(a2)
000023F8 2551 FFFC                  		move.l	(a1),-4(a2)
000023FC 34BC 8F02                  		move.w	#$8F02,(a2)
00002400 4CDF 0600                  		movem.l	(sp)+,a1-a2
00002404 4E75                       		rts
00002406                            		
00002406                            ; ------------------------------------------------
00002406                            
00002406                            MegaVid_PlaySound:
00002406 4E75                        rts
00002408                             
00002408 33FC 0100 00A1 1100        		move.w	#$100,($A11100).l
00002410                            @WaitZ80:
00002410 0839 0000 00A1 1100        		btst	#0,($A11100).l
00002418 66F6                       		bne.s	@WaitZ80
0000241A                            
0000241A 43F9 00A0 0180             		lea	($A00180),a1
00002420                            ; 		movea.l (RAM_FullMotVid+vid_sound),a0
00002420 203C 0000 0000             		move.l	#vidSound,d0 
00002426 223C 0000 0000             		move.l	#vidSound_end,d1 
0000242C 243C 0000 0000             		move.l	#vidSound,d2
00002432                            		
00002432                            		;Start
00002432 7800                       		moveq	#0,d4
00002434 4A40                       		tst.w	d0
00002436 6A00                       		bpl.s	@plus_s
00002438 383C 0081                  		move.w	#$81,d4
0000243C                            @plus_s:
0000243C 4840                       		swap	d0
0000243E 4844                       		swap	d4
00002440 1800                       		move.b	d0,d4
00002442 4844                       		swap	d4
00002444 4840                       		swap	d0
00002446 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
00002448 4844                       		swap	d4
0000244A 12C4                       		move.b	d4,(a1)+		;		$xx0000
0000244C 4844                       		swap	d4
0000244E 12C0                       		move.b	d0,(a1)+		;start Addr	$00xx
00002450 E048                       		lsr.w	#8,d0
00002452 12C0                       		move.b	d0,(a1)+		;		$xx00
00002454                            		
00002454                            		;Loop
00002454 7800                       		moveq	#0,d4
00002456 4A41                       		tst.w	d1
00002458 6A00                       		bpl.s	@plus_e
0000245A 383C 0081                  		move.w	#$81,d4
0000245E                            @plus_e:
0000245E 4841                       		swap	d1
00002460 4844                       		swap	d4
00002462 1801                       		move.b	d1,d4
00002464 4844                       		swap	d4
00002466 4841                       		swap	d1
00002468 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
0000246A 4844                       		swap	d4
0000246C 12C4                       		move.b	d4,(a1)+		;		$xx0000
0000246E 4844                       		swap	d4
00002470 12C1                       		move.b	d1,(a1)+		;start Addr	$00xx
00002472 E049                       		lsr.w	#8,d1
00002474 12C1                       		move.b	d1,(a1)+		;		$xx00
00002476                            		
00002476                            		;End
00002476 7800                       		moveq	#0,d4
00002478 4A42                       		tst.w	d2
0000247A 6A00                       		bpl.s	@plus_l
0000247C 383C 0081                  		move.w	#$81,d4
00002480                            @plus_l:
00002480 4842                       		swap	d2
00002482 4844                       		swap	d4
00002484 1802                       		move.b	d2,d4
00002486 4844                       		swap	d4
00002488 4842                       		swap	d2
0000248A 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
0000248C 4844                       		swap	d4
0000248E 12C4                       		move.b	d4,(a1)+		;		$xx0000
00002490 4844                       		swap	d4
00002492 12C2                       		move.b	d2,(a1)+		;start Addr	$00xx
00002494 E04A                       		lsr.w	#8,d2
00002496 12C2                       		move.b	d2,(a1)+		;		$xx00
00002498                            		
00002498 43FA 0000                  		lea	@PitchRate(pc),a1
0000249C                            @FoundIt:
0000249C 45F9 00A0 0200             		lea	($A00200),a2
000024A2 743F                       		moveq	#$3F,d2
000024A4                            @copy:
000024A4 14D9                       		move.b	(a1)+,(a2)+
000024A6 51CA FFFC                  		dbf	d2,@copy
000024AA                            		
000024AA 7000                       		moveq	#0,d0				;TODO: Loop flag
000024AC E308                       		lsl.b	#1,d0
000024AE 08C0 0000                  		bset	#0,d0
000024B2 13C0 00A0 018D             		move.b	d0,($A00180+$D)
000024B8                            
000024B8 13FC 002A 00A0 4000        		move.b	#$2A,($A04000).l
000024C0 33FC 0000 00A1 1100        		move.w	#0,($A11100).l
000024C8 4E75                       		rts
000024CA                            		
000024CA                            @PitchRate:
000024CA 0100 0101 0001 0001 0001+     		dc.b 1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0		;C-5 8000hz
000024EA 0001 0001 0001 0000 0100+      		dc.b 0,1,0,1,0,1,0,0,1,0,1,1,0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,0
0000250A                                		even
0000250A                                		
0000250A                            ; =================================================================
0000250A                            ; ------------------------------------------------
0000250A                            ; Hblank
0000250A                            ; ------------------------------------------------
0000250A                            		
0000250A                            ; =================================================================
0000250A                            ; ------------------------------------------------
0000250A                            ; VBlank
0000250A                            ; ------------------------------------------------
0000250A                            	
0000250A                            Art_TempFont:	incbin	"engine/shared/data/art_dbgfont.bin",0,($20*96)
0000310A                            Art_TempFont_End:
0000310A                            		even
0000310A                            		
0000310A                            Pal_Title:	incbin	"engine/modes/Title/data/vidtest/pal.bin"
0000312A                            Pal_Title_End:
0000312A                            		even
0000312A                            		
0000312A                            		
0000312A                            		
0000312A                            ; ---------------------------------------------
0000312A                            ; Code | Sound
0000312A                            ; ---------------------------------------------
0000312A                            
0000312A                            		include	"engine/sound/code.asm"
0000312A                            ; ================================================================
0000312A                            ; SMEG
0000312A                            ; Sound and Music Engine for Genesis/SegaCD/32X
0000312A                            ;
0000312A                            ; (C)2013-2015 Kevin C.
0000312A                            ; 
0000312A                            ; ImpulseTracker
0000312A                            ;
0000312A                            ; Ticks:
0000312A                            ; 150 - NTSC
0000312A                            ; 120 - PAL
0000312A                            ;
0000312A                            ; uses assembler settings:
0000312A                            ; SegaCD - for building to SegaCD (All the driver must be aligned to WordRAM or PRG-RAM)
0000312A                            ;          requires SubCPU code for PCM Samples
0000312A                            ; MARS   - for building to 32x (CODE and DATA(Music/Sfx/Voices/Z80 samples) must be aligned
0000312A                            ;          to the 32x standards, uses bank 0 only, PWM Samples can be anywhere)
0000312A                            ;          requires sh2 code for PWM Samples
0000312A                            ;
0000312A                            ; Limtations:
0000312A                            ; Driver - doesnt support any kind of effects
0000312A                            ;          only volume and panning (Xxx) works
0000312A                            ; 
0000312A                            ; SegaCD - You cant use Z80 samples if your program is running
0000312A                            ;          on PRG-RAM (Z80 cant access RAM), if your program is
0000312A                            ;          running on WORD-RAM, set the permission to
0000312A                            ;          MainCPU (2M Mode) <-- SEGA didnt allow this
0000312A                            ; ================================================================
0000312A                            
0000312A                            			rsreset
0000312A =00000000                  DrvStatus		rs.b 1		;Byte
0000312A =00000001                  DrvSettings		rs.b 1		;Byte
0000312A =00000002                  PatternEnd		rs.b 1		;Byte
0000312A =00000003                  PatternLoop		rs.b 1		;Byte
0000312A =00000004                  ChannelList		rs.l 1		;Long
0000312A =00000008                  SongStart		rs.l 1		;Long
0000312A =0000000C                  SongRead		rs.l 1		;Long
0000312A =00000010                  SongVoices		rs.l 1		;Long
0000312A =00000014                  SongSampl		rs.l 1		;Long
0000312A =00000018                  SongPcmSamp		rs.l 1		;Long
0000312A =0000001C                  TicksRead		rs.w 1		;Word
0000312A =0000001E                  TicksSet		rs.w 1		;Word
0000312A =00000020                  TempoRead 		rs.w 1		;Word
0000312A =00000022                  PattSize		rs.w 1		;Word
0000312A =00000024                  PattRead		rs.w 1		;Word
0000312A =00000026                  CurrPattern		rs.b 1		;Byte
0000312A =00000027                  PcmChnOnOff		rs.b 1		;Byte
0000312A =00000028                  PsgLast			rs.b 1		;Byte
0000312A =00000029                  DrvSettingsBGM		rs.b 1		;Byte
0000312A =0000002A                  LastPattChn		rs.b 1		;Byte
0000312A =0000002B                  Psg_Vibrato		rs.b 1		;Byte
0000312A =0000002C                  Psg_AutoVol		rs.b 1		;Byte
0000312A =0000002D                  UsedChnBuff		rs.b 18		;Array (Bytes)
0000312A                            
0000312A                            ; --------------------------------------------
0000312A                            ; Channel settings
0000312A                            ; --------------------------------------------
0000312A                            
0000312A                            			rsreset
0000312A =00000000                  Chn_Freq		rs.w 1		;Word
0000312A =00000002                  Chn_Effect		rs.w 1		;Word
0000312A =00000004                  Chn_Portam		rs.w 1		;Word
0000312A =00000006                  Chn_Type		rs.b 1		;Byte
0000312A =00000007                  Chn_ID			rs.b 1		;Byte
0000312A =00000008                  Chn_Inst		rs.b 1		;Byte
0000312A =00000009                  Chn_Vol			rs.b 1		;Byte
0000312A =0000000A                  Chn_DefVol		rs.b 1		;Byte
0000312A =0000000B                  Chn_Note		rs.b 1		;Byte
0000312A =0000000C                  Chn_Panning		rs.b 1		;Byte
0000312A =0000000D                  Chn_FM_Key		rs.b 1		;Byte
0000312A =0000000E                  Chn_PCM_Pitch		rs.b 1		;Byte
0000312A =0000000F                  Chn_PSG_Vibrato		rs.b 1		;Byte
0000312A =00000010                  sizeof_Chn		rs.l 0
0000312A                             
0000312A                            ; --------------------------------------------
0000312A                            ; Bits
0000312A                            ; --------------------------------------------
0000312A                            
0000312A =00000000                  bitPriority		equ	0
0000312A =00000001                  bitSfxOn		equ	1
0000312A =00000002                  bitDisabled		equ	2
0000312A                            
0000312A                            ;Status
0000312A =00000000                  bitDacOn		equ	0
0000312A =00000001                  bitDacNote		equ	1
0000312A =00000002                  bitTone3		equ	2
0000312A =00000003                  bitSpecial3		equ	3
0000312A                            
0000312A                            ; --------------------------------------------
0000312A                            ; Channel IDs
0000312A                            ; --------------------------------------------
0000312A                            
0000312A =00000000                  FM_1			equ	$00
0000312A =00000001                  FM_2			equ	$01
0000312A =00000002                  FM_3			equ	$02
0000312A =00000004                  FM_4			equ	$04
0000312A =00000005                  FM_5			equ	$05
0000312A =00000006                  FM_6			equ	$06
0000312A =00000080                  PSG_1			equ	$80
0000312A =000000A0                  PSG_2			equ	$A0
0000312A =000000C0                  PSG_3			equ	$C0
0000312A =000000E0                  NOISE			equ	$E0
0000312A =00000010                  PCM_1			equ	$10
0000312A =00000011                  PCM_2			equ	$11
0000312A =00000012                  PCM_3			equ	$12
0000312A =00000013                  PCM_4			equ	$13
0000312A =00000014                  PCM_5			equ	$14
0000312A =00000015                  PCM_6			equ	$15
0000312A =00000016                  PCM_7			equ	$16
0000312A =00000017                  PCM_8			equ	$17
0000312A =00000012                  MaxChannels		equ	18
0000312A                            
0000312A                            ; --------------------------------------------
0000312A                            ; .IT request ($80+) format
0000312A                            ; --------------------------------------------
0000312A                            
0000312A =00000000                  bitNote			equ	0
0000312A =00000001                  bitInst			equ	1
0000312A =00000002                  bitVolume		equ	2
0000312A =00000003                  bitEffect		equ	3
0000312A =00000004                  bitSameNote		equ	4
0000312A =00000005                  bitSameInst		equ	5
0000312A =00000006                  bitSameVol		equ	6
0000312A =00000007                  bitSameEffect		equ	7
0000312A                            
0000312A                            ; --------------------------------------------
0000312A                            ; RAM
0000312A                            ; --------------------------------------------
0000312A                            
0000312A                            			rsset RAM_SndDriver
0000312A =FFFFD08A                  RAM_SMEG_Buffer		rs.b $48
0000312A =FFFFD0D2                  RAM_SMEG_SfxBuff	rs.b $48
0000312A =FFFFD11A                  RAM_SMEG_Chnls_BGM	rs.b $10*18
0000312A =FFFFD23A                  RAM_SMEG_Chnls_SFX	rs.b $10*18
0000312A =FFFFD35A                  sizeof_SMEG		rs.l 0
0000312A                            ; 			inform 0,"SMEG: %h",sizeof_SMEG-RAM_SndDriver
0000312A                            			
0000312A                            ; ================================================================
0000312A                            ; -------------------------------------------
0000312A                            ; Macros
0000312A                            ; -------------------------------------------
0000312A                            
0000312A                            Z80_OFF		macro
0000312A                            		move.w	#$100,($A11100).l
0000312A                            @WaitZ80\@:
0000312A                            		btst	#0,($A11100).l
0000312A                            		bne.s	@WaitZ80\@
0000312A                            		endm
0000312A                            
0000312A                            ; -----------------------------------------
0000312A                            
0000312A                            Z80_ON		macro
0000312A                            		move.b	#$2A,($A04000).l
0000312A                            		move.w	#0,($A11100).l
0000312A                            		endm
0000312A                            
0000312A                            ; ================================================================
0000312A                            ; -------------------------------------------
0000312A                            ; External Calls
0000312A                            ; -------------------------------------------
0000312A                            
0000312A                            ;SegaPCM
0000312A =00000020                  CdTask_LoadPcm		equ	$20
0000312A =00000021                  CdTask_SetAddr		equ	$21
0000312A =00000022                  CdTask_SetFreq		equ	$22
0000312A =00000023                  CdTask_SetPan		equ	$23
0000312A =00000024                  CdTask_SetEnv		equ	$24
0000312A =00000025                  CdTask_SetOnOff		equ	$25
0000312A =00000026                  CdTask_ClearAllPcm	equ	$26
0000312A                            
0000312A                            ;MARS
0000312A =00000001                  marscall_Play		equ	1
0000312A =00000002                  marscall_Stop		equ	2
0000312A =00000003                  marscall_SetSmpl	equ	3
0000312A =00000004                  marscall_SetVol		equ	4
0000312A =00000005                  marscall_SetEntry	equ	5
0000312A                            
0000312A                            ; -------------------------------------------
0000312A                            
0000312A                            SMEG_CD_Call:
0000312A 4E75                       		rts
0000312C                            
0000312C                            SMEG_MARS_Call:
0000312C 4E75                        		rts
0000312E                            		
0000312E                            ; ================================================================
0000312E                            ; -------------------------------------------
0000312E                            ; Init
0000312E                            ; -------------------------------------------
0000312E                            
0000312E                            SMEG_Init:
0000312E 41F9 FFFF D08A             		lea	(RAM_SMEG_Buffer),a0
00003134 303C 02FF                  		move.w	#$2FF,d0
00003138                            @ClrAll:
00003138 4298                       		clr.l	(a0)+
0000313A 51C8 FFFC                  		dbf	d0,@ClrAll
0000313E                            
0000313E 6100 0000                  		bsr	SMEG_Z80_Init
00003142                            		
00003142                            ; -------------------------------------------
00003142                            ; Stop ALL Sound
00003142                            ; -------------------------------------------
00003142                            
00003142                            SMEG_StopSnd:
00003142 103C 002B                  		move.b	#$2B,d0
00003146 123C 0000                  		move.b	#$00,d1
0000314A 33FC 0100 00A1 1100 0839+  		Z80_OFF
0000315C 6100 0000                  		bsr	FM_RegWrite_1
00003160 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003170                            		
00003170 41F9 FFFF D08A             		lea	(RAM_SMEG_Buffer),a0
00003176 08D0 0002                  		bset	#bitDisabled,(a0)
0000317A 41F9 FFFF D0D2             		lea	(RAM_SMEG_SfxBuff),a0
00003180 08D0 0002                  		bset	#bitDisabled,(a0)
00003184                            	
00003184 6100 0000                  		bsr	SMEG_FM_Reset
00003188 6100 0000                  		bsr	SMEG_PSG_Reset
0000318C 6000 0000                  		bra	SMEG_PCM_Reset
00003190                            
00003190                            ; -------------------------------------------
00003190                            ; Play Song
00003190                            ; -------------------------------------------
00003190                            
00003190                            SMEG_PlaySong:
00003190 41F9 FFFF D08A             		lea	(RAM_SMEG_Buffer),a0
00003196 0890 0002                  		bclr	#bitDisabled,(a0)
0000319A 4E75                       		rts
0000319C                            		
0000319C                            ; -------------------------------------------
0000319C                            ; Load SFX
0000319C                            ;
0000319C                            ; d0 - StartOfSong
0000319C                            ; d1 - Ticks
0000319C                            ; -------------------------------------------
0000319C                            
0000319C                            SMEG_LoadSfx:
0000319C 48E7 000E                  		movem.l	a4-a6,-(sp)
000031A0 4DF9 FFFF D0D2             		lea	(RAM_SMEG_SfxBuff),a6
000031A6 4BF9 FFFF D23A             		lea	(RAM_SMEG_Chnls_SFX),a5
000031AC 422E 0027                  		clr.b	PcmChnOnOff(a6)
000031B0 422E 0000                                  clr.b	DrvStatus(a6)
000031B4 08D6 0001                                  bset	#bitSfxOn,(a6)
000031B8 6100 0000                  		bsr	SMEG_Load_SetChnls
000031BC 4CDF 7000                  		movem.l	(sp)+,a4-a6
000031C0 4E75                       		rts
000031C2                            
000031C2                            ; -------------------------------------------
000031C2                            ; Load Song
000031C2                            ;
000031C2                            ; d0 - StartOfSong
000031C2                            ; d1 - Ticks
000031C2                            ; -------------------------------------------
000031C2                            
000031C2                            SMEG_LoadSong:
000031C2 2C00                       		move.l	d0,d6
000031C4 2A01                       		move.l	d1,d5
000031C6 6100 FF7A                  		bsr	SMEG_StopSnd			;d0-d1 are gone
000031CA 2006                       		move.l	d6,d0
000031CC 2205                       		move.l	d5,d1
000031CE                            		
000031CE 4DF9 FFFF D08A             		lea	(RAM_SMEG_Buffer),a6
000031D4 4BF9 FFFF D11A             		lea	(RAM_SMEG_Chnls_BGM),a5
000031DA 422E 0027                  		clr.b	PcmChnOnOff(a6)
000031DE 422E 0000                                  clr.b	DrvStatus(a6)
000031E2 6100 0000                  		bsr	SMEG_Load_SetChnls
000031E6 6100 0000                  		bsr	SMEG_Load_FixBgm
000031EA 6100 0000                  		bsr	SMEG_Load_SetExtChnls
000031EE                            
000031EE                            ; 		lea	(RAM_SMEG_Buffer),a6
000031EE                            ; 		bset	#bitDisabled,(a6)
000031EE 4E75                       		rts
000031F0                            		
000031F0                            ; -----------------------
000031F0                            ; Setup channels
000031F0                            ; -----------------------
000031F0                            
000031F0                            SMEG_Load_SetChnls:
000031F0 2840                       		movea.l	d0,a4				;a4 - Music data
000031F2 3D41 001E                  		move.w	d1,TicksSet(a6)
000031F6                            
000031F6                            ; -----------------------
000031F6                            ; Get instruments
000031F6                            ; -----------------------
000031F6                            
000031F6 2D5C 0010                  		move.l	(a4)+,SongVoices(a6)
000031FA 2D5C 0014                  		move.l	(a4)+,SongSampl(a6)
000031FE 2D5C 0018                  		move.l	(a4)+,SongPcmSamp(a6)
00003202                            	
00003202                            ; -----------------------
00003202                            ; Get the
00003202                            ; PatternEnd/PatternLoop
00003202                            ; numbers
00003202                            ; -----------------------
00003202                            
00003202 1D5C 0002                  		move.b	(a4)+,PatternEnd(a6)
00003206 1D5C 0003                  		move.b	(a4)+,PatternLoop(a6)
0000320A                            
0000320A                            ; -----------------------
0000320A                            ; Setup the channel IDs
0000320A                            ; -----------------------
0000320A                            
0000320A 7811                       		moveq	#(MaxChannels)-1,d4
0000320C                            @SetId:
0000320C 1B7C 0001 0006             		move.b	#1,Chn_Type(a5)
00003212 1B5C 0007                  		move.b	(a4)+,Chn_ID(a5)
00003216 426D 0000                  		clr.w	Chn_Freq(a5)
0000321A                            		
0000321A                            ; 		tst.b	Chn_ID(a5)
0000321A                            ; 		bmi.s	@NotFM
0000321A                            ; 		cmp.b	#PCM_1,Chn_ID(a5)
0000321A                            ; 		bge.s	@NotFM
0000321A                            
0000321A                            ; 		clr.b	Chn_FM_Key(a5)
0000321A                            ; 		move.b	#%00001111,Chn_FM_Key(a5)
0000321A                            ; 		move.b	#$C0,Chn_Panning(a5)
0000321A                            ; 		bsr	SMEG_FM_SetPan
0000321A                            
0000321A                            @NotFM:
0000321A DAFC 0010                  		adda 	#sizeof_Chn,a5
0000321E 51CC FFEC                  		dbf	d4,@SetId
00003222                            
00003222                            ; -----------------------
00003222                            ; Master volumes
00003222                            ; -----------------------
00003222                            
00003222 7011                       		moveq	#(MaxChannels)-1,d0
00003224                            @SetVol:
00003224 1B5C 000A                  		move.b	(a4)+,Chn_DefVol(a5)
00003228 DAFC 0010                  		adda 	#sizeof_Chn,a5
0000322C 51C8 FFF6                  		dbf	d0,@SetVol
00003230                            
00003230                            ; -----------------------
00003230                            ; last steps
00003230                            ; -----------------------
00003230                            
00003230 2D4C 0008                  		move.l	a4,SongStart(a6)
00003234 1D5C 0023                  		move.b	(a4)+,PattSize+1(a6)
00003238 1D5C 0022                  		move.b	(a4)+,PattSize(a6)
0000323C 426E 0024                  		clr.w	PattRead(a6)
00003240 D8FC 0006                  		adda	#6,a4
00003244 2D4C 000C                  		move.l	a4,SongRead(a6)
00003248 4E75                       		rts
0000324A                            		
0000324A                            ; -----------------------
0000324A                            ; Exclusive features
0000324A                            ; -----------------------
0000324A                            
0000324A                            SMEG_Load_SetExtChnls:
0000324A                            		
0000324A                            @Return:
0000324A 4E75                       		rts
0000324C                            
0000324C                            ; -----------------------
0000324C                            ; Fix stuff to BGM
0000324C                            ; -----------------------
0000324C                            
0000324C                            SMEG_Load_FixBgm:
0000324C 4BF9 FFFF D11A             		lea	(RAM_SMEG_Chnls_BGM),a5
00003252 7811                       		moveq	#(MaxChannels)-1,d4
00003254                            @SetId:
00003254 1B7C 0080 000C             		move.b	#$80,Chn_Panning(a5)
0000325A                            
0000325A 4A2D 0007                  		tst.b	Chn_ID(a5)
0000325E 6B00                       		bmi.s	@NotFM
00003260 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003266 6C00                       		bge.s	@NotFM
00003268                            
00003268 422D 000D                  		clr.b	Chn_FM_Key(a5)
0000326C 1B7C 000F 000D             		move.b	#%00001111,Chn_FM_Key(a5)
00003272 1B7C 00C0 000C             		move.b	#$C0,Chn_Panning(a5)
00003278 6100 0000                  		bsr	SMEG_FM_SetPan
0000327C                            
0000327C                            @NotFM:
0000327C DAFC 0010                  		adda 	#sizeof_Chn,a5
00003280 51CC FFD2                  		dbf	d4,@SetId
00003284 4E75                       		rts
00003286                            		
00003286                            ; ================================================================
00003286                            ; -------------------------------------------
00003286                            ; Run
00003286                            ; -------------------------------------------
00003286                            
00003286                            SMEG_Upd:
00003286 4DF9 FFFF D08A             		lea	(RAM_SMEG_Buffer),a6
0000328C 2D7C FFFF D11A 0004        		move.l	#RAM_SMEG_Chnls_BGM,ChannelList(a6)
00003294 08D6 0000                  		bset	#bitPriority,(a6)
00003298 6100 0000                                  bsr	@ReadRow
0000329C                                            
0000329C 4DF9 FFFF D0D2              		lea	(RAM_SMEG_SfxBuff),a6
000032A2 0896 0000                  		bclr	#bitPriority,(a6)
000032A6 0816 0001                                  btst	#bitSfxOn,(a6)				;Want to play SFX?
000032AA 6700                                       beq.s	@Wait
000032AC 2D7C FFFF D23A 0004        		move.l	#RAM_SMEG_Chnls_SFX,ChannelList(a6)
000032B4 6100 0000                  		bsr	@ReadRow
000032B8                            @Wait:
000032B8 4E75                       		rts
000032BA                            
000032BA                            ; -------------------------------------------
000032BA                            ; Read row
000032BA                            ; -------------------------------------------
000032BA                            
000032BA                            @ReadRow:
000032BA 0816 0002                  		btst	#bitDisabled,(a6)
000032BE 66F8                       		bne.s	@Wait
000032C0                            
000032C0 046E 0001 001C             		sub.w	#1,TicksRead(a6)
000032C6 6AF0                       		bpl.s	@Wait
000032C8 3D6E 001E 001C              		move.w	TicksSet(a6),TicksRead(a6)
000032CE                            
000032CE 286E 000C                                  movea.l	SongRead(a6),a4
000032D2 7A00                       		moveq	#0,d5
000032D4                            
000032D4                            ; --------------------------------
000032D4                            ; New pattern
000032D4                            ; --------------------------------
000032D4                            
000032D4                            @Next:
000032D4 322E 0022                   		move.w	PattSize(a6),d1
000032D8 0441 0001                    		sub.w	#1,d1
000032DC B26E 0024                   		cmp.w	PattRead(a6),d1
000032E0 6400                        		bcc.s	@NoNextRow
000032E2 426E 0024                  		clr.w	PattRead(a6)
000032E6                            
000032E6 122E 0002                  		move.b	PatternEnd(a6),d1
000032EA 102E 0026                  		move.b	CurrPattern(a6),d0
000032EE B200                       		cmp.b	d0,d1
000032F0 6E00                       		bgt.s	@NotEnd
000032F2                            
000032F2 206E 0008                  		movea.l	SongStart(a6),a0
000032F6 1D58 0023                  		move.b	(a0)+,PattSize+1(a6)
000032FA 1D58 0022                  		move.b	(a0)+,PattSize(a6)
000032FE D0FC 0006                  		adda	#6,a0
00003302 2D48 000C                  		move.l	a0,SongRead(a6)
00003306 426E 0024                  		clr.w	PattRead(a6)
0000330A 1D6E 0003 0026             		move.b	PatternLoop(a6),CurrPattern(a6)
00003310 426E 001C                  		clr.w	TicksRead(a6)
00003314 6000 FFA4                  		bra 	@ReadRow
00003318                            
00003318                            ; --------------------------------
00003318                            
00003318                            @NotEnd:
00003318 062E 0001 0026             		add.b	#1,CurrPattern(a6)
0000331E                            
0000331E 7000                       		moveq	#0,d0
00003320 102E 0026                  		move.b	CurrPattern(a6),d0
00003324 B02E 0003                  		cmp.b	PatternLoop(a6),d0
00003328 6600                       		bne.s	@DontSaveLoop
0000332A 2D4C 0008                  		move.l	a4,SongStart(a6)
0000332E                            
0000332E                            @DontSaveLoop:
0000332E 1D5C 0023                  		move.b	(a4)+,PattSize+1(a6)
00003332 1D5C 0022                  		move.b	(a4)+,PattSize(a6)
00003336 D8FC 0006                  		adda	#6,a4
0000333A                            
0000333A                            ; --------------------------------
0000333A                            ; Current pattern
0000333A                            ; --------------------------------
0000333A                            
0000333A                            @NoNextRow:
0000333A 7C00                       		moveq	#0,d6
0000333C 7000                       		moveq	#0,d0
0000333E 101C                       		move.b	(a4)+,d0
00003340                            
00003340 4A00                       		tst.b	d0
00003342 6600                       		bne.s	@ValidNote
00003344                            
00003344 066E 0001 0024             		add.w	#1,PattRead(a6)
0000334A 2D4C 000C                  		move.l	a4,SongRead(a6)
0000334E 4E75                       		rts
00003350                            
00003350                            @ValidNote:
00003350 4A00                       		tst.b	d0
00003352 6A00                       		bpl.s	@Not80
00003354 066E 0001 0024             		add.w	#1,PattRead(a6)
0000335A 0880 0007                  		bclr	#7,d0
0000335E 1C1C                       		move.b	(a4)+,d6
00003360                            
00003360                            @Not80:
00003360 066E 0001 0024             		add.w	#1,PattRead(a6)
00003366                            
00003366 0440 0001                  		sub.w	#1,d0
0000336A 1D40 002A                  		move.b	d0,LastPattChn(a6)
0000336E 47EE 002D                  		lea	UsedChnBuff(a6),a3
00003372 D6C0                       		adda 	d0,a3
00003374 16BC 0001                  		move.b	#1,(a3)
00003378                            
00003378 2A6E 0004                                  movea.l	ChannelList(a6),a5
0000337C 4A40                                       tst.w	d0
0000337E 6700                                       beq.s	@First
00003380 0440 0001                                  sub.w	#1,d0
00003384                            @NextChn:
00003384 DAFC 0010                  		adda	#sizeof_Chn,a5
00003388 51C8 FFFA                  		dbf	d0,@NextChn
0000338C                            @First:
0000338C                            		
0000338C 4A46                       		tst.w	d6
0000338E 6700                       		beq.s	@NotRest
00003390 422D 0006                  		clr.b	Chn_Type(a5)
00003394 1B46 0006                  		move.b	d6,Chn_Type(a5)
00003398                            
00003398                            @NotRest:
00003398                            
00003398                            ; -------------
00003398                            ; Note
00003398                            ; -------------
00003398                            
00003398 082D 0004 0006             		btst	#bitSameNote,Chn_Type(a5)
0000339E 6600                       		bne.s	@PlayOnly
000033A0 082D 0000 0006             		btst	#bitNote,Chn_Type(a5)
000033A6 6700                       		beq.s	@NoNote
000033A8                            
000033A8 1B5C 000B                                  move.b	(a4)+,Chn_Note(a5)
000033AC 066E 0001 0024             		add.w	#1,PattRead(a6)
000033B2                            
000033B2                            @PlayOnly:
000033B2 6100 0000                  		bsr	SMEG_ChannelRest
000033B6                            		
000033B6                            ; -------------
000033B6                            ; Instrument
000033B6                            ; -------------
000033B6                            
000033B6                            @NoNote:
000033B6 082D 0005 0006              		btst	#bitSameInst,Chn_Type(a5)
000033BC 6600                       		bne.s	@SameInst
000033BE 082D 0001 0006             		btst	#bitInst,Chn_Type(a5)
000033C4 6700                       		beq.s	@NoInst
000033C6                            
000033C6 1B5C 0008                  		move.b	(a4)+,Chn_Inst(a5)
000033CA 066E 0001 0024             		add.w	#1,PattRead(a6)
000033D0                            
000033D0 6100 0000                  		bsr	SMEG_SetVoice
000033D4                            @SameInst:
000033D4                            
000033D4                            ; -------------
000033D4                            ; Volume
000033D4                            ; -------------
000033D4                            
000033D4                            @NoInst:
000033D4 082D 0006 0006              		btst	#bitSameVol,Chn_Type(a5)
000033DA 6600                        		bne.s	@SameVol
000033DC 082D 0002 0006             		btst	#bitVolume,Chn_Type(a5)
000033E2 6700                       		beq.s	@NoVolume
000033E4                            
000033E4 426D 0004                  		clr.w	Chn_Portam(a5)
000033E8 426D 0002                  		clr.w	Chn_Effect(a5)
000033EC 7000                                       moveq	#0,d0
000033EE 101C                       		move.b	(a4)+,d0
000033F0 066E 0001 0024             		add.w	#1,PattRead(a6)
000033F6 0440 0040                  		sub.w	#64,d0
000033FA 4440                       		neg.w	d0
000033FC 1B40 0009                                  move.b	d0,Chn_Vol(a5)
00003400                            
00003400                            @SameVol:
00003400 6100 0000                  		bsr	@ChnVolume
00003404                            
00003404                            ; -------------
00003404                            ; Effect
00003404                            ; -------------
00003404                            
00003404                            @NoVolume:
00003404 082D 0007 0006              		btst	#bitSameEffect,Chn_Type(a5)
0000340A 6600                        		bne.s	@SameEffect
0000340C 082D 0003 0006             		btst	#bitEffect,Chn_Type(a5)
00003412 6700                       		beq.s	@NoEffect
00003414                            
00003414 1B5C 0002                  		move.b	(a4)+,Chn_Effect(a5)
00003418 066E 0001 0024             		add.w	#1,PattRead(a6)
0000341E 1B5C 0003                  		move.b	(a4)+,Chn_Effect+1(a5)
00003422 066E 0001 0024             		add.w	#1,PattRead(a6)
00003428                            
00003428                            @SameEffect:
00003428 6100 0000                  		bsr	@ChannelEffects
0000342C                            
0000342C                            ; --------------
0000342C                            ; Play the note
0000342C                            ; --------------
0000342C                            
0000342C                            @NoEffect:
0000342C 082D 0004 0006              		btst	#bitSameNote,Chn_Type(a5)
00003432 6600                        		bne.s	@SameNote
00003434 082D 0000 0006             		btst	#bitNote,Chn_Type(a5)
0000343A 6700 FE98                  		beq	@Next
0000343E                            @SameNote:
0000343E 6100 0000                  		bsr	@ChannelPlay
00003442 6000 FE90                  		bra	@Next
00003446                            
00003446                            ; ================================================================
00003446                            ; -------------------------------
00003446                            ; Set Freq
00003446                            ; -------------------------------
00003446                            
00003446                            @NoteFreq:
00003446 0C40 00FF                  		cmp.w	#$FF,d0
0000344A 6700                       		beq.s	@ResetFreq
0000344C 0C40 00FE                  		cmp.w	#$FE,d0
00003450 6700                       		beq.s	@ResetFreq
00003452                            		
00003452 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003458 6C00 0000                  		bge	@PCM_Freq
0000345C                            		
0000345C 4A2D 0007                  		tst.b	Chn_ID(a5)
00003460 6B00                       		bmi.s	@PSG_Freq
00003462 0C2D 0006 0007                             cmp.b	#FM_6,Chn_ID(a5)
00003468 6600                                       bne.s	@NoChk6
0000346A 082E 0000 0001             		btst	#bitDacOn,DrvSettings(a6)
00003470 6600 0000                  		bne	@DAC_Set
00003474                            
00003474                            @NoChk6:
00003474 7200                                       moveq	#0,d1
00003476 1200                                       move.b	d0,d1
00003478 7400                                       moveq	#0,d2
0000347A D241                       		add.w	d1,d1
0000347C 41FA 0000                  		lea	@Notes_FM(pc),a0
00003480 3B70 1000 0000             		move.w	(a0,d1.w),Chn_Freq(a5)
00003486 4E75                       		rts
00003488                            
00003488                            @ResetFreq:
00003488 426D 0000                  		clr.w	Chn_Freq(a5)
0000348C 4E75                       		rts
0000348E                            		
0000348E                            ; -------------------------------
0000348E                            ; PSG Freq
0000348E                            ; -------------------------------
0000348E                            
0000348E                            @PSG_Freq:
0000348E 0C2D 00E0 0007             		cmp.b	#NOISE,Chn_ID(a5)
00003494 6600                       		bne.s	@NotNoise
00003496                            
00003496 3B7C 0001 0000             		move.w	#1,Chn_Freq(a5)
0000349C 082E 0002 0001             		btst	#bitTone3,DrvSettings(a6)
000034A2 6700 0000                  		beq	@Disabled
000034A6                            
000034A6                            @NotNoise:
000034A6 7200                                       moveq	#0,d1
000034A8 1200                                       move.b	d0,d1
000034AA D241                       		add.w	d1,d1
000034AC 45FA 0000                  		lea	@Notes_PSG(pc),a2
000034B0 0C2D 00E0 0007             		cmp.b	#NOISE,Chn_ID(a5)
000034B6 6600                       		bne.s	@NotNoiseFix
000034B8 D4FC 0018                  		adda	#24,a2
000034BC                            @NotNoiseFix:
000034BC 43F2 1000                  		lea	(a2,d1.w),a1
000034C0 3B51 0000                  		move.w	(a1),Chn_Freq(a5)
000034C4 046D 0001 0000             		sub.w	#1,Chn_Freq(a5)
000034CA 4E75                       		rts
000034CC                            
000034CC                            ; -------------------------------
000034CC                            ; Set DAC
000034CC                            ; -------------------------------
000034CC                            
000034CC                            @DAC_Set:
000034CC 426D 0000                  		clr.w	Chn_Freq(a5)
000034D0 1B40 0000                                  move.b	d0,Chn_Freq(a5)
000034D4 6000 0000                    		bra	SMEG_SetVoice_DAC
000034D8                                            ;rts
000034D8                            
000034D8                            ; -------------------------------
000034D8                            ; Set Pcm
000034D8                            ; -------------------------------
000034D8                            
000034D8                            @PCM_Freq:
000034D8 4E75                       		rts
000034DA                            		
000034DA                            ; -------------------------------
000034DA                            
000034DA                            @Notes_FM:
000034DA                            ; 		dc.w $269
000034DA 028D                       		dc.w $28d
000034DC 02B4                       		dc.w $2b4
000034DE 02DD                       		dc.w $2dd
000034E0 0309                       		dc.w $309
000034E2 0337                       		dc.w $337
000034E4 0368                       		dc.w $368
000034E6 039C                       		dc.w $39c
000034E8 03D3                       		dc.w $3d3
000034EA 040D                       		dc.w $40d
000034EC 044B                       		dc.w $44b
000034EE 048C                       		dc.w $48c
000034F0 0269                       		dc.w $269
000034F2 028D                       		dc.w $28d
000034F4 02B4                       		dc.w $2b4
000034F6 02DD                       		dc.w $2dd
000034F8 0309                       		dc.w $309
000034FA 0337                       		dc.w $337
000034FC 0368                       		dc.w $368
000034FE 039C                       		dc.w $39c
00003500 03D3                       		dc.w $3d3
00003502 040D                       		dc.w $40d
00003504 044B                       		dc.w $44b
00003506 048C                       		dc.w $48c
00003508 0A69                       		dc.w $a69
0000350A 0A8D                       		dc.w $a8d
0000350C 0AB4                       		dc.w $ab4
0000350E 0ADD                       		dc.w $add
00003510 0B09                       		dc.w $b09
00003512 0B37                       		dc.w $b37
00003514 0B68                       		dc.w $b68
00003516 0B9C                       		dc.w $b9c
00003518 0BD3                       		dc.w $bd3
0000351A 0C0D                       		dc.w $c0d
0000351C 0C4B                       		dc.w $c4b
0000351E 0C8C                       		dc.w $c8c
00003520 1269                       		dc.w $1269
00003522 128D                       		dc.w $128d
00003524 12B4                       		dc.w $12b4
00003526 12DD                       		dc.w $12dd
00003528 1309                       		dc.w $1309
0000352A 1337                       		dc.w $1337
0000352C 1368                       		dc.w $1368
0000352E 139C                       		dc.w $139c
00003530 13D3                       		dc.w $13d3
00003532 140D                       		dc.w $140d
00003534 144B                       		dc.w $144b
00003536 148C                       		dc.w $148c
00003538 1A69                       		dc.w $1a69
0000353A 1A8D                       		dc.w $1a8d
0000353C 1AB4                       		dc.w $1ab4
0000353E 1ADD                       		dc.w $1add
00003540 1B09                       		dc.w $1b09
00003542 1B37                       		dc.w $1b37
00003544 1B68                       		dc.w $1b68
00003546 1B9C                       		dc.w $1b9c
00003548 1BD3                       		dc.w $1bd3
0000354A 1C0D                       		dc.w $1c0d
0000354C 1C4B                       		dc.w $1c4b
0000354E 1C8C                       		dc.w $1c8c
00003550 2269                       		dc.w $2269
00003552 228D                       		dc.w $228d
00003554 22B4                       		dc.w $22b4
00003556 22DD                       		dc.w $22dd
00003558 2309                       		dc.w $2309
0000355A 2337                       		dc.w $2337
0000355C 2368                       		dc.w $2368
0000355E 239C                       		dc.w $239c
00003560 23D3                       		dc.w $23d3
00003562 240D                       		dc.w $240d
00003564 244B                       		dc.w $244b
00003566 248C                       		dc.w $248c
00003568 2A69                       		dc.w $2a69
0000356A 2A8D                       		dc.w $2a8d
0000356C 2AB4                       		dc.w $2ab4
0000356E 2ADD                       		dc.w $2add
00003570 2B09                       		dc.w $2b09
00003572 2B37                       		dc.w $2b37
00003574 2B68                       		dc.w $2b68
00003576 2B9C                       		dc.w $2b9c
00003578 2BD3                       		dc.w $2bd3
0000357A 2C0D                       		dc.w $2c0d
0000357C 2C4B                       		dc.w $2c4b
0000357E 2C8C                       		dc.w $2c8c
00003580 3269                       		dc.w $3269
00003582 328D                       		dc.w $328d
00003584 32B4                       		dc.w $32b4
00003586 32DD                       		dc.w $32dd
00003588 3309                       		dc.w $3309
0000358A 3337                       		dc.w $3337
0000358C 3368                       		dc.w $3368
0000358E 339C                       		dc.w $339c
00003590 33D3                       		dc.w $33d3
00003592 340D                       		dc.w $340d
00003594 344B                       		dc.w $344b
00003596 348C                       		dc.w $348c
00003598                            		even
00003598                            
00003598                            @Notes_PSG:
00003598 0000                       		dc.w 0		;x-0
0000359A 0000                       		dc.w 0
0000359C 0000                       		dc.w 0
0000359E 0000                       		dc.w 0
000035A0 0000                       		dc.w 0
000035A2 0000                       		dc.w 0
000035A4 0000                       		dc.w 0
000035A6 0000                       		dc.w 0
000035A8 0000                       		dc.w 0
000035AA 0000                       		dc.w 0
000035AC 0000                       		dc.w 0
000035AE 0000                       		dc.w 0
000035B0 0000                       		dc.w 0
000035B2 0000                       		dc.w 0
000035B4 0000                       		dc.w 0
000035B6 0000                       		dc.w 0
000035B8 0000                       		dc.w 0
000035BA 0000                       		dc.w 0
000035BC                            
000035BC 0000                       		dc.w 0		;x-1
000035BE 0000                       		dc.w 0
000035C0 0000                       		dc.w 0
000035C2 0000                       		dc.w 0
000035C4 0000                       		dc.w 0
000035C6 0000                       		dc.w 0
000035C8 0000                       		dc.w 0
000035CA 0000                       		dc.w 0
000035CC 0000                       		dc.w 0
000035CE 0000                       		dc.w 0
000035D0 0000                       		dc.w 0
000035D2 0000                       		dc.w 0
000035D4 0000                       		dc.w 0
000035D6 0000                       		dc.w 0
000035D8 0000                       		dc.w 0
000035DA 0000                       		dc.w 0
000035DC 0000                       		dc.w 0
000035DE 0000                       		dc.w 0
000035E0                            
000035E0 0000                       		dc.w 0
000035E2 0000                       		dc.w 0
000035E4 0000                       		dc.w 0
000035E6 0000                       		dc.w 0
000035E8 0000                       		dc.w 0
000035EA 0000                       		dc.w 0
000035EC 0000                       		dc.w 0
000035EE 0000                       		dc.w 0
000035F0 0000                       		dc.w 0
000035F2                            
000035F2 03F8                       		dc.w $3F8
000035F4 03BF                                       dc.w $3BF
000035F6 0389                                       dc.w $389
000035F8 0356                       		dc.w $356
000035FA 0326                                       dc.w $326
000035FC 02F9                                       dc.w $2F9
000035FE 02CE                                       dc.w $2CE
00003600 02A5                                       dc.w $2A5
00003602 0280                                       dc.w $280
00003604 025C                                       dc.w $25C
00003606 023A                                       dc.w $23A
00003608 021A                                       dc.w $21A
0000360A 01FB                       		dc.w $1FB
0000360C 01DF                                       dc.w $1DF
0000360E 01C4                                       dc.w $1C4
00003610 01AB                                       dc.w $1AB
00003612 0193                                       dc.w $193
00003614 017D                                       dc.w $17D
00003616 0167                                       dc.w $167
00003618 0153                                       dc.w $153
0000361A 0140                                       dc.w $140
0000361C 012E                       		dc.w $12E
0000361E 011D                                       dc.w $11D
00003620 010D                                       dc.w $10D
00003622 00FE                                       dc.w $FE
00003624 00EF                                       dc.w $EF
00003626 00E2                                       dc.w $E2
00003628 00D6                                       dc.w $D6
0000362A 00C9                                       dc.w $C9
0000362C 00BE                                       dc.w $BE
0000362E 00B4                                       dc.w $B4
00003630 00A9                       		dc.w $A9
00003632 00A0                                       dc.w $A0
00003634 0097                                       dc.w $97
00003636 008F                                       dc.w $8F
00003638 0087                                       dc.w $87
0000363A 007F                                       dc.w $7F
0000363C 0078                                       dc.w $78
0000363E 0071                                       dc.w $71
00003640 006B                                       dc.w $6B
00003642 0065                                       dc.w $65
00003644 005F                       		dc.w $5F
00003646 005A                                       dc.w $5A
00003648 0055                                       dc.w $55
0000364A 0050                                       dc.w $50
0000364C 004B                                       dc.w $4B
0000364E 0047                                       dc.w $47
00003650 0043                                       dc.w $43
00003652 0040                                       dc.w $40
00003654 003C                                       dc.w $3C
00003656 0039                                       dc.w $39
00003658 0036                       		dc.w $36
0000365A 0033                                       dc.w $33
0000365C 0030                                       dc.w $30
0000365E 002D                                       dc.w $2D
00003660 002B                                       dc.w $2B
00003662 0028                                       dc.w $28
00003664 0026                                       dc.w $26
00003666 0024                                       dc.w $24
00003668 0022                                       dc.w $22
0000366A 0020                                       dc.w $20
0000366C 001F                       		dc.w $1F
0000366E 001D                                       dc.w $1D
00003670 001B                                       dc.w $1B
00003672 001A                                       dc.w $1A
00003674 0018                                       dc.w $18
00003676 0017                                       dc.w $17
00003678 0016                                       dc.w $16
0000367A 0015                                       dc.w $15
0000367C 0013                                       dc.w $13
0000367E 0012                                       dc.w $12
00003680 0011                       		dc.w $11
00003682                            
00003682                            ; 		dc.w $10 ;Custom...
00003682                            ; 		dc.w $9
00003682                            ; 		dc.w $8
00003682                            ; 		dc.w $7
00003682                            ; 		dc.w $6
00003682                            ; 		dc.w $5
00003682                            ; 		dc.w $4
00003682                            ; 		dc.w $3
00003682                            ; 		dc.w $2
00003682                            ; 		dc.w $1
00003682                            ;                 dc.w 0
00003682                            		even
00003682                            
00003682                            		
00003682                            ; ================================================================
00003682                            ; -------------------------------
00003682                            ; Set Volume
00003682                            ; -------------------------------
00003682                            
00003682                            @ChnVolume:
00003682 0C2D 00FF 0007             		cmp.b	#$FF,Chn_ID(a5)
00003688 6700 0000                  		beq	@Return
0000368C                            
0000368C 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003692 6C00 0000                  		bge	@ChnVol_PCM
00003696 4A2D 0007                  		tst.b	Chn_ID(a5)
0000369A 6B00 0000                  		bmi	@ChnVol_PSG
0000369E                            
0000369E 45FA 0000                  		lea	SMEG_RegSetVol-1(pc),a2
000036A2                            
000036A2 226E 0010                  		movea.l	SongVoices(a6),a1
000036A6 7000                       		moveq	#0,d0
000036A8 102D 0008                  		move.b	Chn_Inst(a5),d0
000036AC                            
000036AC                            @FindNext:
000036AC 4A51                       		tst.w	(a1)
000036AE 6B00 0000                  		bmi	@Return
000036B2 7200                       		moveq	#0,d1
000036B4 3229 0002                  		move.w	2(a1),d1
000036B8 B051                       		cmp.w	(a1),d0
000036BA 6700                       		beq.s	@Found
000036BC D2FC 0008                   		adda.w	#8,a1
000036C0 60EA                       		bra.s	@FindNext
000036C2                            
000036C2                            @Found:
000036C2 D2FC 0004                  		adda.w	#4,a1
000036C6 2251                       		movea.l	(a1),a1
000036C8 4A41                       		tst.w	d1
000036CA 6700                       		beq.s	@Nothing
000036CC                            @FindNext2:
000036CC D2FC 0019                  		adda	#$19,a1
000036D0 51C9 FFFA                  		dbf	d1,@FindNext2
000036D4                            @Nothing:
000036D4 D2FC 0018                  		adda	#$18,a1
000036D8                            
000036D8 103C 0028                  		move.b	#$28,d0
000036DC 7200                       		moveq	#0,d1
000036DE D22D 0007                  		add.b	Chn_ID(a5),d1
000036E2 33FC 0100 00A1 1100 0839+  		Z80_OFF
000036F4 6100 0000                  		bsr	FM_RegWrite_1
000036F8 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003708                            
00003708 7E01                       		moveq	#1,d7
0000370A                            @TryNext:
0000370A 7200                       		moveq	#0,d1
0000370C 1211                       		move.b	(a1),d1
0000370E D22D 000A                  		add.b	Chn_DefVol(a5),d1
00003712 D22D 0009                  		add.b	Chn_Vol(a5),d1
00003716                            
00003716 7600                                       moveq	#0,d3
00003718 162D 0007                                  move.b	Chn_ID(a5),d3
0000371C 7000                                       moveq	#0,d0
0000371E 1012                                       move.b	(a2),d0
00003720 0C00 004C                                  cmp.b	#$4C,d0
00003724 6700                       		beq.s	@Is4C
00003726 4A11                       		tst.b	(a1)
00003728 6600                       		bne.s	@Return
0000372A                            
0000372A                            @Is4C:
0000372A 94FC 0002                                  suba	#2,a2
0000372E 92FC 0002                                  suba	#2,a1
00003732                            
00003732 0C2D 0004 0007                             cmp.b	#FM_4,Chn_ID(a5)
00003738 6C00                                       bge.s	@FM456_2
0000373A D003                       		add.b	d3,d0
0000373C                            
0000373C 33FC 0100 00A1 1100 0839+  		Z80_OFF
0000374E 6100 0000                  		bsr	FM_RegWrite_1
00003752 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003762 51CF FFA6                  		dbf	d7,@TryNext
00003766 4E75                       		rts
00003768                            
00003768                            @FM456_2:
00003768 0443 0004                  		sub.w	#4,d3
0000376C D003                       		add.b	d3,d0
0000376E                            
0000376E 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003780 6100 0000                  		bsr	FM_RegWrite_2
00003784 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003794 51CF FF74                  		dbf	d7,@TryNext
00003798                            
00003798                            @Return:
00003798 4E75                       		rts
0000379A                            
0000379A                            ; -------------------------------
0000379A                            
0000379A                            @ChnVol_PSG:
0000379A 7200                       		moveq	#0,d1
0000379C 122D 0009                  		move.b	Chn_Vol(a5),d1
000037A0 303C 000F                  		move.w	#$F,d0
000037A4 4A41                       		tst.w	d1
000037A6 6700                       		beq.s	@DontFix
000037A8                            
000037A8 0441 0040                  		sub.w	#64,d1
000037AC 4441                       		neg.w	d1
000037AE E449                       		lsr.w	#2,d1
000037B0 3001                       		move.w	d1,d0
000037B2                            
000037B2                            	;	move.b	Chn_DefVol(a5),d3
000037B2                            	;	lsr.w	#2,d3
000037B2                            	;	add.w	d3,d0
000037B2                            	;	moveq	#$F,d0
000037B2                            	;	sub.w	d2,d0
000037B2                            	;	cmp.w	#$F,d0
000037B2                            	;	beq.s	@DontFix
000037B2                            	;	sub.w	#1,d0
000037B2                            	
000037B2                            @DontFix:
000037B2 7200                       		moveq	#0,d1
000037B4 122D 0007                  		move.b	Chn_ID(a5),d1
000037B8 0881 0007                  		bclr	#7,d1
000037BC EA49                       		lsr.w	#5,d1
000037BE                            		
000037BE 0200 000F                  		and.b	#$F,d0
000037C2 0201 0003                  		and.b	#$3,d1
000037C6 7400                       		moveq	#0,d2
000037C8 143C 000F                  		move.b	#$F,d2
000037CC 9400                       		sub.b	d0,d2
000037CE 0002 0090                  		or.b	#%10010000,d2
000037D2 EB09                       		lsl.b	#$5,d1
000037D4 8401                       		or.b	d1,d2
000037D6 13C2 00C0 0011             		move.b	d2,($C00011).l	;$90+channel<<5+($f-vol)
000037DC 4E75                       		rts
000037DE                            
000037DE                            ; -------------------------------
000037DE                            
000037DE                            @ChnVol_PCM:
000037DE 4E75                       		rts
000037E0                            		
000037E0                            ; ================================================================
000037E0                            ; -------------------------------
000037E0                            ; Channel effect
000037E0                            ; -------------------------------
000037E0                            
000037E0                            @ChannelEffects:
000037E0 7000                       		moveq	#0,d0
000037E2 102D 0002                  		move.b	Chn_Effect(a5),d0
000037E6 D040                       		add.w	d0,d0
000037E8 323B 0000                  		move.w	@EffectList(pc,d0.w),d1
000037EC 4EFB 1000                  		jmp	@EffectList(pc,d1.w)
000037F0                            		
000037F0                            ; -------------------------------
000037F0                            
000037F0 0000                       @EffectList:	dc.w	@Null-@EffectList
000037F2 0000                       		dc.w	@Flag_A-@EffectList
000037F4 0000                       		dc.w	@Null-@EffectList
000037F6 0000                       		dc.w	@Null-@EffectList
000037F8 0000                       		dc.w	@Flag_D-@EffectList
000037FA 0000                       		dc.w	@Flag_E-@EffectList
000037FC 0000                       		dc.w	@Flag_F-@EffectList
000037FE 0000                       		dc.w	@Null-@EffectList
00003800 0000                       		dc.w	@Null-@EffectList
00003802 0000                       		dc.w	@Null-@EffectList
00003804 0000                       		dc.w	@Null-@EffectList
00003806 0000                       		dc.w	@Null-@EffectList
00003808 0000                       		dc.w	@Null-@EffectList
0000380A 0000                       		dc.w	@Flag_M-@EffectList
0000380C 0000                       		dc.w	@Null-@EffectList
0000380E 0000                       		dc.w	@Null-@EffectList
00003810 0000                       		dc.w	@Null-@EffectList
00003812 0000                       		dc.w	@Null-@EffectList
00003814 0000                       		dc.w	@Null-@EffectList
00003816 0000                       		dc.w	@Null-@EffectList
00003818 0000                       		dc.w	@Null-@EffectList
0000381A 0000                       		dc.w	@Null-@EffectList
0000381C 0000                       		dc.w	@Null-@EffectList
0000381E 0000                       		dc.w	@Null-@EffectList
00003820 0000                       		dc.w	@Flag_X-@EffectList
00003822 0000                       		dc.w	@Null-@EffectList
00003824 0000                       		dc.w	@Flag_Z-@EffectList
00003826                            		even
00003826                            
00003826                            ; -------------------------------
00003826                            ; Null effect
00003826                            ; -------------------------------
00003826                            
00003826                            @Null:
00003826 4E75                       		rts
00003828                            
00003828                            ; -------------------------------
00003828                            ; Flag A - Set Tick rate
00003828                            ; -------------------------------
00003828                            
00003828                            @Flag_A:
00003828 7000                       		moveq	#0,d0
0000382A 426E 001E                  		clr.w	TicksSet(a6)
0000382E 102D 0003                  		move.b	Chn_Effect+1(a5),d0
00003832 0440 0001                  		sub.w	#1,d0
00003836 1D40 001F                  		move.b	d0,TicksSet+1(a6)
0000383A 4E75                       		rts
0000383C                            
0000383C                            ; -------------------------------
0000383C                            ; Flag D - Change Vol
0000383C                            ; -------------------------------
0000383C                            
0000383C                            @Flag_D:
0000383C 7000                       		moveq	#0,d0
0000383E 102D 0003                  		move.b	Chn_Effect+1(a5),d0
00003842 4A2D 0007                  		tst.b	Chn_ID(a5)
00003846 6A00 0000                  		bpl	@NotPSG
0000384A E948                       		lsl.w	#4,d0
0000384C                            @NotPSG:
0000384C D12D 0009                  		add.b	d0,Chn_Vol(a5)
00003850 6000 FE30                  		bra	@ChnVolume
00003854                            
00003854                            ; -------------------------------
00003854                            ; Flag E - Portametro down
00003854                            ; -------------------------------
00003854                            
00003854                            @Flag_E:
00003854 7000                       		moveq	#0,d0
00003856 102D 0003                  		move.b	Chn_Effect+1(a5),d0
0000385A 422D 0004                  		clr.b	Chn_Portam(a5)
0000385E D12D 0005                  		add.b	d0,Chn_Portam+1(a5)
00003862 4E75                       		rts
00003864                            
00003864                            ; -------------------------------
00003864                            ; Flag F - Portametro up
00003864                            ; -------------------------------
00003864                            
00003864                            @Flag_F:
00003864 7000                       		moveq	#0,d0
00003866 102D 0003                  		move.b	Chn_Effect+1(a5),d0
0000386A 422D 0005                  		clr.b	Chn_Portam+1(a5)
0000386E D12D 0004                  		add.b	d0,Chn_Portam(a5)
00003872 4E75                       		rts
00003874                            
00003874                            ; -------------------------------
00003874                            ; Flag M - Set Channel Volume
00003874                            ; -------------------------------
00003874                            
00003874                            @Flag_M:
00003874 7000                       		moveq	#0,d0
00003876 102D 0003                  		move.b	Chn_Effect+1(a5),d0
0000387A                            	;	tst.b	Chn_ID(a5)
0000387A                            	;	bpl	@NotPSG_H
0000387A                            
0000387A 4440                       		neg.w	d0
0000387C 0440 00D0                  		sub.w	#$D0,d0
00003880                            ;@NotPSG_H:
00003880 1B40 000A                  		move.b	d0,Chn_DefVol(a5)
00003884 6000 FDFC                  		bra	@ChnVolume
00003888                            
00003888                            ; -------------------------------
00003888                            ; Flag X - Stereo
00003888                            ; -------------------------------
00003888                            
00003888                            @Flag_X:
00003888 4A2D 0007                  		tst.b	Chn_ID(a5)
0000388C 6B98                       		bmi.s	@Null
0000388E 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003894 6C00 0000                  		bge	@PCM_Pan
00003898                            		
00003898 7000                       		moveq	#0,d0
0000389A 303C 00C0                  		move.w	#$C0,d0
0000389E 0C2D 0080 0003                             cmp.b	#$80,Chn_Effect+1(a5)
000038A4 6700                                       beq.s	@SetPan
000038A6 4A2D 0003                  		tst.b	Chn_Effect+1(a5)
000038AA 6B00                       		bmi.s	@Right
000038AC 6A00                       		bpl.s	@Left
000038AE                            @SetPan:
000038AE 1B40 000C                  		move.b	d0,Chn_Panning(a5)
000038B2 4E75                       		rts
000038B4                            @Left:
000038B4 303C 0080                  		move.w	#$80,d0
000038B8 60F4                       		bra.s	@SetPan
000038BA                            @Right:
000038BA 303C 0040                  		move.w	#$40,d0
000038BE 60EE                       		bra.s	@SetPan
000038C0                            
000038C0                            ; -------------------------------
000038C0                            ; PCM Panning
000038C0                            ; -------------------------------
000038C0                            
000038C0                            @PCM_Pan:
000038C0 4E75                       		rts
000038C2                            
000038C2                            ; ======================================================
000038C2                            ; ; -------------------------------------
000038C2                            ; ; FM
000038C2                            ; ; -------------------------------------
000038C2                            ; 
000038C2                            ; @FmChn3On:
000038C2                            ; 		moveq	#$27,d0
000038C2                            ; 		moveq	#0,d1
000038C2                            ; 		move.w	#%01000000,d1
000038C2                            ; 		Z80_OFF
000038C2                            ; 		bsr	FM_RegWrite_1
000038C2                            ; 		Z80_ON
000038C2                            ; 		rts
000038C2                            ; 
000038C2                            ; @FmChn3Off:
000038C2                            ; 		moveq	#$27,d0
000038C2                            ; 		moveq	#0,d1
000038C2                            ; 		Z80_OFF
000038C2                            ; 		bsr	FM_RegWrite_1
000038C2                            ; 		Z80_ON
000038C2                            ; 		rts
000038C2                            ;
000038C2                            
000038C2                            ; ======================================================
000038C2                            ; -------------------------------
000038C2                            ; Flag Z
000038C2                            ; -------------------------------
000038C2                            
000038C2                            @Flag_Z:
000038C2 7000                       		moveq	#0,d0
000038C4 102D 0003                  		move.b	Chn_Effect+1(a5),d0
000038C8 E848                       		lsr.w	#4,d0
000038CA D040                       		add.w	d0,d0
000038CC 323B 0000                  		move.w	@HashList(pc,d0.w),d1
000038D0 102D 0003                  		move.b	Chn_Effect+1(a5),d0		;d0 - $0-$F argument
000038D4 0200 000F                  		and.b	#$F,d0
000038D8 4EFB 1000                  		jmp	@HashList(pc,d1.w)
000038DC                            
000038DC 0000                       @HashList:	dc.w	@DacStatus-@HashList		;$00 - Status
000038DE 0000                       		dc.w	@FM_Key-@HashList		;$10 - FM Keys ON/OFF
000038E0 FF4A                       		dc.w	@Null-@HashList			;$20
000038E2 FF4A                       		dc.w	@Null-@HashList			;$30
000038E4 0000                       		dc.w	@PSG-@HashList			;$40 - PSG Settings
000038E6 FF4A                       		dc.w	@Null-@HashList			;$50
000038E8 FF4A                       		dc.w	@Null-@HashList			;$60
000038EA FF4A                       		dc.w	@Null-@HashList			;$70
000038EC FF4A                       		dc.w	@Null-@HashList			;$80
000038EE FF4A                       		dc.w	@Null-@HashList			;$90
000038F0 FF4A                       		dc.w	@Null-@HashList			;$A0
000038F2 FF4A                       		dc.w	@Null-@HashList			;$B0
000038F4 FF4A                       		dc.w	@Null-@HashList			;$C0
000038F6 FF4A                       		dc.w	@Null-@HashList			;$D0
000038F8 FF4A                       		dc.w	@Null-@HashList			;$E0
000038FA 0000                       		dc.w	@FixSfx-@HashList		;$F0 - Finish SFX flag (SFX only)
000038FC                            		even
000038FC                            
000038FC                            ; -------------------------------
000038FC                            
000038FC                            @DacStatus:
000038FC 0240 0003                  		and.w	#3,d0
00003900 1D40 0001                  		move.b	d0,DrvSettings(a6)
00003904                            		
00003904 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003916 1200                       		move.b	d0,d1
00003918 0241 0001                  		and.w	#1,d1
0000391C EF49                       		lsl.w	#7,d1
0000391E 702B                       		moveq	#$2B,d0
00003920 6100 0000                  		bsr	FM_RegWrite_1
00003924 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003934                            		
00003934 6000 0000                  		bra	SMEG_SetVoice_DAC
00003938                            
00003938                            ; -------------------------------
00003938                            
00003938                            @FM_Key:
00003938 0240 000F                  		and.w	#$F,d0
0000393C 1B40 000D                  		move.b	d0,Chn_FM_Key(a5)
00003940 4E75                       		rts
00003942                            
00003942                            ; -------------------------------
00003942                            
00003942                            @PSG:
00003942 08EE 0002 0001             		bset	#bitTone3,DrvSettings(a6)
00003948 0C00 0003                  		cmp.b	#3,d0
0000394C 6700                       		beq.s	@Tone3
0000394E 0C00 0007                  		cmp.b	#7,d0
00003952 6700                       		beq.s	@Tone3
00003954 08AE 0002 0001             		bclr	#bitTone3,DrvSettings(a6)
0000395A                            @Tone3:
0000395A 0816 0000                   		btst	#bitPriority,(a6)
0000395E 6700                        		beq.s	@IsPsg
00003960 47F9 FFFF D08A              		lea	(RAM_SMEG_Buffer),a3
00003966 176B 0001 0029             		move.b	DrvSettings(a3),DrvSettingsBGM(a3)
0000396C 1740 0028                  		move.b	d0,PsgLast(a3)
00003970                            @IsPsg:
00003970 0640 00E0                  		add.w	#$E0,d0
00003974 6000 0000                  		bra	@PutPSG
00003978                            
00003978                            ; -------------------------------
00003978                            
00003978                            @FixSfx:
00003978 0816 0000                    		btst	#bitPriority,(a6)
0000397C 6600 FE1A                    		bne	@Return
00003980                            		
00003980 47F9 FFFF D08A              		lea	(RAM_SMEG_Buffer),a3
00003986 176B 0029 0029             		move.b	DrvSettingsBGM(a3),DrvSettingsBGM(a3)
0000398C 7000                       		moveq 	#0,d0
0000398E 102B 0028                   		move.b	PsgLast(a3),d0
00003992 0896 0001                    		bclr	#bitSfxOn,(a6)				;SFX finished playing
00003996 0640 00E0                  		add.w	#$E0,d0
0000399A 6000 0000                  		bra	@PutPSG
0000399E                            
0000399E                            ; -------------------------------
0000399E                            
0000399E                            @PutPSG:
0000399E 13C0 00C0 0011             		move.b	d0,($C00011)
000039A4 4E75                       		rts
000039A6                            		
000039A6                            ; ================================================================
000039A6                            ; -------------------------------
000039A6                            ; Channel play
000039A6                            ; -------------------------------
000039A6                            
000039A6                            @ChannelPlay:
000039A6 0C2D 00FF 0007             		cmp.b	#$FF,Chn_ID(a5)
000039AC 6700 0000                  		beq	@Disabled
000039B0                            
000039B0 7000                                       moveq	#0,d0
000039B2 102D 000B                  		move.b	Chn_Note(a5),d0
000039B6 4A2D 0004                  		tst.b	Chn_Portam(a5)
000039BA 6700                       		beq.s	@NoUp
000039BC D02D 0004                  		add.b	Chn_Portam(a5),d0
000039C0 6000                       		bra.s	@NoDown
000039C2                            @NoUp:
000039C2 4A2D 0005                  		tst.b	Chn_Portam+1(a5)
000039C6 6700                       		beq.s	@NoDown
000039C8 902D 0005                  		sub.b	Chn_Portam+1(a5),d0
000039CC                            @NoDown:
000039CC 6100 FA78                  		bsr	@NoteFreq
000039D0                            
000039D0                            @Continue:
000039D0 382D 0000                  		move.w	Chn_Freq(a5),d4
000039D4 6700 0000                  		beq	SMEG_ChannelRest
000039D8 4A44                       		tst.w	d4
000039DA 6B00 0000                  		bmi	SMEG_ChannelRest
000039DE                            
000039DE 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
000039E4 6C00 0000                  		bge	@ChannelPlay_PCM
000039E8 0C2D 0006 0007                             cmp.b	#6,Chn_ID(a5)
000039EE 6600 0000                                  bne	@NoChk6_play
000039F2 082E 0000 0001             		btst	#bitDacOn,DrvSettings(a6)
000039F8 6600 0000                  		bne	@ChannelPlay_DAC
000039FC                            
000039FC                            @NoChk6_play:
000039FC                            
000039FC 4A2D 0007                  		tst.b	Chn_ID(a5)
00003A00 6B00 0000                  		bmi	@ChannelPlay_PSG
00003A04                            
00003A04 6100 0000                  		bsr	SMEG_FM_SetPan
00003A08                            
00003A08 7028                       		moveq	#$28,d0
00003A0A 7200                       		moveq	#0,d1
00003A0C D22D 0007                  		add.b	Chn_ID(a5),d1
00003A10 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003A22 6100 0000                  		bsr	FM_RegWrite_1
00003A26 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003A36                            
00003A36 7A00                       		moveq	#0,d5
00003A38 1A2D 0007                  		move.b	Chn_ID(a5),d5
00003A3C 0C05 0004                  		cmp.b	#4,d5
00003A40 6D00                       		blt.s	@FirstFM
00003A42 0405 0004                  		sub.b	#4,d5
00003A46                            @FirstFM:
00003A46                            
00003A46 303C 00A4                  		move.w	#$A4,d0
00003A4A D005                       		add.b	d5,d0
00003A4C 7200                       		moveq	#0,d1
00003A4E E15C                       		rol.w	#8,d4
00003A50 1204                       		move.b	d4,d1
00003A52 6100 0000                  		bsr	SMEG_FM_FindWrite
00003A56 303C 00A0                  		move.w	#$A0,d0
00003A5A D005                       		add.b	d5,d0
00003A5C 7200                       		moveq	#0,d1
00003A5E E15C                       		rol.w	#8,d4
00003A60 1204                       		move.b	d4,d1
00003A62 6100 0000                  		bsr	SMEG_FM_FindWrite
00003A66                            
00003A66 7028                       		moveq	#$28,d0
00003A68 7200                       		moveq	#0,d1
00003A6A 122D 000D                  		move.b	Chn_FM_Key(a5),d1
00003A6E E949                       		lsl.w	#4,d1
00003A70 D22D 0007                  		add.b	Chn_ID(a5),d1
00003A74 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003A86 6100 0000                  		bsr	FM_RegWrite_1
00003A8A 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003A9A                            
00003A9A                            @Disabled:
00003A9A 4E75                       		rts
00003A9C                            
00003A9C                            ; -------------------------------
00003A9C                            ; Play PSG
00003A9C                            ; -------------------------------
00003A9C                            
00003A9C                            @ChannelPlay_PSG:
00003A9C 0C2D 00E0 0007             		cmp.b	#$E0,Chn_ID(a5)
00003AA2 6700                       		beq.s	@PlayNoise
00003AA4                            
00003AA4 0C2D 00C0 0007                             cmp.b	#$C0,Chn_ID(a5)
00003AAA 6600                                       bne.s	@NotPsg3
00003AAC 082E 0002 0001             		btst	#bitTone3,DrvSettings(a6)
00003AB2 6700                       		beq.s	@NotPsg3
00003AB4 13FC 00DF 00C0 0011        		move.b	#$DF,($C00011).l
00003ABC 4E75                                       rts
00003ABE                            
00003ABE                            @NotPsg3:
00003ABE 7200                       		moveq	#0,d1
00003AC0 302D 0000                  		move.w	Chn_Freq(a5),d0
00003AC4 122D 0007                  		move.b	Chn_ID(a5),d1
00003AC8 0881 0007                  		bclr	#7,d1
00003ACC EA49                       		lsr.w	#5,d1
00003ACE 6000 0000                  		bra	@SetFreq
00003AD2                            
00003AD2                            @PlayNoise:
00003AD2 082E 0002 0001             		btst	#bitTone3,DrvSettings(a6)
00003AD8 67C0                       		beq.s	@Disabled
00003ADA                            
00003ADA 302D 0000                  		move.w	Chn_Freq(a5),d0
00003ADE 7202                       		moveq	#2,d1
00003AE0                            
00003AE0                            ;---------------------
00003AE0                            ; Set frequency
00003AE0                            ;
00003AE0                            ; d0 - frequency (0-$3ff)
00003AE0                            ; d1 - channel (0, 1, 2)
00003AE0                            ;---------------------
00003AE0                            
00003AE0                            @SetFreq:
00003AE0 1400                       		move.b	d0,d2
00003AE2 0202 000F                  		and.b	#$F,d2
00003AE6 0602 0080                  		add.b	#$80,d2
00003AEA 0201 0003                  		and.b	#$3,d1
00003AEE EB09                       		lsl.b	#$5,d1
00003AF0 8401                       		or.b	d1,d2
00003AF2 13C2 00C0 0011             		move.b	d2,($C00011).l	;$80+channel<<5+(freq&$f)
00003AF8 E848                       		lsr.w	#$4,d0
00003AFA 13C0 00C0 0011             		move.b	d0,($C00011).l	;freq>>4
00003B00 4E75                       		rts
00003B02                            		
00003B02                            ; -------------------------------
00003B02                            ; Play DAC
00003B02                            ; -------------------------------
00003B02                            
00003B02                            @ChannelPlay_DAC:
00003B02                            ; 		btst	#bitDacNote,DrvSettings(a6)
00003B02                            ; 		bne	@FoundIt
00003B02                            
00003B02 7200                       		moveq	#0,d1
00003B04 7400                       		moveq 	#0,d2
00003B06 122D 000B                  		move.b	Chn_Note(a5),d1
00003B0A 142D 000E                    		move.b 	Chn_PCM_Pitch(a5),d2
00003B0E D242                         		add.w	d2,d1
00003B10 0441 000C                        		sub.w	#12,d1
00003B14 ED49                       		lsl.w	#6,d1
00003B16 41FA 0000                  		lea	SMEG_DacNoteList(pc),a0
00003B1A 43F0 1000                  		lea	(a0,d1.w),a1
00003B1E                            @FoundIt:
00003B1E 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003B30 45F9 00A0 0200             		lea	($A00200),a2
00003B36 743F                       		moveq	#$3F,d2
00003B38                            @copy:
00003B38 14D9                       		move.b	(a1)+,(a2)+
00003B3A 51CA FFFC                  		dbf	d2,@copy
00003B3E                            		
00003B3E 7000                       		moveq	#0,d0				;TODO: Loop flag
00003B40 E308                       		lsl.b	#1,d0
00003B42 08C0 0000                  		bset	#0,d0
00003B46 13C0 00A0 018D             		move.b	d0,($A00180+$D)
00003B4C 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003B5C 4E75                       		rts
00003B5E                            
00003B5E                            ; -------------------------------
00003B5E                            ; Play PCM
00003B5E                            ; -------------------------------
00003B5E                            
00003B5E                            @ChannelPlay_PCM:
00003B5E                             		
00003B5E 4E75                       		rts
00003B60                            
00003B60                            ; -------------------------------
00003B60                            ; Mute/Rest channel
00003B60                            ; -------------------------------
00003B60                            
00003B60                            SMEG_ChannelRest:
00003B60 0C2D 00FF 0007             		cmp.b	#$FF,Chn_ID(a5)
00003B66 6700                       		beq.s	@Return
00003B68                            ; 		cmp.b	#$FF,Chn_ForceMute(a5)
00003B68                            ; 		beq.s	@Return
00003B68                            
00003B68 7000                       		moveq	#0,d0
00003B6A 102E 002A                  		move.b	LastPattChn(a6),d0
00003B6E 47EE 002D                  		lea	UsedChnBuff(a6),a3
00003B72 D6C0                       		adda	d0,a3
00003B74 4213                       		clr.b	(a3)
00003B76                            
00003B76 4A2D 0007                  		tst.b	Chn_ID(a5)
00003B7A 6B00                       		bmi.s	@PSG_Rest
00003B7C                            
00003B7C 0C2D 0006 0007                             cmp.b	#6,Chn_ID(a5)
00003B82 6600                                       bne.s	@NoChk6
00003B84 082E 0000 0001             		btst	#bitDacOn,DrvSettings(a6)
00003B8A 6600                       		bne.s	@DAC_Rest
00003B8C                            
00003B8C                            @NoChk6:
00003B8C 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003B92 6C00 0000                  		bge	@PCM_Rest
00003B96                            		
00003B96 7028                       		moveq	#$28,d0
00003B98 7200                                       moveq	#0,d1
00003B9A 122D 0007                  		move.b	Chn_ID(a5),d1
00003B9E 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003BB0 6100 0000                  		bsr	FM_RegWrite_1
00003BB4 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003BC4                            
00003BC4                            @Return:
00003BC4 4E75                       		rts
00003BC6                            
00003BC6                            ; -------------------------------
00003BC6                            ; PSG Rest
00003BC6                            ; -------------------------------
00003BC6                            
00003BC6                            @PSG_Rest:
00003BC6 7000                       		moveq	#0,d0
00003BC8 102D 0007                  		move.b	Chn_ID(a5),d0
00003BCC 0600 001F                  		add.b	#$1F,d0
00003BD0 13C0 00C0 0011             		move.b	d0,($C00011)
00003BD6                            
00003BD6                            @Disabled:
00003BD6 4E75                       		rts
00003BD8                            
00003BD8                            ; -------------------------------
00003BD8                            ; DAC Rest
00003BD8                            ; -------------------------------
00003BD8                            
00003BD8                            @DAC_Rest:
00003BD8 702B                       		moveq	#$2B,d0
00003BDA 7200                                       moveq	#0,d1
00003BDC 33FC 0100 00A1 1100 0839+    		Z80_OFF
00003BEE 6100 0000                    		bsr	FM_RegWrite_1
00003BF2                            ; 		bset	#0,($A00140)
00003BF2 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003C02 4E75                       		rts
00003C04                            
00003C04                            ; -------------------------------
00003C04                            ; PCM Rest
00003C04                            ; -------------------------------
00003C04                            
00003C04                            @PCM_Rest:
00003C04 4E75                       		rts
00003C06                            		
00003C06                            ; ================================================================
00003C06                            ; Subs
00003C06                            ; ================================================================
00003C06                            
00003C06                            ; -------------------------------------------
00003C06                            ; Set instrument
00003C06                            ; -------------------------------------------
00003C06                            
00003C06                            SMEG_SetVoice:
00003C06                            ; 		cmp.b	#$FF,Chn_ForceMute(a5)
00003C06                            ; 		beq	@Return
00003C06                            
00003C06 4A2D 0007                  		tst.b	Chn_ID(a5)
00003C0A 6B00 0000                  		bmi	@IsPsg
00003C0E                            
00003C0E 0C2D 0006 0007                             cmp.b	#6,Chn_ID(a5)
00003C14 6600                                       bne.s	@NoChk6_Voice
00003C16 082E 0000 0001             		btst	#bitDacOn,DrvSettings(a6)
00003C1C 6600 0000                  		bne	SMEG_SetVoice_DAC
00003C20                            @NoChk6_Voice:
00003C20 0C2D 0010 0007             		cmp.b	#PCM_1,Chn_ID(a5)
00003C26 6C00 0000                  		bge	SMEG_SetVoice_PCM
00003C2A                            		
00003C2A 7000                       		moveq	#0,d0
00003C2C 102D 0007                  		move.b	Chn_ID(a5),d0
00003C30 0C00 0004                  		cmp.b	#4,d0
00003C34 6D00                       		blt.s	@Low3
00003C36 0400 0004                  		sub.b	#4,d0
00003C3A                            @Low3:
00003C3A 266E 0010                  		movea.l	SongVoices(a6),a3
00003C3E 7C00                       		moveq	#0,d6
00003C40 1C2D 0008                  		move.b	Chn_Inst(a5),d6
00003C44                            @FindNext:
00003C44 4A53                       		tst.w	(a3)
00003C46 6B00 0000                  		bmi	@Return
00003C4A 7200                       		moveq	#0,d1
00003C4C 322B 0002                  		move.w	2(a3),d1
00003C50 BC53                       		cmp.w	(a3),d6
00003C52 6700                       		beq.s	@Found
00003C54 D6FC 0008                   		adda.w	#8,a3
00003C58 60EA                       		bra.s	@FindNext
00003C5A                            
00003C5A                            @Found:
00003C5A D6FC 0004                  		adda.w	#4,a3
00003C5E                            
00003C5E 2653                       		movea.l	(a3),a3
00003C60 4A41                       		tst.w	d1
00003C62 6700                       		beq.s	@Nothing
00003C64 0441 0001                  		sub.w	#1,d1
00003C68                            @NextFM:
00003C68 D6FC 0019                  		adda	#$19,a3
00003C6C 51C9 FFFA                  		dbf	d1,@NextFM
00003C70                            
00003C70                            @Nothing:
00003C70 4840                       		swap	d0
00003C72 303C 0028                  		move.w	#$28,d0
00003C76 7200                       		moveq	#0,d1
00003C78 122D 0007                  		move.b	Chn_ID(a5),d1
00003C7C 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003C8E 6100 0000                  		bsr	FM_RegWrite_1
00003C92 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003CA2 4840                       		swap	d0
00003CA4                            
00003CA4 43FA 0000                  		lea	SMEG_FM_RegList(pc),a1
00003CA8 3C00                       		move.w	d0,d6
00003CAA 7818                       		moveq	#$18,d4
00003CAC                            @Next:
00003CAC 3A06                       		move.w	d6,d5
00003CAE 1019                       		move.b	(a1)+,d0
00003CB0 3600                       		move.w	d0,d3
00003CB2 D045                       		add.w	d5,d0
00003CB4 121B                       		move.b	(a3)+,d1
00003CB6                            
00003CB6 0C2D 0004 0007             		cmp.b	#4,Chn_ID(a5)
00003CBC 6C00                       		bge.s	@Chn456
00003CBE 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003CD0 6100 0000                  		bsr	FM_RegWrite_1
00003CD4 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003CE4 51CC FFC6                  		dbf	d4,@Next
00003CE8 4E75                       		rts
00003CEA                            
00003CEA                            @Chn456:
00003CEA 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003CFC 6100 0000                  		bsr	FM_RegWrite_2
00003D00 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003D10 51CC FF9A                  		dbf	d4,@Next
00003D14                            @Return:
00003D14 4E75                       		rts
00003D16                            
00003D16                            ; ---------------------------------
00003D16                            
00003D16                            @IsPsg:
00003D16 4E75                       		rts
00003D18                            
00003D18                            ; -------------------------------------------------
00003D18                            ; Set FM panning
00003D18                            ; -------------------------------------------------
00003D18                            
00003D18                            SMEG_FM_SetPan:
00003D18 4A2D 0007                  		tst.b	Chn_ID(a5)
00003D1C 6B00                       		bmi.s	@Return
00003D1E                            		
00003D1E 303C 00B4                  		move.w	#$B4,d0
00003D22 7400                       		moveq	#0,d2
00003D24 142D 0007                  		move.b	Chn_ID(a5),d2
00003D28 7200                       		moveq	#0,d1
00003D2A 122D 000C                  		move.b	Chn_Panning(a5),d1
00003D2E                            
00003D2E 0C02 0003                  		cmp.b	#3,d2
00003D32 6E00                       		bgt.s	@SecondFM
00003D34                            
00003D34 D042                       		add.w	d2,d0
00003D36 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003D48 6100 0000                  		bsr	FM_RegWrite_1
00003D4C 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003D5C                            @Return:
00003D5C 4E75                       		rts
00003D5E                            
00003D5E                            @SecondFM:
00003D5E 0442 0004                  		sub.w	#4,d2
00003D62 D042                       		add.w	d2,d0
00003D64 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003D76 6100 0000                  		bsr	FM_RegWrite_2
00003D7A 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003D8A 4E75                       		rts
00003D8C                            		
00003D8C                            ; ---------------------------------
00003D8C                            ; Send DAC
00003D8C                            ; ---------------------------------
00003D8C                            
00003D8C                            SMEG_SetVoice_DAC:
00003D8C 206E 0014                  		movea.l	SongSampl(a6),a0
00003D90 7200                       		moveq	#0,d1
00003D92 122D 0008                  		move.b	Chn_Inst(a5),d1
00003D96                            
00003D96                            @FindSample:
00003D96 4A50                       		tst.w	(a0)
00003D98 6B00                       		bmi.s	@Return
00003D9A B250                       		cmp.w	(a0),d1
00003D9C 6700                       		beq.s	@Found
00003D9E D0FC 0010                   		adda	#$10,a0
00003DA2 60F2                       		bra.s	@FindSample
00003DA4                            
00003DA4                            @Found:
00003DA4 D0FC 0002                  		adda.w	#2,a0
00003DA8                            
00003DA8 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003DBA 6100                       		bsr.s	@Z80_LoadWav
00003DBC 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003DCC                            
00003DCC                            @Return:
00003DCC 4E75                       		rts
00003DCE                            
00003DCE                            ; ---------------------------------
00003DCE                            
00003DCE                            @Z80_LoadWav:
00003DCE 43F9 00A0 0180             		lea	($A00180),a1
00003DD4 7000                       		moveq	#0,d0
00003DD6 3018                       		move.w	(a0)+,d0
00003DD8 1B40 000E                    		move.b 	d0,Chn_PCM_Pitch(a5)
00003DDC 2018                       		move.l	(a0)+,d0
00003DDE 2218                       		move.l	(a0)+,d1
00003DE0 2418                       		move.l	(a0)+,d2
00003DE2                              		
00003DE2                            		;Start
00003DE2 7800                       		moveq	#0,d4
00003DE4 4A40                       		tst.w	d0
00003DE6 6A00                       		bpl.s	@plus_s
00003DE8 383C 0081                  		move.w	#$81,d4
00003DEC                            @plus_s:
00003DEC 4840                       		swap	d0
00003DEE 4844                       		swap	d4
00003DF0 1800                       		move.b	d0,d4
00003DF2 4844                       		swap	d4
00003DF4 4840                       		swap	d0
00003DF6 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
00003DF8 4844                       		swap	d4
00003DFA 12C4                       		move.b	d4,(a1)+		;		$xx0000
00003DFC 4844                       		swap	d4
00003DFE 12C0                       		move.b	d0,(a1)+		;start Addr	$00xx
00003E00 E048                       		lsr.w	#8,d0
00003E02 12C0                       		move.b	d0,(a1)+		;		$xx00
00003E04                            		
00003E04                            		;Loop
00003E04 7800                       		moveq	#0,d4
00003E06 4A41                       		tst.w	d1
00003E08 6A00                       		bpl.s	@plus_e
00003E0A 383C 0081                  		move.w	#$81,d4
00003E0E                            @plus_e:
00003E0E 4841                       		swap	d1
00003E10 4844                       		swap	d4
00003E12 1801                       		move.b	d1,d4
00003E14 4844                       		swap	d4
00003E16 4841                       		swap	d1
00003E18 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
00003E1A 4844                       		swap	d4
00003E1C 12C4                       		move.b	d4,(a1)+		;		$xx0000
00003E1E 4844                       		swap	d4
00003E20 12C1                       		move.b	d1,(a1)+		;start Addr	$00xx
00003E22 E049                       		lsr.w	#8,d1
00003E24 12C1                       		move.b	d1,(a1)+		;		$xx00
00003E26                            		
00003E26                            		;End
00003E26 7800                       		moveq	#0,d4
00003E28 4A42                       		tst.w	d2
00003E2A 6A00                       		bpl.s	@plus_l
00003E2C 383C 0081                  		move.w	#$81,d4
00003E30                            @plus_l:
00003E30 4842                       		swap	d2
00003E32 4844                       		swap	d4
00003E34 1802                       		move.b	d2,d4
00003E36 4844                       		swap	d4
00003E38 4842                       		swap	d2
00003E3A 12C4                       		move.b	d4,(a1)+		;start Bank	+$8000
00003E3C 4844                       		swap	d4
00003E3E 12C4                       		move.b	d4,(a1)+		;		$xx0000
00003E40 4844                       		swap	d4
00003E42 12C2                       		move.b	d2,(a1)+		;start Addr	$00xx
00003E44 E04A                       		lsr.w	#8,d2
00003E46 12C2                       		move.b	d2,(a1)+		;		$xx00
00003E48                            		
00003E48 4E75                       		rts
00003E4A                            
00003E4A                            ; ---------------------------------
00003E4A                            ; Send PCM/PWM
00003E4A                            ; ---------------------------------
00003E4A                            
00003E4A                            SMEG_SetVoice_PCM:
00003E4A                            @FinishList:
00003E4A 4E75                       		rts
00003E4C                            		
00003E4C                            ; ---------------------
00003E4C                            ; Reset FM
00003E4C                            ; ---------------------
00003E4C                            
00003E4C                            SMEG_FM_Reset:
00003E4C 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003E5E                            
00003E5E 7028                       		moveq	#$28,d0
00003E60 7200                       		moveq	#0,d1
00003E62 6100 0000                  		bsr	FM_RegWrite_1
00003E66 7028                       		moveq	#$28,d0
00003E68 7201                       		moveq	#1,d1
00003E6A 6100 0000                  		bsr	FM_RegWrite_1
00003E6E 7028                       		moveq	#$28,d0
00003E70 7202                       		moveq	#2,d1
00003E72 6100 0000                  		bsr	FM_RegWrite_1
00003E76 7028                       		moveq	#$28,d0
00003E78 7204                       		moveq	#4,d1
00003E7A 6100 0000                  		bsr	FM_RegWrite_1
00003E7E 7028                       		moveq	#$28,d0
00003E80 7205                       		moveq	#5,d1
00003E82 6100 0000                  		bsr	FM_RegWrite_1
00003E86 7028                       		moveq	#$28,d0
00003E88 7206                       		moveq	#6,d1
00003E8A 6100 0000                  		bsr	FM_RegWrite_1
00003E8E                            
00003E8E 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003E9E 4E75                       		rts
00003EA0                            
00003EA0                            ; ---------------------
00003EA0                            ; Find FM
00003EA0                            ; ---------------------
00003EA0                            
00003EA0                            SMEG_FM_FindWrite:
00003EA0 0C2D 0004 0007             		cmp.b	#4,Chn_ID(a5)
00003EA6 6C00                       		bge.s	@Second
00003EA8 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003EBA 6100 0000                  		bsr	FM_RegWrite_1
00003EBE 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003ECE 4E75                       		rts
00003ED0                            @Second:
00003ED0 33FC 0100 00A1 1100 0839+  		Z80_OFF
00003EE2 6100 0000                  		bsr	FM_RegWrite_2
00003EE6 13FC 002A 00A0 4000 33FC+  		Z80_ON
00003EF6 4E75                       		rts
00003EF8                            
00003EF8                            ;-----------------------
00003EF8                            ; Write to FM register
00003EF8                            ;-----------------------
00003EF8                            
00003EF8                            FM_RegWrite_1:
00003EF8 1439 00A0 4000             		move.b	($A04000).l,d2
00003EFE 0802 0007                  		btst	#7,d2
00003F02 66F4                       		bne.s	FM_RegWrite_1
00003F04 13C0 00A0 4000             		move.b	d0,($A04000).l
00003F0A                            @Loop:
00003F0A 1439 00A0 4000             		move.b	($A04000).l,d2
00003F10 0802 0007                  		btst	#7,d2
00003F14 66F4                       		bne.s	@Loop
00003F16 13C1 00A0 4001             		move.b	d1,($A04001).l
00003F1C 4E75                       		rts
00003F1E                            
00003F1E                            FM_RegWrite_2:
00003F1E 1439 00A0 4000             		move.b	($A04000).l,d2
00003F24 0802 0007                  		btst	#7,d2
00003F28 66CE                       		bne.s	FM_RegWrite_1
00003F2A 13C0 00A0 4002             		move.b	d0,($A04002).l
00003F30                            @Loop:
00003F30 1439 00A0 4000             		move.b	($A04000).l,d2
00003F36 0802 0007                  		btst	#7,d2
00003F3A 66F4                       		bne.s	@Loop
00003F3C 13C1 00A0 4003             		move.b	d1,($A04003).l
00003F42 4E75                       		rts
00003F44                            		
00003F44                            ; ---------------------
00003F44                            ; Reset PSG
00003F44                            ; ---------------------
00003F44                            
00003F44                            SMEG_PSG_Reset:
00003F44 13FC 009F 00C0 0011        		move.b	#$9F,($C00011).l
00003F4C 13FC 00BF 00C0 0011        		move.b	#$BF,($C00011).l
00003F54 13FC 00DF 00C0 0011        		move.b	#$DF,($C00011).l
00003F5C 13FC 00FF 00C0 0011        		move.b	#$FF,($C00011).l
00003F64 4E75                       		rts
00003F66                            
00003F66                            ; ---------------------
00003F66                            ; Reset PCM
00003F66                            ; ---------------------
00003F66                            
00003F66                            SMEG_PCM_Reset:
00003F66 4E75                       		rts
00003F68                            
00003F68                            ; ================================================================
00003F68                            ; Z80
00003F68                            ; ================================================================
00003F68                            
00003F68                            SMEG_Z80_Init:
00003F68 33FC 0100 00A1 1100        		move.w	#$100,($A11100).l
00003F70 33FC 0100 00A1 1200        		move.w	#$100,($A11200).l
00003F78                            @WaitZ80:
00003F78 0839 0000 00A1 1100        		btst	#0,($A11100).l
00003F80 66F6                       		bne.s	@WaitZ80
00003F82                            
00003F82 41F9 00A0 0000             		lea	($A00000).l,a0
00003F88 303C 1FFF                  		move.w	#$1FFF,d0
00003F8C                            @cleanup:
00003F8C 4218                       		clr.b	(a0)+
00003F8E 51C8 FFFC                  		dbf	d0,@cleanup
00003F92                            		
00003F92 41FA 0000                  		lea	Z80Driver(pc),a0
00003F96 43F9 00A0 0000             		lea	($A00000).l,a1
00003F9C 323C 0000                  		move.w	#Z80DriverEnd-Z80Driver,d1
00003FA0                            @ToZ80:
00003FA0 12D8                       		move.b	(a0)+,(a1)+
00003FA2 51C9 FFFC                  		dbf	d1,@ToZ80
00003FA6                            
00003FA6                            ; -----------------------------------
00003FA6                            
00003FA6 33FC 0000 00A1 1200        		move.w	#0,($A11200).l
00003FAE 4E71                       		nop
00003FB0 4E71                       		nop
00003FB2 4E71                       		nop
00003FB4 4E71                       		nop
00003FB6 33FC 0100 00A1 1200        		move.w	#$100,($A11200).l
00003FBE 33FC 0000 00A1 1100        		move.w	#0,($A11100).l
00003FC6 4E75                       		rts
00003FC8                            		
00003FC8                            ; ================================================================
00003FC8                            ; -------------------------------------------------
00003FC8                            ; Data
00003FC8                            ; -------------------------------------------------
00003FC8                            
00003FC8                            SMEG_FM_RegList:
00003FC8 B0                         		dc.b $B0
00003FC9 3038 343C                  		dc.b $30,$38,$34,$3C
00003FCD 5058 545C                  		dc.b $50,$58,$54,$5C
00003FD1 6068 646C                  		dc.b $60,$68,$64,$6C
00003FD5 7078 747C                  		dc.b $70,$78,$74,$7C
00003FD9 8088 848C                  		dc.b $80,$88,$84,$8C
00003FDD 4048 444C                  		dc.b $40,$48,$44,$4C
00003FE1                            SMEG_RegSetVol:
00003FE2 00                         		even
00003FE2                            
00003FE2                            ; ---------------------------------------------------
00003FE2                            
00003FE2                            SMEG_DacNoteList:
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-0
00003FE2                            ;      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D#0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;E-0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F-0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F#0
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G-0
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G#0
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A-0
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A#0
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;B-0
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D#1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;E-1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F-1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F#1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G-1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G#1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A-1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A#1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;B-1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-2
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D#2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;E-2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F-2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F#2
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G-2
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G#2
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A-2
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A#2
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;B-2
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-3
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D#3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;E-3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F-3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F#3
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G-3
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G#3
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A-3
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A#3
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;B-3
00003FE2                            ;   		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00003FE2 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-4
00004002 0101 0101 0101 0101 0101+      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004022 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#4
00004042 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004062 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-4
00004082 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000040A2 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D#4
000040C2 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000040E2 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;E-4
00004102 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004122 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F-4
00004142 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004162 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;F#4
00004182 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000041A2 0101 0101 0101 0101 0101+     		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G-4
000041C2 0101 0101 0101 0101 0101+      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000041E2 0101 0101 0101 0101 0101+      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;G#4
00004202 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004222 0101 0101 0101 0101 0101+      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A-4
00004242 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004262 0101 0101 0101 0101 0101+      		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;A#4
00004282 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000042A2 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;B-4
000042C2 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000042E2 0100 0101 0001 0001 0001+     		dc.b 1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0		;C-5 8000hz
00004302 0001 0001 0001 0000 0100+      		dc.b 0,1,0,1,0,1,0,0,1,0,1,1,0,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,0
00004322 0100 0101 0001 0001 0001+    		dc.b 1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,1,0,1,0,1,0		;C#5
00004342 0001 0001 0001 0000 0100+     		dc.b 0,1,0,1,0,1,0,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,0,1,0,0,1,0,0
00004362 0100 0101 0001 0001 0001+    		dc.b 1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0		;D-5
00004382 0001 0001 0001 0100 0100+     		dc.b 0,1,0,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,0,1,0,0,1,0,0
000043A2 0100 0101 0001 0001 0001+    		dc.b 1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,1,1,0,0,1,0,1,0,1,0		;D#5
000043C2 0001 0001 0001 0100 0100+     		dc.b 0,1,0,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,0,1,0,0,1,0,0
000043E2 0100 0101 0001 0001 0001+    		dc.b 1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,1,1,0,0,1,0,1,1,1,0		;E-5
00004402 0001 0101 0001 0100 0100+     		dc.b 0,1,1,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,1,1,0,0,1,0,0
00004422 0100 0101 0001 0001 0001+    		dc.b 1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1,0		;F-5
00004442 0001 0101 0001 0100 0100+     		dc.b 0,1,1,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,1,1,0,0,1,0,1
00004462 0100 0101 0001 0101 0001+    		dc.b 1,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1,0		;F#5
00004482 0001 0101 0001 0100 0100+     		dc.b 0,1,1,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,0,1,1,1,0,0,1,0,1
000044A2 0100 0101 0001 0101 0001+     		dc.b 1,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,0,1,0,1,1,1,0		;G-5
000044C2 0101 0101 0001 0100 0100+      		dc.b 1,1,1,1,0,1,1,0,1,0,1,1,0,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1
000044E2 0100 0101 0001 0101 0001+      		dc.b 1,0,1,1,0,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,0		;G#5
00004502 0101 0101 0001 0100 0100+    		dc.b 1,1,1,1,0,1,1,0,1,0,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1
00004522 0100 0101 0101 0101 0001+      		dc.b 1,0,1,1,1,1,1,1,0,1,1,0,1,1,1,0,1,1,0,1,0,1,1,1,1,1,1,0,1,1,1,0		;A-5
00004542 0101 0101 0001 0100 0101+    		dc.b 1,1,1,1,0,1,1,0,1,1,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1
00004562 0100 0101 0101 0101 0001+      		dc.b 1,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1,0		;A#5
00004582 0101 0101 0101 0100 0101+    		dc.b 1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,0,1,1,0,1
000045A2 0100 0101 0101 0101 0101+    		dc.b 1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1,1,1,1		;B-5
000045C2 0101 0101 0101 0100 0101+    		dc.b 1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,0,1
000045E2 0101 0101 0100 0101 0101+    		dc.b 1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C-6 16000hz
00004602 0101 0101 0101 0100 0101+    		dc.b 1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1
00004622 0101 0101 0101 0101 0101+    		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;C#6
00004642 0101 0101 0101 0101 0101+         		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
00004662 0101 0101 0101 0102 0101+    		dc.b 1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1		;D-6
00004682 0101 0101 0101 0101 0101+         		dc.b 1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1
000046A2 0101 0101 0101 0102 0101+    		dc.b 1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1		;D#6
000046C2 0101 0102 0101 0101 0101+         		dc.b 1,1,1,2,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1	
000046E2 0101 0201 0101 0102 0101+    		dc.b 1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1,1,1,1,1,1		;E-6
00004702 0101 0102 0101 0101 0201+         		dc.b 1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1
00004722 0101 0201 0101 0102 0101+    		dc.b 1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,1,2,1,1,1,2,1,1		;F-6
00004742 0102 0102 0101 0101 0201+         		dc.b 1,2,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,2
00004762 0101 0201 0102 0102 0101+    		dc.b 1,1,2,1,1,2,1,2,1,1,1,2,1,1,1,1,2,1,1,1,2,1,1,2,1,2,1,1,1,2,1,1		;F#6
00004782 0102 0102 0101 0201 0201+         		dc.b 1,2,1,2,1,1,2,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,2
000047A2 0101 0202 0102 0102 0101+    		dc.b 1,1,2,2,1,2,1,2,1,1,2,1,2,1,1,1,2,1,2,1,2,1,1,2,1,2,1,1,1,2,1,1		;G-6
000047C2 0102 0102 0101 0201 0201+         		dc.b 1,2,1,2,1,1,2,1,2,1,1,2,1,2,1,2,1,1,2,1,1,2,1,1,2,1,1,2,1,2,1,2
000047E2 0102 0102 0102 0102 0101+    		dc.b 1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2,1,2,1,2,1,1,2,1,2,1,2,1,2,1,2		;G#6
00004802 0102 0102 0101 0201 0201+         		dc.b 1,2,1,2,1,1,2,1,2,1,1,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2,1,2,1 
00004822 0102 0102 0102 0102 0101+    		dc.b 1,2,1,2,1,2,1,2,1,1,2,1,2,2,2,1,2,1,2,1,2,2,1,2,1,2,1,2,1,2,1,2		;A-6
00004842 0102 0102 0201 0201 0202+         		dc.b 1,2,1,2,2,1,2,1,2,2,1,2,1,2,1,2,1,2,2,1,2,1,2,2,2,1,2,1,2,1,2,1 
00004862 0102 0102 0102 0202 0102+    		dc.b 1,2,1,2,1,2,2,2,1,2,2,1,2,2,2,1,2,1,2,1,2,2,1,2,2,2,1,2,2,2,1,2		;A#6
00004882 0102 0201 0201 0201 0202+         		dc.b 1,2,2,1,2,1,2,1,2,2,2,2,1,2,2,2,1,2,2,1,2,1,2,2,2,1,2,2,2,1,2,1  
000048A2 0102 0202 0102 0202 0102+    		dc.b 1,2,2,2,1,2,2,2,1,2,2,2,1,2,2,1,2,2,2,1,2,2,1,2,2,2,1,2,2,2,2,2		;B-6
000048C2 0102 0202 0201 0201 0202+         		dc.b 1,2,2,2,2,1,2,1,2,2,2,2,1,2,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,1,2,2 
000048E2                            		even
000048E2                            
000048E2                            ; ---------------------------------------------------
000048E2                            
000048E2                            Z80Driver:	incbin	"engine/sound/data/z80/main.bin"
00004B22                            Z80DriverEnd:
00004B22                            		even
00004B22                            		even
00004B22                            		
00004B22                            ; ====================================================================
00004B22                            ; ---------------------------------------------
00004B22                            ; Data | Shared
00004B22                            ; ---------------------------------------------
00004B22                            
00004B22                            		include	"engine/shared/main.asm"
00004B22                            ; ====================================================================
00004B22                            ; Shared Data
00004B22                            ; ====================================================================
00004B22                            
00004B22                            Pal_DbgFont:	incbin	"engine/shared/data/pal_temp.bin"
00004B42                            Pal_DbgFont_End:
00004B42                            		even
00004B42                            
00004B42                            
00004B42                            		
00004B42                            ; ---------------------------------------------
00004B42                            ; Data | Modes
00004B42                            ; ---------------------------------------------
00004B42                            
00004B42                            ; 		include	"engine/modes/level/data/main.asm"
00004B42                             		include	"engine/modes/title/data/main.asm"
00004B42                            ; =================================================================
00004B42                            ; ------------------------------------------------
00004B42                            ; Data
00004B42                            ; ------------------------------------------------
00004B42                            
00004B42                            Vid_Data:
00004B42 0000 0000                  		dc.l @Frames
00004B46 0000 0000                  		dc.l @GFX
00004B4A 0000 0000                  		dc.l @Maps
00004B4E 0000 0000                  		dc.l 0
00004B52                            @Frames:
00004B52                            		incbin	"engine/modes/Title/data/vidtest/frames.bin"
00004E62                            		even
00004E62                            @Maps:
00004E62                            		incbin	"engine/modes/Title/data/vidtest/map.bin"
0001F262                            		even
0001F262                            
0001F262                            		cnop 0,$8000
00020000                            @GFX:
00020000                            		incbin	"engine/modes/Title/data/vidtest/art.bin"
000B31E0                            		even
000B31E0                            		
000B31E0                            vidSound:
000B31E0                             		incbin	"engine/modes/Title/data/vidtest/video/sound.wav",$3A
000FCF27                            vidSound_End:
000FCF28 00                         		even
000FCF28                            
000FCF28                            
000FCF28                            		
000FCF28                            ; ---------------------------------------------
000FCF28                            ; Data | Sound
000FCF28                            ; ---------------------------------------------
000FCF28                            
000FCF28                            ; 		include	"engine/sound/data/main.asm"
000FCF28                            
000FCF28                            ; ====================================================================
000FCF28                            
000FCF28                            		inform 0,"ROM SIZE: %h",*
000FCF28                            		cnop 0,$40000
00100000                            MD_RomEnd:
